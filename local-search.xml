<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Springäº‹åŠ¡</title>
    <link href="/2023/09/18/Spring%E4%BA%8B%E5%8A%A1/"/>
    <url>/2023/09/18/Spring%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="Springäº‹åŠ¡"><a href="#Springäº‹åŠ¡" class="headerlink" title="Springäº‹åŠ¡"></a>Springäº‹åŠ¡</h1><h2 id="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰"><a href="#äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰" class="headerlink" title="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰"></a>äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰</h2><ul><li>åŸå­æ€§</li><li>æŒä¹…æ€§</li><li>éš”ç¦»æ€§</li><li>ä¸€è‡´æ€§</li></ul><h2 id="springäº‹åŠ¡çš„ä¸¤ç§å®ç°"><a href="#springäº‹åŠ¡çš„ä¸¤ç§å®ç°" class="headerlink" title="springäº‹åŠ¡çš„ä¸¤ç§å®ç°"></a>springäº‹åŠ¡çš„ä¸¤ç§å®ç°</h2><ol><li>ç¼–ç¨‹å®ç°<ol><li>TransactionTemplate</li><li>TransactionManager</li></ol></li><li>æ³¨è§£å®ç°ï¼ˆaopï¼‰ï¼ˆï¼‰æ¨èä½¿ç”¨</li></ol><h2 id="äº‹åŠ¡çš„äº”å¤§å±æ€§"><a href="#äº‹åŠ¡çš„äº”å¤§å±æ€§" class="headerlink" title="äº‹åŠ¡çš„äº”å¤§å±æ€§"></a>äº‹åŠ¡çš„äº”å¤§å±æ€§</h2><ul><li>éš”ç¦»çº§åˆ«</li><li>æ˜¯å¦åªè¯»</li><li>å›æ»šè§„åˆ™</li><li>äº‹åŠ¡è¶…æ—¶</li><li>ä¼ æ’­è¡Œä¸º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º REQUIREDã€‚</span><br> <span class="hljs-type">int</span> <span class="hljs-title function_">getPropagationBehavior</span><span class="hljs-params">()</span>;<br> <span class="hljs-comment">//è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼æ˜¯ DEFAULT</span><br> <span class="hljs-type">int</span> <span class="hljs-title function_">getIsolationLevel</span><span class="hljs-params">()</span>;<br> <span class="hljs-comment">// è¿”å›äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º-1ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚</span><br> <span class="hljs-type">int</span> <span class="hljs-title function_">getTimeout</span><span class="hljs-params">()</span>;<br> <span class="hljs-comment">// è¿”å›æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º false</span><br> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isReadOnly</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><h3 id="ä¼ æ’­è¡Œä¸º"><a href="#ä¼ æ’­è¡Œä¸º" class="headerlink" title="ä¼ æ’­è¡Œä¸º:"></a>ä¼ æ’­è¡Œä¸º:</h3><p><strong>å®šä¹‰</strong>:</p><p>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜(å½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­)</p><p><strong>å®ç°</strong>ï¼š</p><p>æšä¸¾ç±»ï¼š<code>Propagation</code></p><p>Propagationçš„æ•°å€¼ä½œç”¨ï¼š</p><ol><li><p><strong>TransactionDefinition.PROPAGATION_REQUIRED</strong></p><ol><li><p>å¦‚æœå¤–éƒ¨æ–¹æ³•æ²¡æœ‰å¼€å¯äº‹åŠ¡çš„è¯ï¼Œ<code>Propagation.REQUIRED</code>ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚</p></li><li><p>å¦‚æœå¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡å¹¶ä¸”è¢«<code>Propagation.REQUIRED</code>çš„è¯ï¼Œæ‰€æœ‰<code>Propagation.REQUIRED</code>ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•å’Œå¤–éƒ¨æ–¹æ³•å‡å±äºåŒä¸€äº‹åŠ¡ ï¼Œåªè¦ä¸€ä¸ªæ–¹æ³•å›æ»šï¼Œæ•´ä¸ªäº‹åŠ¡å‡å›æ»šã€‚</p></li></ol></li><li><p><strong>TransactionDefinition.PROPAGATION_REQUIRES_NEW</strong></p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡å¤–éƒ¨æ–¹æ³•æ˜¯å¦å¼€å¯äº‹åŠ¡ï¼Œ<code>Propagation.REQUIRES_NEW</code>ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚</p></li><li><p><strong>TransactionDefinition.PROPAGATION_NESTED</strong></p><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ‰§è¡Œä¸<code>TransactionDefinition.PROPAGATION_REQUIRED</code>ç±»ä¼¼çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>åœ¨å¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œåœ¨å†…éƒ¨å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œä½œä¸ºåµŒå¥—äº‹åŠ¡å­˜åœ¨ã€‚</li><li>å¦‚æœå¤–éƒ¨æ–¹æ³•æ— äº‹åŠ¡ï¼Œåˆ™å•ç‹¬å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¸ <code>PROPAGATION_REQUIRED</code> ç±»ä¼¼ã€‚</li></ul></li><li><p><strong>TransactionDefinition.PROPAGATION_MANDATORY</strong></p><p>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆmandatoryï¼šå¼ºåˆ¶æ€§ï¼‰</p><p>è¿™ä¸ªä½¿ç”¨çš„å¾ˆå°‘ï¼Œå°±ä¸ä¸¾ä¾‹å­æ¥è¯´äº†ã€‚</p><p><strong>è‹¥æ˜¯é”™è¯¯çš„é…ç½®ä»¥ä¸‹ 3 ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œäº‹åŠ¡å°†ä¸ä¼šå‘ç”Ÿå›æ»šï¼Œè¿™é‡Œä¸å¯¹ç…§æ¡ˆä¾‹è®²è§£äº†ï¼Œä½¿ç”¨çš„å¾ˆå°‘ã€‚</strong></p><ul><li><strong><code>TransactionDefinition.PROPAGATION_SUPPORTS</code></strong>: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚</li><li><strong><code>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</code></strong>: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li><strong><code>TransactionDefinition.PROPAGATION_NEVER</code></strong>: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul></li></ol><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</h3><p><code>TransactionDefinition</code> æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡</p><p>æšä¸¾ç±»ï¼š<code>Isolation</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">DEFAULT(TransactionDefinition.ISOLATION_DEFAULT),<br><br> READ_UNCOMMITTED(TransactionDefinition.ISOLATION_READ_UNCOMMITTED),<br><br> READ_COMMITTED(TransactionDefinition.ISOLATION_READ_COMMITTED),<br><br> REPEATABLE_READ(TransactionDefinition.ISOLATION_REPEATABLE_READ),<br><br> SERIALIZABLE(TransactionDefinition.ISOLATION_SERIALIZABLE);<br><br></code></pre></td></tr></table></figure><ul><li><p><strong><code>TransactionDefinition.ISOLATION_DEFAULT</code></strong> :ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMySQL é»˜è®¤é‡‡ç”¨çš„ <code>REPEATABLE_READ</code> éš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ <code>READ_COMMITTED</code> éš”ç¦»çº§åˆ«.</p></li><li><p><strong><code>TransactionDefinition.ISOLATION_READ_UNCOMMITTED</code></strong> :æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«å¾ˆå°‘ï¼Œå› ä¸ºå®ƒå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</strong></p></li><li><p><strong><code>TransactionDefinition.ISOLATION_READ_COMMITTED</code></strong> : å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong></p></li><li><p><strong><code>TransactionDefinition.ISOLATION_REPEATABLE_READ</code></strong> : å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</strong></p></li><li><p><strong><code>TransactionDefinition.ISOLATION_SERIALIZABLE</code></strong> : æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»</strong>ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚</p></li></ul><h3 id="äº‹åŠ¡è¶…æ—¶"><a href="#äº‹åŠ¡è¶…æ—¶" class="headerlink" title="äº‹åŠ¡è¶…æ—¶"></a>äº‹åŠ¡è¶…æ—¶</h3><p>æ‰€è°“äº‹åŠ¡è¶…æ—¶ï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚åœ¨ <code>TransactionDefinition</code> ä¸­ä»¥ int çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¿™è¡¨ç¤ºäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´å–å†³äºåº•å±‚äº‹åŠ¡ç³»ç»Ÿæˆ–è€…æ²¡æœ‰è¶…æ—¶æ—¶é—´ã€‚</p><h3 id="äº‹åŠ¡åªè¯»å±æ€§"><a href="#äº‹åŠ¡åªè¯»å±æ€§" class="headerlink" title="äº‹åŠ¡åªè¯»å±æ€§"></a>äº‹åŠ¡åªè¯»å±æ€§</h3><ul><li><p>å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå•æ¡æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ²¡æœ‰å¿…è¦å¯ç”¨äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®åº“é»˜è®¤æ”¯æŒ SQL æ‰§è¡ŒæœŸé—´çš„è¯»ä¸€è‡´æ€§ï¼›</p></li><li><p>å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚ç»Ÿè®¡æŸ¥è¯¢ï¼ŒæŠ¥è¡¨æŸ¥è¯¢ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤šæ¡æŸ¥è¯¢ SQL å¿…é¡»ä¿è¯æ•´ä½“çš„è¯»ä¸€è‡´æ€§ï¼Œå¦åˆ™ï¼Œåœ¨å‰æ¡ SQL æŸ¥è¯¢ä¹‹åï¼Œåæ¡ SQL æŸ¥è¯¢ä¹‹å‰ï¼Œæ•°æ®è¢«å…¶ä»–ç”¨æˆ·æ”¹å˜ï¼Œåˆ™è¯¥æ¬¡æ•´ä½“çš„ç»Ÿè®¡æŸ¥è¯¢å°†ä¼šå‡ºç°è¯»æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œåº”è¯¥å¯ç”¨äº‹åŠ¡æ”¯æŒ</p></li></ul><h3 id="äº‹åŠ¡å›æ»šè§„åˆ™ï¼š"><a href="#äº‹åŠ¡å›æ»šè§„åˆ™ï¼š" class="headerlink" title="äº‹åŠ¡å›æ»šè§„åˆ™ï¼š"></a>äº‹åŠ¡å›æ»šè§„åˆ™ï¼š</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸ï¼ˆ<code>RuntimeException</code> çš„å­ç±»ï¼‰æ—¶æ‰ä¼šå›æ»šï¼Œ<code>Error</code> ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œä½†æ˜¯ï¼Œåœ¨é‡åˆ°æ£€æŸ¥å‹ï¼ˆCheckedï¼‰å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šã€‚</p><p>å›æ»šä½ å®šä¹‰çš„ç‰¹å®šçš„å¼‚å¸¸ç±»å‹ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(rollbackFor= MyException.class)</span><br></code></pre></td></tr></table></figure><h2 id="Transactional-çš„å¸¸ç”¨é…ç½®å‚æ•°æ€»ç»“ï¼ˆ-5-ä¸ªå¸¸ç”¨çš„ï¼‰ï¼š"><a href="#Transactional-çš„å¸¸ç”¨é…ç½®å‚æ•°æ€»ç»“ï¼ˆ-5-ä¸ªå¸¸ç”¨çš„ï¼‰ï¼š" class="headerlink" title="@Transactional çš„å¸¸ç”¨é…ç½®å‚æ•°æ€»ç»“ï¼ˆ 5 ä¸ªå¸¸ç”¨çš„ï¼‰ï¼š"></a><strong><code>@Transactional</code> çš„å¸¸ç”¨é…ç½®å‚æ•°æ€»ç»“ï¼ˆ 5 ä¸ªå¸¸ç”¨çš„ï¼‰ï¼š</strong></h2><table><thead><tr><th align="left">å±æ€§å</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">propagation</td><td align="left">äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º REQUIREDï¼Œå¯é€‰çš„å€¼åœ¨ä¸Šé¢ä»‹ç»è¿‡</td></tr><tr><td align="left">isolation</td><td align="left">äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼é‡‡ç”¨ DEFAULTï¼Œå¯é€‰çš„å€¼åœ¨ä¸Šé¢ä»‹ç»è¿‡</td></tr><tr><td align="left">timeout</td><td align="left">äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º-1ï¼ˆä¸ä¼šè¶…æ—¶ï¼‰ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚</td></tr><tr><td align="left">readOnly</td><td align="left">æŒ‡å®šäº‹åŠ¡æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º falseã€‚</td></tr><tr><td align="left">rollbackFor</td><td align="left">ç”¨äºæŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»å‹ã€‚</td></tr></tbody></table><h2 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h2><p><strong><code>@Transactional</code> çš„å·¥ä½œæœºåˆ¶æ˜¯åŸºäº AOP å®ç°çš„ï¼ŒAOP åˆæ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°çš„ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£,ä¼šä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚</strong></p><p>ğŸ¤ å¤šæä¸€å˜´ï¼š<code>createAopProxy()</code> æ–¹æ³• å†³å®šäº†æ˜¯ä½¿ç”¨ JDK è¿˜æ˜¯ Cglib æ¥åšåŠ¨æ€ä»£ç†</p><p>å¦‚æœä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªç±»ä¸­çš„ public æ–¹æ³•ä¸Šè¢«æ ‡æ³¨<code>@Transactional</code> æ³¨è§£çš„è¯ï¼ŒSpring å®¹å™¨å°±ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨è°ƒç”¨è¢«<code>@Transactional</code> æ³¨è§£çš„ public æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ï¼Œ<code>TransactionInterceptor</code> ç±»ä¸­çš„ <code>invoke()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¼‚å¸¸çš„æ—¶å€™å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åæäº¤äº‹åŠ¡ã€‚</p><blockquote><p><code>TransactionInterceptor</code> ç±»ä¸­çš„ <code>invoke()</code>æ–¹æ³•å†…éƒ¨å®é™…è°ƒç”¨çš„æ˜¯ <code>TransactionAspectSupport</code> ç±»çš„ <code>invokeWithinTransaction()</code>æ–¹æ³•ã€‚ç”±äºæ–°ç‰ˆæœ¬çš„ Spring å¯¹è¿™éƒ¨åˆ†é‡å†™å¾ˆå¤§ï¼Œè€Œä¸”ç”¨åˆ°äº†å¾ˆå¤šå“åº”å¼ç¼–ç¨‹çš„çŸ¥è¯†</p></blockquote><p>Spring AOP è‡ªè°ƒç”¨é—®é¢˜</p><blockquote><ul><li><p>å½“ä¸€ä¸ªæ–¹æ³•è¢«æ ‡è®°äº†<code>@Transactional</code> æ³¨è§£çš„æ—¶å€™ï¼ŒSpring äº‹åŠ¡ç®¡ç†å™¨åªä¼šåœ¨è¢«å…¶ä»–ç±»æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ç”Ÿæ•ˆï¼Œè€Œä¸ä¼šåœ¨ä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ç”Ÿæ•ˆã€‚</p></li><li><p>è¿™æ˜¯å› ä¸º Spring AOP å·¥ä½œåŸç†å†³å®šçš„ã€‚å› ä¸º Spring AOP ä½¿ç”¨åŠ¨æ€ä»£ç†æ¥å®ç°äº‹åŠ¡çš„ç®¡ç†ï¼Œå®ƒä¼šåœ¨è¿è¡Œçš„æ—¶å€™ä¸ºå¸¦æœ‰ <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨çš„å‰ååº”ç”¨äº‹ç‰©é€»è¾‘ã€‚å¦‚æœè¯¥æ–¹æ³•è¢«å…¶ä»–ç±»è°ƒç”¨æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡å°±ä¼šæ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶å¤„ç†äº‹åŠ¡ã€‚ä½†æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»£ç†å¯¹è±¡å°±æ— æ³•æ‹¦æˆªåˆ°è¿™ä¸ªå†…éƒ¨è°ƒç”¨ï¼Œå› æ­¤äº‹åŠ¡ä¹Ÿå°±å¤±æ•ˆäº†ã€‚</p></li><li><p>è§£å†³åŠæ³•å°±æ˜¯é¿å…åŒä¸€ç±»ä¸­è‡ªè°ƒç”¨æˆ–è€…ä½¿ç”¨ AspectJ å–ä»£ Spring AOP ä»£ç†ã€‚</p></li></ul></blockquote><h2 id="Transactional-çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“"><a href="#Transactional-çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“" class="headerlink" title="@Transactional çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“"></a><code>@Transactional</code> çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“</h2><ul><li><code>@Transactional</code> æ³¨è§£åªæœ‰ä½œç”¨åˆ° public æ–¹æ³•ä¸Šäº‹åŠ¡æ‰ç”Ÿæ•ˆï¼Œä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ï¼›</li><li>é¿å…åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨ <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼›</li><li>æ­£ç¡®çš„è®¾ç½® <code>@Transactional</code> çš„ <code>rollbackFor</code> å’Œ <code>propagation</code> å±æ€§ï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¼šå›æ»šå¤±è´¥;</li><li>è¢« <code>@Transactional</code> æ³¨è§£çš„æ–¹æ³•æ‰€åœ¨çš„ç±»å¿…é¡»è¢« Spring ç®¡ç†ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼›</li><li>åº•å±‚ä½¿ç”¨çš„æ•°æ®åº“å¿…é¡»æ”¯æŒäº‹åŠ¡æœºåˆ¶ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼›</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>äº‹åŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OJç³»ç»Ÿæ•°æ®åº“è¡¨è®¾è®¡å’Œè®¡åˆ’</title>
    <link href="/2023/09/14/OJ%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1%E5%92%8C%E8%AE%A1%E5%88%92/"/>
    <url>/2023/09/14/OJ%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1%E5%92%8C%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<h1 id="ojé¡¹ç›®æ•°æ®åº“è¡¨è®¾è®¡"><a href="#ojé¡¹ç›®æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="ojé¡¹ç›®æ•°æ®åº“è¡¨è®¾è®¡"></a>ojé¡¹ç›®æ•°æ®åº“è¡¨è®¾è®¡</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span><br>(<br>    id           <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    userAccount  <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è´¦å·&#x27;</span>,<br>    userPassword <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å¯†ç &#x27;</span>,<br>    unionId      <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å¾®ä¿¡å¼€æ”¾å¹³å°id&#x27;</span>,<br>    mpOpenId     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å…¬ä¼—å·openId&#x27;</span>,<br>    userName     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·æ˜µç§°&#x27;</span>,<br>    userAvatar   <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                          <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·å¤´åƒ&#x27;</span>,<br>    userProfile  <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·ç®€ä»‹&#x27;</span>,<br>    userRole     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;user&#x27;</span>            <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban&#x27;</span>,<br>    createTime   datetime     <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime   datetime     <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete     tinyint      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span>,<br>    index idx_unionId (unionId)<br>) comment <span class="hljs-string">&#x27;ç”¨æˆ·&#x27;</span> <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br><br><span class="hljs-comment">-- é¢˜ç›®è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question<br>(<br>    id          <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span><br>        <span class="hljs-keyword">primary</span> key,<br>    title       <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)                       <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ ‡é¢˜&#x27;</span>,<br>    content     text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å†…å®¹&#x27;</span>,<br>    tags        <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                      <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ ‡ç­¾åˆ—è¡¨ï¼ˆjson æ•°ç»„ï¼‰&#x27;</span>,<br>    answer      text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›®ç­”æ¡ˆ&#x27;</span>,<br>    submitNum   <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›®æäº¤æ•°&#x27;</span>,<br>    acceptedNum <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›®é€šè¿‡æ•°&#x27;</span>,<br>    judgeCase   text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ¤é¢˜ç”¨ä¾‹ï¼ˆjson æ•°ç»„ï¼‰&#x27;</span>,<br>    judgeConfig text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ¤é¢˜é…ç½®ï¼ˆjson å¯¹è±¡ï¼‰&#x27;</span>,<br>    thumbNum    <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç‚¹èµæ•°&#x27;</span>,<br>    favourNum   <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ”¶è—æ•°&#x27;</span>,<br> commentNum  <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è¯„è®ºæ•°&#x27;</span>,<br>  answerNum   <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜è§£æ•°&#x27;</span>,<br>    userId      <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime  datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime  datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete    tinyint  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span>,<br>    categoryId  <span class="hljs-type">int</span>                                comment <span class="hljs-string">&#x27;åˆ†ç±»id&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;é¢˜ç›®è¡¨&#x27;</span> <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br>    <br> <span class="hljs-comment">-- é¢˜ç›®è¯„è®ºè¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question_comment<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    questionId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›® id&#x27;</span>,<br>  replyContent   text                           comment <span class="hljs-string">&#x27;è¯„è®ºå†…å®¹&#x27;</span><br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è¯„è®ºç”¨æˆ· id&#x27;</span>,<br>  thumbNum   <span class="hljs-type">int</span>                                         comment <span class="hljs-string">&#x27;è¯„è®ºç‚¹èµæ•°&#x27;</span><br>  parentId   <span class="hljs-type">bigint</span>                                      comment <span class="hljs-string">&#x27;çˆ¶è¯„è®ºid&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_questionId (questionId),<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜ç›®è¯„è®ºè¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜ç›®ç‚¹èµè¡¨ï¼ˆç¡¬åˆ é™¤ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question_thumb<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    questionId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›® id&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_postId (questionId),<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜ç›®ç‚¹èµè¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜ç›®é¢˜è§£è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question_answer<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    questionId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›® id&#x27;</span>,<br>    answerContent  text                           comment <span class="hljs-string">&#x27;é¢˜è§£å†…å®¹&#x27;</span>,<br>  thumbNum    <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç‚¹èµæ•°&#x27;</span>,<br>  answer_tags    <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                   comment <span class="hljs-string">&#x27;åˆ†ç±»æ ‡ç­¾ï¼ˆjsonåˆ—è¡¨ï¼‰&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>  clickNum   <span class="hljs-type">int</span>                                comment <span class="hljs-string">&#x27;ç‚¹å‡»æŸ¥çœ‹æ•°&#x27;</span>,<br>  replyNum   <span class="hljs-type">int</span>                                comment <span class="hljs-string">&#x27;è¯„è®ºæ•°&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>) comment <span class="hljs-string">&#x27;é¢˜ç›®é¢˜è§£&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜è§£ç‚¹èµè¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> answer_thumb<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    answerId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜è§£ id&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_questionId (questionId),<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜è§£ç‚¹èµè¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜è§£è¯„è®ºè¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> answer_comment<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    answerId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜è§£ id&#x27;</span>,<br>  replyContent   text                           comment <span class="hljs-string">&#x27;è¯„è®ºå†…å®¹&#x27;</span><br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è¯„è®ºç”¨æˆ· id&#x27;</span>,<br>  thumbNum   <span class="hljs-type">int</span>                                         comment <span class="hljs-string">&#x27;è¯„è®ºç‚¹èµæ•°&#x27;</span><br>  parentId   <span class="hljs-type">bigint</span>                                      comment <span class="hljs-string">&#x27;çˆ¶è¯„è®ºid&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_answerId (answerId),<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜è§£è¯„è®ºè¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜è§£è¯„è®ºç‚¹èµè¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> answer_reply_thumb<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    commentId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜è§£è¯„è®º id&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_commentId (commentId),<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜è§£ç‚¹èµè¡¨&#x27;</span>;<br><br><br><span class="hljs-comment">-- é¢˜ç›®æ”¶è—è¡¨ï¼ˆç¡¬åˆ é™¤ï¼‰</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> post_favour<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    questionId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜ç›® id&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_questionId (questionId),<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜ç›®æ”¶è—&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜ç›®åˆ†ç±»è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> question_categories<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>  categoryName <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) comment <span class="hljs-string">&#x27;åˆ†ç±»åç§°&#x27;</span>,<br>  parentId   <span class="hljs-type">int</span>                                comment <span class="hljs-string">&#x27;çˆ¶åˆ†ç±»id&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    index idx_userId (userId)<br>) comment <span class="hljs-string">&#x27;é¢˜ç›®åˆ†ç±»è¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- é¢˜åº“è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> pay_questionBand<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>  questionBandImg          <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>)        comment <span class="hljs-string">&#x27;é¢˜åº“å°é¢å›¾ç‰‡&#x27;</span>,<br>  questionBandTitle        <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>)        <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜åº“æ ‡é¢˜&#x27;</span>,    <br>    questionBandContents     text                      <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜åº“å†…å®¹&#x27;</span>,<br>  payNum    <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å·²è´­ä¹°æ•°&#x27;</span>,<br>  answer_tags    <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                   comment <span class="hljs-string">&#x27;åˆ†ç±»æ ‡ç­¾ï¼ˆjsonåˆ—è¡¨ï¼‰&#x27;</span>,<br>  remainingNum  <span class="hljs-type">int</span>  <span class="hljs-keyword">default</span> <span class="hljs-number">10000</span>              <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-string">&#x27;å‰©ä½™æ•°é‡&#x27;</span>,<br>  unitPrice  <span class="hljs-type">float</span>   <span class="hljs-keyword">default</span> <span class="hljs-number">199.99</span>             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-string">&#x27;é¢˜åº“å•ä»·&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>) comment <span class="hljs-string">&#x27;é¢˜åº“è¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- è®¢å•è¡¨</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> orders (<br>  orderId <span class="hljs-type">bigint</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT comment <span class="hljs-string">&#x27;id&#x27;</span>,<br>  userId <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·id&#x27;</span>,<br>  orderNumber <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> comment <span class="hljs-string">&#x27;è®¢å•ç¼–å·&#x27;</span>,<br>  orderDate DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> comment <span class="hljs-string">&#x27;ä¸‹å•æ—¥æœŸ&#x27;</span>,<br>  orderStatus <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> comment <span class="hljs-string">&#x27;è®¢å•çŠ¶æ€&#x27;</span>,<br>  paymentMethod <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> comment <span class="hljs-string">&#x27;æ”¯ä»˜æ–¹å¼&#x27;</span>,<br>  questionBandId <span class="hljs-type">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é¢˜åº“id&#x27;</span>,<br>  orderAmount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> comment <span class="hljs-string">&#x27;è®¢å•é‡‘é¢&#x27;</span>,<br>  cancelReason TEXT comment <span class="hljs-string">&#x27;è®¢å•å–æ¶ˆåŸå› &#x27;</span>,<br>  completeDate DATETIME comment <span class="hljs-string">&#x27;è®¢å•å®Œæˆæ—¶é—´&#x27;</span>,<br>  createTime DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>  updateTime DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span><br>) comment <span class="hljs-string">&#x27;è®¢å•è¡¨&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å¾…åŠäº‹é¡¹</p><ul><li><input disabled="" type="checkbox"> ç‚¹èµå’Œæ”¶è—çš„å¼€å‘</li><li><input disabled="" type="checkbox"> è¯„è®ºåŠŸèƒ½çš„å¼€å‘</li><li><input disabled="" type="checkbox"> é¢˜ç›®åˆ†ç±»çš„å¼€å‘</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>é¡¹ç›®è®¡åˆ’</tag>
      
      <tag>æ•°æ®åº“è®¾è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»é›¶å¼€å§‹å»ºç«‹åšå®¢</title>
    <link href="/2023/09/14/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%BB%BA%E7%AB%8B%E5%8D%9A%E5%AE%A2/"/>
    <url>/2023/09/14/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%BB%BA%E7%AB%8B%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»é›¶å¼€å§‹å»ºç«‹åšå®¢"><a href="#ä»é›¶å¼€å§‹å»ºç«‹åšå®¢" class="headerlink" title="ä»é›¶å¼€å§‹å»ºç«‹åšå®¢"></a>ä»é›¶å¼€å§‹å»ºç«‹åšå®¢</h1><h2 id="ä¸€ã€å‡è®¾ä½ æœ‰githubè´¦å·ï¼Œä½ å·²ç»ä¸‹è½½å¹¶é…ç½®å¥½node-jsä¸‹é¢æˆ‘ä»¬å°†ä»æ­¤åŸºç¡€ä¸Šæ­å»ºã€‚"><a href="#ä¸€ã€å‡è®¾ä½ æœ‰githubè´¦å·ï¼Œä½ å·²ç»ä¸‹è½½å¹¶é…ç½®å¥½node-jsä¸‹é¢æˆ‘ä»¬å°†ä»æ­¤åŸºç¡€ä¸Šæ­å»ºã€‚" class="headerlink" title="ä¸€ã€å‡è®¾ä½ æœ‰githubè´¦å·ï¼Œä½ å·²ç»ä¸‹è½½å¹¶é…ç½®å¥½node.jsä¸‹é¢æˆ‘ä»¬å°†ä»æ­¤åŸºç¡€ä¸Šæ­å»ºã€‚"></a>ä¸€ã€å‡è®¾ä½ æœ‰githubè´¦å·ï¼Œä½ å·²ç»ä¸‹è½½å¹¶é…ç½®å¥½node.jsä¸‹é¢æˆ‘ä»¬å°†ä»æ­¤åŸºç¡€ä¸Šæ­å»ºã€‚</h2><ol><li><p>åœ¨ä»»æ„ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªBlogç›®å½•ç”¨äºåˆå§‹åŒ–åšå®¢é¡¹ç›®</p></li><li><p>è¿›å…¥æ–°å»ºçš„åšå®¢ç›®å½•æ‰“å¼€gitçª—å£</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd D:/MyBlog<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g hexo-cli<br>hexo init //åˆå§‹åŒ–<br>hexo g é™æ€éƒ¨ç½²<br>hexo s æŸ¥çœ‹é¡µé¢<br></code></pre></td></tr></table></figure><ol start="3"><li>è¿›å…¥æ ¹ç›®å½•ä¸‹çš„_config.xmlåœ¨æœ€åé¢é…ç½®å¦‚ä¸‹å†…å®¹</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">deploy:<br>  type: git<br>  repository: git@github.com:xiaozhouzai/xiaozhouzai.github.io.git  #ä½ çš„ä»“åº“åœ°å€<br>  branch: main<br></code></pre></td></tr></table></figure><ol start="4"><li>å®‰è£…gitéƒ¨ç½²æ’ä»¶ï¼ˆæ‰§è¡Œhexo d å¿…é¡»è¦å®‰è£…è¿™ä¸ªæ’ä»¶ï¼‰</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><ol start="5"><li>æ¯æ¬¡æ›´æ”¹å†…å®¹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå‘½ä»¤ï¼š</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">hexo clean   #æ¸…é™¤ç¼“å­˜æ–‡ä»¶ db.json å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ public<br>hexo g       #ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶åˆ°é»˜è®¤è®¾ç½®çš„ public æ–‡ä»¶å¤¹<br>hexo d       #è‡ªåŠ¨ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶ï¼Œå¹¶éƒ¨ç½²åˆ°è®¾å®šçš„ä»“åº“<br></code></pre></td></tr></table></figure><ol start="6"><li>éƒ¨ç½²ä¹‹åè¾“å…¥ç½‘å€å°±å¯ä»¥çœ‹åˆ°ä½ çš„åšå®¢å†…å®¹</li></ol><p>æŠ¥é”™ï¼š<code>warning: in the working copy of &#39;2023/07/28/hello-world/index.html&#39;, LF will be replaced by CRLF the next time Git touches it</code></p><p>è§£å†³ï¼š</p><p><code>git config --global core.autocrlf true</code></p><ol start="7"><li>ä¸‹è½½ä¸»é¢˜ï¼ˆFluidï¼‰ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install --save hexo-theme-fluid<br></code></pre></td></tr></table></figure><ol start="8"><li><p>è¿›å…¥ä¸»é¢˜ç›®å½•ä¸‹çš„_config.xmlè¿›è¡Œä¸»é¢˜é…ç½®ï¼Œå»å®˜ç½‘çœ‹å®˜æ–¹æ–‡æ¡£</p></li><li><p>æ–°å»ºæ–‡ç« ï¼š<code>hexo n æ–‡ä»¶å</code></p></li><li><p>å›¾ç‰‡æ— æ³•æ˜¾ç¤º</p></li><li><p>è§£å†³ï¼šå‚è€ƒæˆ‘çš„åšå®¢â€œtyproé…ç½®å›¾åºŠâ€ï¼Œé‡‡ç”¨å›¾åºŠå›¾ç‰‡å°±ä¼šæ˜¾ç¤ºã€‚</p></li></ol><h2 id="äºŒã€æŠ¥é”™åŠè§£å†³"><a href="#äºŒã€æŠ¥é”™åŠè§£å†³" class="headerlink" title="äºŒã€æŠ¥é”™åŠè§£å†³"></a>äºŒã€æŠ¥é”™åŠè§£å†³</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">Error: Spawn failed<br>    at ChildProcess.&lt;anonymous&gt; (D:\MyBlog\node_modules\hexo-util\lib\spawn.js:<span class="hljs-number">51</span>:<span class="hljs-number">21</span>)<br>    at ChildProcess.emit (node:events:<span class="hljs-number">513</span>:<span class="hljs-number">28</span>)<br>    at cp.emit (D:\MyBlog\node_modules\cross-spawn\lib\enoent.js:<span class="hljs-number">34</span>:<span class="hljs-number">29</span>)<br>    at ChildProcess._handle.onexit (node:internal/child_process:<span class="hljs-number">291</span>:<span class="hljs-number">12</span>)<br>---------------------------------------------- <br>å…¶ä»–å„ç§æŠ¥é”™    <br><span class="hljs-comment">//æœçš„è§£å†³æ–¹æ³•(å¯¹æˆ‘æ²¡ç”¨)</span><br>rm -rf .deploy_git/<br>npm install hexo-deployer-git<br>hexo clean/ g /d<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Connection closed by <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> port <span class="hljs-number">22</span><br>fatal: Could not read from remote repository.<br><br>Please make sure you have the correct access rights<br>and the repository exists.<br>FATAL Something<span class="hljs-string">&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="hljs-string">Error: Spawn failed</span><br><span class="hljs-string">    at ChildProcess.&lt;anonymous&gt; (D:\MyBlog\node_modules\hexo-util\lib\spawn.js:51:21)</span><br><span class="hljs-string">    at ChildProcess.emit (node:events:513:28)</span><br><span class="hljs-string">    at cp.emit (D:\MyBlog\node_modules\cross-spawn\lib\enoent.js:34:29)</span><br><span class="hljs-string">    at ChildProcess._handle.onexit (node:internal/child_process:291:12)</span><br><span class="hljs-string">--------------------------------------------------------------------------------    </span><br></code></pre></td></tr></table></figure><p><strong>è§£å†³</strong>ï¼šåŸå› ï¼Œæˆ‘å¼€äº†åŠ é€Ÿå™¨ï¼ŒDNSè§£æè¢«æ±¡æŸ“ï¼šåœ¨hoståŠ å…¥ä¸€æ¡è®°å½•è§£æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">140.82.113.4 github.com<br></code></pre></td></tr></table></figure><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230816115645732.png" alt="image-20230816115645732"></p><p>è§£å†³ï¼šç›¸ä¿¡æˆ‘ï¼Œåœ¨ä½ é…ç½®ä¸»é¢˜å‘ç°éƒ¨ç½²ä¹‹åç½‘é¡µè¿Ÿè¿Ÿå±•ç°ä¸å‡ºæ¥å»ºè®®ç›´æ¥åˆ é™¤åšå®¢é‡æ–°å†æ­å»ºï¼Œä»¥ä¸€ä¸ªè¿‡æ¥äººçš„ç»å†åŠä½ ï¼Œé‡æ–°æ­å»ºæ¯”ä½ ä¿®ä¿®æ”¹æ”¹å¼„å¥½æ•ˆç‡è¦é«˜ï¼Œåˆ‡è®°å¦‚æœä½ æ²¡æœ‰å‰ç«¯åŸºç¡€ï¼Œä¸è¦éšä¾¿ä¿®æ”¹é…ç½®ã€‚ä¼šå´©æºƒ!!!!!!</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ•™ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¯æ—¥ä¸€é¢</title>
    <link href="/2023/09/14/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%9D%A2/"/>
    <url>/2023/09/14/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%9D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¯æ—¥ä¸€é¢"><a href="#æ¯æ—¥ä¸€é¢" class="headerlink" title="æ¯æ—¥ä¸€é¢"></a>æ¯æ—¥ä¸€é¢</h1><h2 id="RabbitMqçš„å·¥ä½œæ¨¡å¼æœ‰å•¥ï¼Ÿ"><a href="#RabbitMqçš„å·¥ä½œæ¨¡å¼æœ‰å•¥ï¼Ÿ" class="headerlink" title="RabbitMqçš„å·¥ä½œæ¨¡å¼æœ‰å•¥ï¼Ÿ"></a><strong>RabbitMq</strong>çš„å·¥ä½œæ¨¡å¼æœ‰å•¥ï¼Ÿ</h2><p>1ï¼Œ<strong>simpleæ¨¡å¼</strong>ï¼ˆæ™®é€šæ¨¡å¼ï¼‰</p><p>æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°brokerï¼ˆå„ç§æ¶ˆæ¯ä¸­é—´ä»¶ï¼‰ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—æ˜¯å¦æœ‰æ¶ˆæ¯ï¼Œæœ‰æ¶ˆæ¯å°±å»æ¶ˆè´¹ï¼Œæ¶ˆæ¯è¢«æ¶ˆè´¹åæ¶ˆæ¯é˜Ÿåˆ—å°±ä¼šæŠŠæ¶ˆæ¯ä¸¢å¼ƒã€‚ä¸€èˆ¬æŠŠautoackè®¾ç½®ä¸ºfalseï¼Œä»–è¡¨ç¤ºå¼€å¯è‡ªåŠ¨ç¡®è®¤ï¼Œå¦‚æœæ¶ˆæ¯ä¸€æ—¦è¢«æ¶ˆè´¹è€…å–èµ°ï¼Œä¸ç®¡æœ‰æ²¡æœ‰è¢«æ­£ç¡®æ¶ˆè´¹ï¼Œéƒ½ä¼šç¡®è®¤ï¼Œç»§è€Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šå°†æ¶ˆæ¯è®¤ä¸ºå·²å¤„ç†ï¼Œä¸æ¥æ”¶åˆ°æ˜¯å¦è¢«æ­£ç¡®æ¶ˆè´¹å°±å°†æ¶ˆæ¯ç§»é™¤é˜Ÿåˆ—ï¼Œå¦‚æœæ­¤æ—¶æ¶ˆæ¯è¿˜æ²¡æœ‰è¢«æ­£ç¡®æ¶ˆè´¹å°±æ²¡æœ‰äº†ï¼Œä¼šäº§ç”Ÿæ¶ˆæ¯ä¸¢å¤±é—®é¢˜ã€‚ </p><p>è‡ªå®šä¹‰basicAckï¼ˆç¡®è®¤ï¼‰ï¼Œæˆ–è€…basicNackï¼ˆä¸ç¡®è®¤ï¼‰ï¼ŒbasicRejectï¼ˆæ‹’ç»ï¼‰ ï¼Œæ‰‹åŠ¨å¤„ç†ï¼Œå¤„ç†å®ŒååŠæ—¶å‘é€ackï¼Œnackï¼Œrejectæ¶ˆæ¯ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ç›´ä¸ç¡®è®¤ï¼Œæ¶ˆæ¯ä¼šå †ç§¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¼šé€ æˆå†…å­˜æº¢å‡ºæƒ…å†µ</p><p>2, <strong>work</strong>æ¨¡å¼ï¼ˆèµ„æºçš„ç«äº‰ï¼‰</p><p>æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ­¤æ—¶æœ‰å¤šä¸ªæ¶ˆè´¹è€…å…±åŒç›‘å¬ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“æ¶ˆè´¹æ—¶ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…å…±åŒå»æŠ¢å¤ºè¿™ä¸ªæ¶ˆæ¯ï¼Œè°æŠ¢åˆ°æ¶ˆæ¯ï¼Œè°æ¶ˆè´¹ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æŠ¢åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…éƒ½æ¶ˆè´¹äº†è¿™æ¡æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ç­‰å¤šä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ä»»åŠ¡æ˜¯æ’å…¥æ•°æ®åº“æ“ä½œï¼Œå¤šä¸ªæ¶ˆè´¹è€…éƒ½æ‰§è¡Œäº†ï¼Œæ•°æ®é‡å¤ã€‚</p><p>è§£å†³ï¼Œç»™æ¶ˆè´¹è€…è®¾ç½®synchronizeå¼€å…³ï¼Œè°è¯·åˆ°è°æ‰§è¡Œï¼Œå…¶ä»–çš„æŠ¢ä¸åˆ°ä¹Ÿä¸å†æ¶ˆè´¹ã€‚ä¿è¯ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</p><p>3ï¼Œ<strong>publishï¼ˆå‘å¸ƒï¼‰subscribeï¼ˆè®¢é˜…ï¼‰</strong>æ¨¡å¼</p><p>æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘åˆ°brokerï¼Œç”±äº¤æ¢æœºå°†æ¶ˆæ¯åˆ†å‘åˆ°ç»‘å®šæ­¤äº¤æ¢æœºçš„æ‰€æœ‰é˜Ÿåˆ—ã€‚</p><p>æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—</p><p>4ï¼Œ<strong>routingè·¯ç”±æ¨¡å¼</strong></p><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å’Œè·¯ç”±å¯†åŒ™ä¸€èµ·å‘åˆ°brokerï¼Œç”±è·¯ç”±äº¤æ¢æœºæ ¹æ®è·¯ç”±åŒ¹é…ï¼Œæ ¹æ®è·¯ç”±åŒ¹é…è§„åˆ™åˆç†çš„è®¾ç½®routerKeyï¼Œå°†æ¶ˆæ¯å‘é€åˆ°ç”±è·¯ç”±åŒ¹é…åˆ°çš„é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…å»æ¶ˆè´¹å¯¹åº”çš„é˜Ÿåˆ—çš„æ¶ˆæ¯</p><p>routerKeyçš„è®¾ç½®å¾ˆçµæ´»ï¼Œæ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯è‡ªå®šä¹‰è®¾è®¡ï¼Œä¸»è¦è¿˜æ˜¯ä¸¤ä¸ªé€šé…ç¬¦</p><p>*ä»£è¡¨ä¸€ä¸ªå­—ç¬¦æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ#ä»£è¡¨å¤šä¸ªï¼Œæˆ–è€…å…¨åŒ¹é…</p><h2 id="synchronized-å¹¶å‘å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"><a href="#synchronized-å¹¶å‘å…³é”®å­—çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="synchronized å¹¶å‘å…³é”®å­—çš„ä½œç”¨ï¼Ÿ"></a>synchronized å¹¶å‘å…³é”®å­—çš„ä½œç”¨ï¼Ÿ</h2><p>synchronizedæ˜¯ç”¨æ¥æ§åˆ¶çº¿ç¨‹åŒæ­¥çš„ï¼Œä¿è¯è¢«synchronizedä¿®é¥°çš„ä»£ç å—åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œsynchronizedå¯ä»¥ä¿®é¥°ï¼Œç±»ï¼Œæ–¹æ³•ï¼Œä»£ç å—ã€‚</p><p>jdk1.6ä¹‹åsynchronizedğŸ”’æœ‰å››ç§çŠ¶æ€:æ— é”ï¼Œåå‘é”ï¼Œè½»é‡çº§é”å’Œé‡é‡çº§é”</p><p>ğŸŒµæ— é”: å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºä¹‹åï¼Œè¿˜æ²¡æœ‰çº¿ç¨‹è¿›å…¥ï¼Œè¿™æ—¶å€™å¯¹è±¡å°±å¤„äºæ— é”çŠ¶æ€ã€‚ </p><p>ğŸŒµåå‘æ‰€: å½“å¤„äºæ— é”çŠ¶æ€æ—¶ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹Aè®¿é—®åŒæ­¥å—å¹¶è·å¾—é”æ—¶ä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•çº¿ç¨‹ID(threadID)ï¼Œä¹‹åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ï¼Œä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥è¿›è¡ŒåŠ é”è§£é”ï¼Œåªéœ€è¦ç®€å•æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„çº¿ç¨‹IDæ˜¯å¦å’Œå½“å‰çº¿ç¨‹æ˜¯å¦ä¸€è‡´ ã€‚</p><p>ğŸŒµè½»é‡çº§é”: åœ¨åå‘é”çš„åŸºç¡€ä¸Šï¼Œå½“æœ‰å¦ä¸€ä¸ªçº¿ç¨‹Bè¿›æ¥ï¼Œè¿™æ—¶åˆ¤æ–­å¯¹è±¡å¤´å‚¨å­˜çš„çº¿ç¨‹IDå’Œçº¿ç¨‹Bçš„ä¸ä¸€è‡´ï¼Œå°±ä¼šä½¿ç”¨CASç«äº‰é”ï¼Œå¹¶å‡çº§æˆè½»é‡çº§é”ï¼Œä¼šåœ¨çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•ï¼Œå°†é”ä¿¡æ¯å¤åˆ¶åˆ°é”è®°å½•é‡Œï¼Œç„¶åå°è¯•ä½¿ç”¨CASï¼Œå°†å¯¹è±¡å¤´çš„ä¿¡æ¯æ›¿æ¢æˆæŒ‡å‘ğŸ‘‰ğŸ»é”è®°å½•çš„æŒ‡é’ˆã€‚ </p><p>ğŸŒµé‡é‡çº§é”: å½“çº¿ç¨‹æ²¡æœ‰è·å¾—è½»é‡çº§é”çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šCASè‡ªæ—‹æ¥è·å¾—é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è‡ªæ—‹10æ¬¡ä¹‹åï¼Œä»æ²¡è·å¾—é”ï¼Œæ‹©å‡çº§æˆé‡é‡çº§é”ã€‚æˆä¸ºé‡é‡çº§é”ä¹‹åï¼Œçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹ä¸å†è‡ªæ—‹è·å¾—é”ï¼Œè€Œæ˜¯ç”±CPUè¿›è¡Œè°ƒåº¦ï¼Œçº¿ç¨‹ä¸²è¡ŒåŒ–æ‰§è¡Œã€‚</p><ol><li>ç±»çº§åˆ«çš„ synchronizedï¼šå½“ synchronized ä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒé”å®šçš„æ˜¯æ•´ä¸ªç±»çš„å®ä¾‹ã€‚è¿™æ„å‘³ç€åœ¨åŒä¸€æ—¶é—´å†…ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥ç±»çš„ä»»ä½• synchronized æ–¹æ³•æˆ–ä»£ç å—ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç”¨äºä¿æŠ¤å…±äº«çš„ç±»çº§åˆ«èµ„æºã€‚</li><li>æ–¹æ³•çº§åˆ«çš„ synchronizedï¼šå½“ synchronized ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒé”å®šçš„æ˜¯å½“å‰å¯¹è±¡å®ä¾‹ï¼ˆå³ thisï¼‰ã€‚è¿™æ„å‘³ç€åœ¨åŒä¸€æ—¶é—´å†…ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„è¯¥ synchronized æ–¹æ³•ã€‚å…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰èƒ½è®¿é—®è¯¥æ–¹æ³•ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç”¨äºä¿æŠ¤å¯¹è±¡çº§åˆ«çš„èµ„æºã€‚</li><li>å—çº§åˆ«çš„ synchronizedï¼šå½“ synchronized ä¿®é¥°ä¸€ä¸ªä»£ç å—æ—¶ï¼Œå®ƒé”å®šçš„æ˜¯æ‹¬å·å†…æŒ‡å®šçš„å¯¹è±¡å®ä¾‹ã€‚è¿™æ„å‘³ç€åœ¨åŒä¸€æ—¶é—´å†…ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„è¯¥ synchronized ä»£ç å—ã€‚å…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰èƒ½è®¿é—®è¯¥ä»£ç å—ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç”¨äºä¿æŠ¤ç‰¹å®šçš„ä»£ç å—çº§åˆ«èµ„æºã€‚</li><li>å¯¹å˜é‡è¿›è¡ŒåŒæ­¥è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–çš„åŒæ­¥æœºåˆ¶ï¼Œå¦‚ä½¿ç”¨é”å¯¹è±¡æˆ–ä½¿ç”¨åŸå­ç±»ç­‰ã€‚ä½¿ç”¨é”å¯¹è±¡æ¥åŒæ­¥è®¿é—®å˜é‡çš„ç¤ºä¾‹ä»£ç ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>            count++;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>            <span class="hljs-keyword">return</span> count;<br>        &#125;<br>    &#125;<br><span class="hljs-comment">//å¯¹countçš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„</span><br></code></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ?"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ?</h2><p>çº¿ç¨‹æ± æ˜¯ä¸€ç§ç®¡ç†å’Œé‡ç”¨çº¿ç¨‹çš„æŠ€æœ¯ï¼Œç”¨äºæé«˜å¤šçº¿ç¨‹åº”ç”¨çš„æ€§èƒ½å’Œæ•ˆç‡</p><p>é¦–å…ˆå®ƒå­˜åœ¨çº¿ç¨‹å®¹é‡ï¼Œå¯ä»¥è®¾å®šçº¿ç¨‹åˆ†é…çš„æ•°é‡</p><p>å°†é¢„å…ˆåˆ›å»ºçš„çº¿ç¨‹æ”¾å…¥æ± ä¸­ç®¡ç†ï¼Œå¹¶é‡ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡</p><p>é¿å…é¢‘ç¹çš„çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯ </p><p>é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œä¼šå¢åŠ è™šæ‹Ÿæœºçš„å›æ”¶é¢‘ç‡ï¼Œèµ„æºå¼€é”€ï¼Œé€ æˆæ€§èƒ½ä¸‹é™</p><p>è¿‡å¤šåˆ†é…çº¿ç¨‹ä¼šé€ æˆå†…å­˜æº¢å‡º</p><h2 id="çº¿ç¨‹çš„é˜»å¡æ˜¯ä»€ä¹ˆï¼ˆæˆ‘è‡ªå·±ä¸æ‡‚çš„é—®é¢˜ï¼‰"><a href="#çº¿ç¨‹çš„é˜»å¡æ˜¯ä»€ä¹ˆï¼ˆæˆ‘è‡ªå·±ä¸æ‡‚çš„é—®é¢˜ï¼‰" class="headerlink" title="çº¿ç¨‹çš„é˜»å¡æ˜¯ä»€ä¹ˆï¼ˆæˆ‘è‡ªå·±ä¸æ‡‚çš„é—®é¢˜ï¼‰"></a>çº¿ç¨‹çš„é˜»å¡æ˜¯ä»€ä¹ˆï¼ˆæˆ‘è‡ªå·±ä¸æ‡‚çš„é—®é¢˜ï¼‰</h2><p>çº¿ç¨‹çš„é˜»å¡æŒ‡çš„æ˜¯çº¿ç¨‹è¢«æš‚æ—¶æŒ‚èµ·æˆ–åœæ­¢æ‰§è¡Œï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚å½“çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾ CPU èµ„æºï¼Œè®©å…¶ä»–å¯è¿è¡Œçº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚</p><p>çº¿ç¨‹å¯ä»¥å› ä¸ºå¤šç§åŸå› è€Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ol><li>ç­‰å¾…é˜»å¡ï¼šå½“çº¿ç¨‹è°ƒç”¨ <code>Object.wait()</code>ã€<code>Thread.join()</code> æˆ– <code>LockSupport.park()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿›å…¥ç­‰å¾…é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ç›¸åº”çš„ <code>notify()</code>ã€<code>notifyAll()</code> æˆ– <code>unpark()</code> æ–¹æ³•æ¥å”¤é†’å®ƒã€‚</li><li>åŒæ­¥é˜»å¡ï¼šå½“çº¿ç¨‹å°è¯•è·å–ä¸€ä¸ªé”å¯¹è±¡æ—¶ï¼Œå¦‚æœé”å¯¹è±¡å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¿›å…¥åŒæ­¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°é”å¯¹è±¡è¢«é‡Šæ”¾ã€‚</li><li>ç¡çœ é˜»å¡ï¼šå½“çº¿ç¨‹è°ƒç”¨ <code>Thread.sleep()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿›å…¥ç¡çœ é˜»å¡çŠ¶æ€ï¼Œæš‚åœæ‰§è¡Œä¸€æ®µæŒ‡å®šçš„æ—¶é—´ã€‚</li><li>I&#x2F;O é˜»å¡ï¼šå½“çº¿ç¨‹è¿›è¡Œè¾“å…¥è¾“å‡ºæ“ä½œæ—¶ï¼Œå¦‚æœé‡åˆ°é˜»å¡çš„ I&#x2F;O æ“ä½œï¼ˆå¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰ï¼Œçº¿ç¨‹ä¼šè¿›å…¥ I&#x2F;O é˜»å¡çŠ¶æ€ï¼Œç›´åˆ° I&#x2F;O æ“ä½œå®Œæˆã€‚</li><li>æ¡ä»¶é˜»å¡ï¼šå½“çº¿ç¨‹è°ƒç”¨ <code>Lock</code> æ¥å£çš„ <code>Condition.await()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿›å…¥æ¡ä»¶é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ç›¸åº”çš„ <code>Condition.signal()</code> æˆ– <code>Condition.signalAll()</code> æ–¹æ³•æ¥å”¤é†’å®ƒã€‚</li></ol><p>çº¿ç¨‹çš„é˜»å¡çŠ¶æ€æ˜¯ä¸´æ—¶çš„ï¼Œä¸€æ—¦æ»¡è¶³äº†ç›¸åº”çš„æ¡ä»¶ï¼Œçº¿ç¨‹å°±ä¼šè¢«å”¤é†’å¹¶ç»§ç»­æ‰§è¡Œã€‚åœ¨é˜»å¡æœŸé—´ï¼Œçº¿ç¨‹ä¸ä¼šå ç”¨ CPU èµ„æºï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p><h2 id="springbootè‡ªåŠ¨è£…é…åŸç†"><a href="#springbootè‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="springbootè‡ªåŠ¨è£…é…åŸç†"></a>springbootè‡ªåŠ¨è£…é…åŸç†</h2><p>é€šè¿‡@SpringbootApplicationå®ç°</p><p>@SpringbootApplication æ˜¯ä¸‰ä¸ªæ³¨è§£çš„é›†åˆ</p><p>@EnableAutoConfiguration  </p><p>@ComponentScan</p><h1 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h1><p><strong>HashMapï¼ˆå¤šçº¿ç¨‹æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼‰</strong></p><p>â€‹åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼ŒåŒæ—¶Aã€Bä¸¤ä¸ªçº¿ç¨‹èµ°åˆ°createEntry()æ–¹æ³•ä¸­ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªçº¿ç¨‹ä¸­æ’å…¥çš„å…ƒç´ hashå€¼ç›¸åŒï¼ŒbucketIndexå€¼ä¹Ÿç›¸åŒï¼Œé‚£ä¹ˆæ— è®ºAçº¿ç¨‹å…ˆæ‰§è¡Œï¼Œè¿˜æ˜¯Bçº¿ç¨‹å…ˆè¢«æ‰§è¡Œï¼Œæœ€ç»ˆéƒ½ä¼š2ä¸ªå…ƒç´ å…ˆåå‘é“¾è¡¨çš„å¤´éƒ¨æ’å…¥ï¼Œå¯¼è‡´äº’ç›¸è¦†ç›–ï¼Œè‡´ä½¿å…¶ä¸­1ä¸ªçº¿ç¨‹ä¸­çš„æ•°æ®ä¸¢å¤±ã€‚è¿™æ ·å°±é€ æˆäº†HashMapçš„çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°æ®çš„ä¸ä¸€è‡´ï¼›æ›´è¦å‘½çš„æ˜¯ï¼ŒHashMapåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è¿˜ä¼šå‡ºç°æ­»å¾ªç¯çš„å¯èƒ½ï¼Œé€ æˆCPUå ç”¨ç‡å‡é«˜ï¼Œå¯¼è‡´ç³»ç»Ÿå¡æ­»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å‘é“¾è¡¨å¤´éƒ¨æ’å…¥å…ƒç´ ï¼šåœ¨æ•°ç»„çš„æŸä¸€ä¸ªè§’æ ‡ä¸‹å½¢æˆé“¾è¡¨ç»“æ„ï¼›</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">createEntry</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, K key, V value, <span class="hljs-type">int</span> bucketIndex)</span> &#123;<br>    Entry&lt;K,V&gt; e = table[bucketIndex];<br>    table[bucketIndex] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>&lt;&gt;(hash, key, value, e);<br>    size++;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>HashTableæ•ˆç‡ä½</strong></p><p>â€‹åœ¨HashTableä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½åŠ ä¸Šäº†synchronizedé”ï¼Œç”¨é”æ¥å®ç°çº¿ç¨‹çš„å®‰å…¨æ€§ã€‚ç”±äº***<font color="red">synchronized</font>*** é”åŠ åœ¨äº†HashTableçš„æ¯ä¸€ä¸ªæ–¹æ³•ä¸Šï¼Œæ‰€ä»¥è¿™ä¸ªé”å°±æ˜¯HashTableæœ¬èº«â€“thisã€‚é‚£ä¹ˆï¼Œå¯æƒ³è€ŒçŸ¥HashTableçš„æ•ˆç‡æ˜¯å¦‚ä½•ï¼Œå®‰å…¨æ˜¯ä¿è¯äº†ï¼Œä½†æ˜¯æ•ˆç‡å´æŸå¤±äº†ã€‚</p><p>æ— è®ºæ‰§è¡Œå“ªä¸ªæ–¹æ³•ï¼Œæ•´ä¸ªå“ˆå¸Œè¡¨éƒ½ä¼šè¢«é”ä½ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾æ‰€ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰ä¼šæ‰§è¡Œã€‚æ— è®ºä½ æ˜¯è°ƒç”¨getæ–¹æ³•ï¼Œè¿˜æ˜¯putæ–¹æ³•çš†æ˜¯å¦‚æ­¤ï¼›</p><p><strong>ConcurrentHashMapå–èƒœ</strong></p><ul><li><p>ç”±***<font color="red">Segment</font><em><strong>å’Œ</strong></em><font color="red">HashEntry</font>***ä¸¤ä¸ªæ•°ç»„ç»„æˆã€‚å…¶ä¸­Segmentèµ·åˆ°äº†åŠ é”åŒæ­¥çš„ä½œç”¨ï¼Œè€ŒHashEntryåˆ™èµ·åˆ°äº†å­˜å‚¨K,Vé”®å€¼å¯¹çš„ä½œç”¨ã€‚</p></li><li><p>åœ¨ConcurrentHashMapä¸­ï¼Œæ¯ä¸€ä¸ªConcurrentHashMapéƒ½åŒ…å«äº†ä¸€ä¸ªSegmentæ•°ç»„ï¼Œåœ¨Segmentæ•°ç»„ä¸­æ¯ä¸€ä¸ªSegmentå¯¹è±¡åˆ™åˆåŒ…å«äº†ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œè€Œåœ¨HashEntryæ•°ç»„ä¸­ï¼Œæ¯ä¸€ä¸ªHashEntryå¯¹è±¡ä¿å­˜K-Væ•°æ®çš„åŒæ—¶åˆå½¢æˆäº†é“¾è¡¨ç»“æ„ï¼Œæ­¤æ—¶ä¸HashMapç»“æ„ç›¸åŒã€‚</p></li><li><p>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªSegmentå¯¹è±¡å®ˆæŠ¤äº†ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œå½“å¯¹ConcurrentHashMapä¸­çš„å…ƒç´ ä¿®æ”¹æ—¶ï¼Œåœ¨è·å–åˆ°å¯¹åº”çš„Segmentæ•°ç»„è§’æ ‡åï¼Œéƒ½ä¼šå¯¹æ­¤Segmentå¯¹è±¡åŠ é”ï¼Œä¹‹åå†å»æ“ä½œåé¢çš„HashEntryå…ƒç´ ï¼Œè¿™æ ·æ¯ä¸€ä¸ªSegmentå¯¹è±¡ä¸‹ï¼Œéƒ½å½¢æˆäº†ä¸€ä¸ªå°å°çš„HashMapï¼Œåœ¨ä¿è¯æ•°æ®å®‰å…¨æ€§çš„åŒæ—¶ï¼Œåˆæé«˜äº†åŒæ­¥çš„æ•ˆç‡ã€‚åªè¦ä¸æ˜¯æ“ä½œåŒä¸€ä¸ªSegmentå¯¹è±¡çš„è¯ï¼Œå°±ä¸ä¼šå‡ºç°çº¿ç¨‹ç­‰å¾…çš„é—®é¢˜ï¼</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®åº“è®¾è®¡</title>
    <link href="/2023/09/14/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/"/>
    <url>/2023/09/14/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h1><h2 id="æ³¨æ„äº‹é¡¹ï¼š"><a href="#æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="æ³¨æ„äº‹é¡¹ï¼š"></a>æ³¨æ„äº‹é¡¹ï¼š</h2><ol><li>æ•°æ®åº“è®¾è®¡åº”è¯¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œï¼Œäº†è§£ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®å…³ç³»ã€‚</li><li>è€ƒè™‘æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œä½¿ç”¨åˆé€‚çš„çº¦æŸå’ŒéªŒè¯æœºåˆ¶ã€‚</li><li>è€ƒè™‘æ•°æ®çš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ï¼Œé¿å…æ•°æ®å†—ä½™å’Œè¿‡åº¦è§„èŒƒåŒ–ã€‚</li><li>é€‰æ‹©é€‚å½“çš„æ•°æ®ç±»å‹å’Œç´¢å¼•ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>è€ƒè™‘å®‰å…¨æ€§å’Œæƒé™æ§åˆ¶ï¼Œé™åˆ¶å¯¹æ•æ„Ÿæ•°æ®çš„è®¿é—®ã€‚</li></ol><h2 id="åŸåˆ™ï¼š"><a href="#åŸåˆ™ï¼š" class="headerlink" title="åŸåˆ™ï¼š"></a>åŸåˆ™ï¼š</h2><ol><li>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼šæ¯ä¸ªè¡¨åº”è¯¥åªåŒ…å«ä¸ç‰¹å®šå®ä½“æˆ–æ¦‚å¿µç›¸å…³çš„æ•°æ®ã€‚</li><li>æ•°æ®å®Œæ•´æ€§åŸåˆ™ï¼šç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ï¼Œä½¿ç”¨ä¸»é”®ã€å¤–é”®å’Œçº¦æŸç­‰æœºåˆ¶ã€‚</li><li>æ•°æ®ä¸€è‡´æ€§åŸåˆ™ï¼šé¿å…å†—ä½™å’Œä¸ä¸€è‡´çš„æ•°æ®ï¼Œé€šè¿‡è§„èŒƒåŒ–å’Œåˆé€‚çš„å…³ç³»å»ºç«‹å…³è”ã€‚</li><li>æ€§èƒ½ä¼˜åŒ–åŸåˆ™ï¼šè€ƒè™‘æŸ¥è¯¢é¢‘ç‡å’Œå¤æ‚æ€§ï¼Œä½¿ç”¨åˆé€‚çš„ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯ã€‚</li></ol><p>ã€€## èŒƒå¼ï¼š </p><p>èŒƒå¼æ˜¯ä¸€ç»„è§„èŒƒåŒ–åŸåˆ™ï¼Œç”¨äºè®¾è®¡æ•°æ®åº“æ¨¡å¼ï¼Œä»¥å‡å°‘æ•°æ®å†—ä½™å’Œæé«˜æ•°æ®ä¸€è‡´æ€§ã€‚å¸¸è§çš„èŒƒå¼æœ‰ï¼š</p><ol><li>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šç¡®ä¿æ¯ä¸ªè¡¨çš„æ¯ä¸ªåˆ—éƒ½æ˜¯åŸå­çš„ï¼Œå³ä¸å¯å†åˆ†ã€‚</li><li>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šåœ¨1NFçš„åŸºç¡€ä¸Šï¼Œç¡®ä¿æ¯ä¸ªéä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®ã€‚</li><li>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šåœ¨2NFçš„åŸºç¡€ä¸Šï¼Œç¡®ä¿æ¯ä¸ªéä¸»é”®åˆ—ä¹‹é—´æ²¡æœ‰ä¼ é€’ä¾èµ–å…³ç³»ã€‚</li></ol><h2 id="æ•°æ®åº“äº‹åŠ¡ï¼š"><a href="#æ•°æ®åº“äº‹åŠ¡ï¼š" class="headerlink" title="æ•°æ®åº“äº‹åŠ¡ï¼š"></a>æ•°æ®åº“äº‹åŠ¡ï¼š</h2><p>æ•°æ®åº“äº‹åŠ¡æ˜¯ä¸€ç»„æ•°æ®åº“æ“ä½œçš„é€»è¾‘å•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚äº‹åŠ¡å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼ˆACIDï¼‰ï¼š</p><ol><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¼€å§‹å’Œç»“æŸæ—¶ï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸåº”è¯¥ä¿æŒä¸€è‡´ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡åº”è¯¥ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå…¶ç»“æœåº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</li></ol><p><font color='red'>äº‹åŠ¡å¯ä»¥ä½¿ç”¨æ•°æ®åº“çš„äº‹åŠ¡æ§åˆ¶è¯­å¥ï¼ˆå¦‚BEGINã€COMMITå’ŒROLLBACKï¼‰æ¥ç®¡ç†ã€‚åœ¨æ•°æ®åº“è®¾è®¡ä¸­ï¼Œè€ƒè™‘åˆ°æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„ä½¿ç”¨éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŒæ—¶ä¿®æ”¹å¤šä¸ªè¡¨çš„æƒ…å†µä¸‹ã€‚é€šè¿‡ä½¿ç”¨äº‹åŠ¡ï¼Œå¯ä»¥ç¡®ä¿æ‰€æœ‰ç›¸å…³æ“ä½œéƒ½èƒ½æˆåŠŸæˆ–å›æ»šï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</font></p><p><strong>è‡ªå…³è”è¡¨ï¼š</strong></p><p><strong>æ ‘å½¢ç»“æ„è¡¨</strong></p><p>æ¯”å¦‚åˆ†ç±»è¡¨ï¼Œä¸€ä¸ªåˆ†ç±»ä¸‹æœ‰å¤šä¸ªå­åˆ†ç±»ï¼Œä½¿ç”¨è‡ªå…³è”è¡¨è®¾è®¡</p><table><thead><tr><th>id</th><th>category_name</th><th>parent_id</th><th>is_delete</th></tr></thead><tbody><tr><td>1</td><td>å•†å“</td><td></td><td>0</td></tr><tr><td>2</td><td>æ•°ç </td><td>1</td><td>0</td></tr><tr><td>3</td><td>æ‰‹æœº</td><td>2</td><td>0</td></tr><tr><td>4</td><td>åä¸ºæ‰‹æœº</td><td>3</td><td>0</td></tr><tr><td>5</td><td>åä¸ºnoteç³»åˆ—</td><td>4</td><td>0</td></tr><tr><td>6</td><td>åä¸ºnote 9s</td><td>5</td><td>0</td></tr></tbody></table><p><strong>ä¸€å¯¹å¤šç”¨ä¸»å­è¡¨ï¼š</strong></p><p>ä¸€èˆ¬çš„idå…³è”è¡¨</p><p><strong>å¤šå¯¹å¤šç”¨å…³è”å…³ç³»è¡¨</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxï¼ˆubuntuï¼‰å®‰è£…rabbitmq</title>
    <link href="/2023/09/14/Linux%EF%BC%88ubuntu%EF%BC%89%E5%AE%89%E8%A3%85rabbitmq/"/>
    <url>/2023/09/14/Linux%EF%BC%88ubuntu%EF%BC%89%E5%AE%89%E8%A3%85rabbitmq/</url>
    
    <content type="html"><![CDATA[<h1 id="Linuxï¼ˆubuntuï¼‰å®‰è£…rabbitmq"><a href="#Linuxï¼ˆubuntuï¼‰å®‰è£…rabbitmq" class="headerlink" title="Linuxï¼ˆubuntuï¼‰å®‰è£…rabbitmq"></a>Linuxï¼ˆubuntuï¼‰å®‰è£…rabbitmq</h1><p>å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/qq_45173404/article/details/116429302">RabbitMQè¶…è¯¦ç»†å®‰è£…æ•™ç¨‹ï¼ˆLinuxï¼‰_rabbitmqå®‰è£…_Baret-Hçš„åšå®¢-CSDNåšå®¢</a></p><h2 id="ä¸‹è½½ä¾èµ–ç¯å¢ƒ"><a href="#ä¸‹è½½ä¾èµ–ç¯å¢ƒ" class="headerlink" title="ä¸‹è½½ä¾èµ–ç¯å¢ƒ"></a>ä¸‹è½½ä¾èµ–ç¯å¢ƒ</h2><p>ä¾èµ–ç¯å¢ƒï¼šErlangï¼ˆä¸€é—¨è¯­è¨€ï¼‰</p><p>erlangä¸‹è½½ï¼š<a href="https://www.rabbitmq.com/which-erlang.html">https://www.rabbitmq.com/which-erlang.html</a></p><p>rabbitä¸‹è½½ï¼š<a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p><p>å…¼å®¹ï¼š</p><table><thead><tr><th>rabbitmqç‰ˆæœ¬</th><th>Erlangç‰ˆæœ¬</th></tr></thead><tbody><tr><td>3.12.4 3.12.3 3.12.2 3.12.1 3.12.0</td><td>æœ€ä½25.0ï¼Œæœ€é«˜26.0</td></tr></tbody></table><p>é€‰æ‹©: </p><table><thead><tr><th>rabbitmqç‰ˆæœ¬</th><th>Erlangç‰ˆæœ¬</th></tr></thead><tbody><tr><td>3.12.2</td><td>25.3.2.5</td></tr></tbody></table><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><blockquote><p>ä¸‹è½½å¥½ä½¿ç”¨xshellä¸Šä¼ </p></blockquote><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230827160132935.png" alt="image-20230827160132935"></p><blockquote><p>å®‰è£…erlang</p></blockquote><blockquote><p>æ‰§è¡Œè§£å‹å‘½ä»¤ <code>rpm -Uvh erlang-25.0.4-1.el8.x86_64.rpm</code></p></blockquote><blockquote><p>å®‰è£…å‘½ä»¤ï¼š <code>apt install erlang</code></p></blockquote><blockquote><p>å®‰è£…rabbitmq</p></blockquote><blockquote><p>å®‰è£…æ’ä»¶ï¼š<code>apt install -y socat</code></p></blockquote><blockquote><p> æ‰§è¡Œï¼š <code>dpkg -i rabbitmq-server_3.12.3-1_all.deb</code> </p></blockquote><p><strong>å¦‚æœè¿™ä¸€æ­¥æŠ¥é”™ç›´æ¥æ‰§è¡Œï¼š</strong></p><ul><li><code>add-apt-repository ppa:rabbitmq/rabbitmq-erlang-25</code></li><li><code>apt --fix-broken install</code></li></ul><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">//æŠ¥é”™<br>You might want <span class="hljs-keyword">to</span> run <span class="hljs-symbol">&#x27;apt</span> <span class="hljs-comment">--fix-broken install&#x27; to correct these.</span><br>The following packages have unmet dependencies:<br> rabbitmq-server : Depends: erlang-base (&gt;= <span class="hljs-number">1</span>:<span class="hljs-number">25.0</span>) but <span class="hljs-number">1</span>:<span class="hljs-number">22.2</span>.<span class="hljs-number">7</span>+dfsg-<span class="hljs-number">1</span>ubuntu0.<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> be installed <span class="hljs-keyword">or</span> erlang-base-hipe (&gt;= <span class="hljs-number">1</span>:<span class="hljs-number">25.0</span>) but it <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>dpkg: <span class="hljs-literal">error</span> processing <span class="hljs-keyword">package</span> rabbitmq-server (<span class="hljs-comment">--install):  </span><br></code></pre></td></tr></table></figure><ul><li>æ‰§è¡Œï¼š<code>add-apt-repository ppa:rabbitmq/rabbitmq-erlang-25</code></li></ul><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">//æŠ¥é”™<br>You might want <span class="hljs-keyword">to</span> run <span class="hljs-symbol">&#x27;apt</span> <span class="hljs-comment">--fix-broken install&#x27; to correct these.</span><br>The following packages have unmet dependencies:<br> rabbitmq-server : Depends: erlang-base (&gt;= <span class="hljs-number">1</span>:<span class="hljs-number">25.0</span>) but <span class="hljs-number">1</span>:<span class="hljs-number">22.2</span>.<span class="hljs-number">7</span>+dfsg-<span class="hljs-number">1</span>ubuntu0.<span class="hljs-number">2</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> be installed <span class="hljs-keyword">or</span> erlang-base-hipe (&gt;= <span class="hljs-number">1</span>:<span class="hljs-number">25.0</span>) but it <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> going <span class="hljs-keyword">to</span> be installed<br>dpkg: <span class="hljs-literal">error</span> processing <span class="hljs-keyword">package</span> rabbitmq-server (<span class="hljs-comment">--install):                          </span><br></code></pre></td></tr></table></figure><ul><li>è§£å†³ï¼š <code>apt --fix-broken install</code></li><li>æœ«å°¾å‡ºç°å¦‚ä¸‹æç¤ºï¼Œå³ä¸ºå®‰è£…å®Œæˆ</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Adding <span class="hljs-keyword">group</span> <span class="hljs-title">`rabbitmq</span>&#x27; (GID <span class="hljs-number">136</span>) ...<br>Done.<br>Adding system <span class="hljs-keyword">user</span> <span class="hljs-title">`rabbitmq</span>&#x27; (UID <span class="hljs-number">130</span>) ...<br>Adding new <span class="hljs-keyword">user</span> <span class="hljs-title">`rabbitmq</span>&#x27; (UID <span class="hljs-number">130</span>) with <span class="hljs-keyword">group</span> <span class="hljs-title">`rabbitmq</span>&#x27; ...<br>Not creating home directory `/var/lib/rabbitmq&#x27;.<br>Created symlink /etc/systemd/system/multi-user.target.wants/rabbitmq-server.service â†’ /lib/systemd/system/rabbitmq-server.service.<br>//å®‰è£…æˆåŠŸ<br></code></pre></td></tr></table></figure><p>åˆ°æ­¤å®‰è£…å®Œæˆ</p><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>æŒ‰é¡ºåºæ‰§è¡Œä¸‹åˆ—æ“ä½œ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk">rabbitmq-server -detached  <span class="hljs-regexp">//</span>å¼€æœºè‡ªå¯åå°è¿è¡Œ<br><br>systemctl restart rabbitmq-server<span class="hljs-regexp">//</span>å¯åŠ¨rabbitmq<br><br>systemctl status rabbitmq-server <span class="hljs-regexp">//</span>æŸ¥çœ‹çŠ¶æ€<br><br>sudo rabbitmq-plugins enable rabbitmq_management <span class="hljs-regexp">//</span>æ·»åŠ webç®¡ç†UIæ’ä»¶<br><br>systemctl restart rabbitmq-server <span class="hljs-regexp">//</span>é‡å¯<br><br>rabbitmqctl add_user lcy  <span class="hljs-number">158574</span> <br><span class="hljs-regexp">//</span>ä¸ºè¿œç¨‹è®¿é—®åˆ†é…ä¸€ä¸ªè´¦æˆ· ç”¨æˆ·å:lcy,å¯†ç : <span class="hljs-number">158574</span>,å®˜æ–¹é»˜è®¤guest,åªèƒ½æœ¬æœºè®¿é—®<br><br>rabbitmqctl set_user_tags lcy administrator <span class="hljs-regexp">//</span>ä¸ºç”¨æˆ·èµ‹äºˆæƒé™<br>- administratorï¼šå¯ä»¥ç™»å½•æ§åˆ¶å°ã€æŸ¥çœ‹æ‰€æœ‰ä¿¡æ¯ã€å¹¶å¯¹rabbitmqè¿›è¡Œç®¡ç†<br>- monToringï¼šç›‘æ§è€…ï¼›ç™»å½•æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ‰€æœ‰ä¿¡æ¯<br>- policymakerï¼šç­–ç•¥åˆ¶å®šè€…ï¼›ç™»å½•æ§åˆ¶å°æŒ‡å®šç­–ç•¥<br>- managmentï¼šæ™®é€šç®¡ç†å‘˜ï¼›ç™»å½•æ§åˆ¶<br><br><span class="hljs-regexp">//</span>ä¸ºç”¨æˆ·æ·»åŠ èµ„æºæƒé™(æˆäºˆè®¿é—®è™šæ‹Ÿæœºæ ¹èŠ‚ç‚¹çš„æ‰€æœ‰æƒé™)<br>rabbitmqctl set_permissions -p / lcy <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br></code></pre></td></tr></table></figure><h2 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h2><p>è®¾ç½®å®Œæˆåè®¿é—®ï¼š<a href="http://192.168.161.128:15672/">http://192.168.161.128:15672</a></p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230827160802630.png" alt="image-20230827160802630"></p><h2 id="Javaä»£ç ç¤ºä¾‹"><a href="#Javaä»£ç ç¤ºä¾‹" class="headerlink" title="Javaä»£ç ç¤ºä¾‹"></a>Javaä»£ç ç¤ºä¾‹</h2><p>mavenä»“åº“ï¼š<a href="https://mvnrepository.com/artifact/com.rabbitmq/amqp-client/5.16.0">Maven Repository: com.rabbitmq Â» amqp-client Â» 5.16.0 (mvnrepository.com)</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.rabbitmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>amqp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.16.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        factory.setHost(<span class="hljs-string">&quot;192.168.161.128&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;lcy&quot;</span>); <br>    <span class="hljs-comment">//æˆ‘è¿™é‡Œæ˜¯æ–°åŠ äº†ä¸€ä¸ªç”¨æˆ·ç®¡ç†ï¼Œæ‰€ä»¥è¦è®¾ç½®ç”¨æˆ·åï¼Œå¯†ç </span><br>    <span class="hljs-comment">//é»˜è®¤çš„ï¼Œæœ¬æœºçš„ä¸ç”¨åŠ ã€‚</span><br>        factory.setPassword(<span class="hljs-string">&quot;158574&quot;</span>);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection(); <span class="hljs-comment">//åˆ›å»ºè¿æ¥ Connection</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>        channel.queueDeclare(*QUEUE_NAME*,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br>        System.*out*.println(<span class="hljs-string">&quot;wait for message&quot;</span>);<br>        <span class="hljs-comment">//å®šä¹‰äº†å¦‚ä½•å¤„ç†æ¶ˆæ¯</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, delivery) -&gt; &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(delivery.getBody(), StandardCharsets.*UTF_8*);<br>           System.*out*.println(<span class="hljs-string">&quot;receive message:&quot;</span> + message);<br><br>       &#125;;<br>        <span class="hljs-comment">//æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¼šæŒç»­é˜»å¡</span><br><span class="hljs-comment">//        queueâ€”â€”è‡ªåŠ¨åº”ç­”é˜Ÿåˆ—çš„åç§°â€”â€”å¦‚æœæœåŠ¡å™¨è®¤ä¸ºæ¶ˆæ¯ä¸€æ—¦å‘é€å°±è¢«ç¡®è®¤ï¼Œåˆ™ä¸ºtrue;å¦‚æœæœåŠ¡å™¨æœŸæœ›æ˜¾å¼ç¡®è®¤ï¼Œåˆ™ä¸ºfalseã€‚</span><br><span class="hljs-comment">//        deliverCallback -æ¶ˆæ¯ä¼ é€’æ—¶çš„å›è°ƒã€‚</span><br><span class="hljs-comment">//        cancelCallback -å–æ¶ˆæ¶ˆè´¹è€…æ—¶çš„å›è°ƒ</span><br>        channel.basicConsume(*QUEUE_NAME*, <span class="hljs-literal">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç”Ÿäº§è€…ï¼ˆproducerï¼‰"><a href="#ç”Ÿäº§è€…ï¼ˆproducerï¼‰" class="headerlink" title="ç”Ÿäº§è€…ï¼ˆproducerï¼‰"></a><strong>ç”Ÿäº§è€…ï¼ˆproducerï¼‰</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> String *QUEUE_NAME* = <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] argv)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        factory.setHost(<span class="hljs-string">&quot;192.168.161.128&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;lcy&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;158574&quot;</span>);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection(); <span class="hljs-comment">//åˆ›å»ºè¿æ¥ Connection</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br>        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span><br>        channel.queueDeclare(*QUEUE_NAME*,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>);<br>        System.*out*.println(<span class="hljs-string">&quot;wait for message&quot;</span>);<br>        <span class="hljs-comment">//å®šä¹‰äº†å¦‚ä½•å¤„ç†æ¶ˆæ¯</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, delivery) -&gt; &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(delivery.getBody(), StandardCharsets.*UTF_8*);<br>            System.*out*.println(<span class="hljs-string">&quot;receive message:&quot;</span> + message);<br><br>        &#125;;<br>        <span class="hljs-comment">//æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¼šæŒç»­é˜»å¡</span><br><span class="hljs-comment">//        queueâ€”â€”è‡ªåŠ¨åº”ç­”é˜Ÿåˆ—çš„åç§°â€”â€”å¦‚æœæœåŠ¡å™¨è®¤ä¸ºæ¶ˆæ¯ä¸€æ—¦å‘é€å°±è¢«ç¡®è®¤ï¼Œåˆ™ä¸ºtrue;å¦‚æœæœåŠ¡å™¨æœŸæœ›æ˜¾å¼ç¡®è®¤ï¼Œåˆ™ä¸ºfalseã€‚</span><br><span class="hljs-comment">//        deliverCallback -æ¶ˆæ¯ä¼ é€’æ—¶çš„å›è°ƒã€‚</span><br><span class="hljs-comment">//        cancelCallback -å–æ¶ˆæ¶ˆè´¹è€…æ—¶çš„å›è°ƒ</span><br>        channel.basicConsume(*QUEUE_NAME*, <span class="hljs-literal">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å‘å¸ƒè®¢é˜…:</strong></p><p><strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ï½Šï½ï½–ï½">channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);<br></code></pre></td></tr></table></figure><blockquote><p><code>channel.basicAck()</code> æ–¹æ³•ç”¨äºç¡®è®¤æ¶ˆè´¹è€…å·²ç»æˆåŠŸå¤„ç†äº†ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>deliveryTag</code>ï¼Œè¡¨ç¤ºè¦ç¡®è®¤çš„æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ã€‚è€Œç¬¬äºŒä¸ªå‚æ•° <code>multiple</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šæ˜¯å¦åŒæ—¶ç¡®è®¤å¤šä¸ªæ¶ˆæ¯ã€‚</p></blockquote><blockquote><p>å½“ <code>multiple</code> å‚æ•°ä¸º <code>false</code> æ—¶ï¼Œåªç¡®è®¤å½“å‰æŒ‡å®šçš„ <code>deliveryTag</code> æ‰€ä»£è¡¨çš„æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªç¡®è®¤ä¸€æ¡æ¶ˆæ¯ã€‚</p></blockquote><blockquote><p>å½“ <code>multiple</code> å‚æ•°ä¸º <code>true</code> æ—¶ï¼Œé™¤äº†ç¡®è®¤å½“å‰æŒ‡å®šçš„ <code>deliveryTag</code> æ‰€ä»£è¡¨çš„æ¶ˆæ¯ï¼Œè¿˜ä¼šä¸€å¹¶ç¡®è®¤æ‰€æœ‰æ¯”å½“å‰ <code>deliveryTag</code> å°çš„æœªç¡®è®¤æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šç¡®è®¤å¤šæ¡æ¶ˆæ¯ã€‚</p></blockquote><blockquote><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°† <code>multiple</code> å‚æ•°è®¾ç½®ä¸º <code>false</code>ï¼Œåªç¡®è®¤å½“å‰å¤„ç†çš„æ¶ˆæ¯å³å¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¶ˆæ¯æŒ‰é¡ºåºè¢«ç¡®è®¤ï¼Œé¿å…å‡ºç°æ¶ˆæ¯å¤„ç†é¡ºåºé”™ä¹±çš„é—®é¢˜ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">channel.basicNack(delivery.getEnvelope().getDeliveryTag(),<span class="hljs-literal">false</span>,<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><blockquote><p><code>channel.basicNack()</code> æ–¹æ³•ç”¨äºå¦å®šç¡®è®¤æ¶ˆæ¯çš„å¤„ç†ç»“æœã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>deliveryTag</code>ï¼Œè¡¨ç¤ºè¦å¦å®šç¡®è®¤çš„æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ã€‚è€Œç¬¬äºŒä¸ªå‚æ•° <code>multiple</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šæ˜¯å¦åŒæ—¶å¦å®šç¡®è®¤å¤šä¸ªæ¶ˆæ¯ã€‚ç¬¬ä¸‰ä¸ªå‚æ•° <code>requeue</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šæ˜¯å¦é‡æ–°å°†æ¶ˆæ¯æ”¾å›é˜Ÿåˆ—ã€‚</p><p>å½“ <code>multiple</code> å‚æ•°ä¸º <code>false</code> æ—¶ï¼Œåªå¦å®šç¡®è®¤å½“å‰æŒ‡å®šçš„ <code>deliveryTag</code> æ‰€ä»£è¡¨çš„æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªå¦å®šä¸€æ¡æ¶ˆæ¯ã€‚</p><p>å½“ <code>multiple</code> å‚æ•°ä¸º <code>true</code> æ—¶ï¼Œé™¤äº†å¦å®šç¡®è®¤å½“å‰æŒ‡å®šçš„ <code>deliveryTag</code> æ‰€ä»£è¡¨çš„æ¶ˆæ¯ï¼Œè¿˜ä¼šä¸€å¹¶å¦å®šæ‰€æœ‰æ¯”å½“å‰ <code>deliveryTag</code> å°çš„æœªç¡®è®¤æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šå¦å®šå¤šæ¡æ¶ˆæ¯ã€‚</p><p>å½“ <code>requeue</code> å‚æ•°ä¸º <code>true</code> æ—¶ï¼Œè¢«å¦å®šç¡®è®¤çš„æ¶ˆæ¯ä¼šé‡æ–°æ”¾å›é˜Ÿåˆ—ï¼Œç­‰å¾…é‡æ–°è¢«æ¶ˆè´¹ã€‚å½“ <code>requeue</code> å‚æ•°ä¸º <code>false</code> æ—¶ï¼Œè¢«å¦å®šç¡®è®¤çš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œä¸ä¼šé‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°† <code>multiple</code> å‚æ•°è®¾ç½®ä¸º <code>false</code>ï¼Œåªå¦å®šå½“å‰å¤„ç†çš„æ¶ˆæ¯å³å¯ã€‚è€Œ <code>requeue</code> å‚æ•°çš„å–å€¼æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚æ¥å†³å®šï¼Œæ˜¯å¦éœ€è¦å°†æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ç­‰å¾…é‡æ–°æ¶ˆè´¹ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">channel.basicReject(delivery.getEnvelope().getDeliveryTag(),<span class="hljs-literal">false</span>,<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p><strong>æ¶ˆæ¯è¿‡æœŸæœºåˆ¶</strong>ï¼šç»™æ¶ˆæ¯è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œmapä¸­è®¾ç½®å‚æ•°çš„valueå€¼å³å¯å®ç°</p><p>**æ­»ä¿¡é˜Ÿåˆ—:**å¤„ç†æ— æ³•å¤„ç†ï¼Œè¢«æ‹’ç»ï¼Œå®•æœºç­‰åŸå› é€ æˆçš„æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯</p>]]></content>
    
    
    
    <tags>
      
      <tag>å®‰è£…æ•™ç¨‹</tag>
      
      <tag>DEMO</tag>
      
      <tag>mq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AIGCæ™ºèƒ½åˆ†æå°åŠ©æ‰‹</title>
    <link href="/2023/09/14/AIGC%E6%99%BA%E8%83%BD%E5%88%86%E6%9E%90%E5%B0%8F%E5%8A%A9%E6%89%8B/"/>
    <url>/2023/09/14/AIGC%E6%99%BA%E8%83%BD%E5%88%86%E6%9E%90%E5%B0%8F%E5%8A%A9%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="AIGCé¡¹ç›®"><a href="#AIGCé¡¹ç›®" class="headerlink" title="AIGCé¡¹ç›®"></a>AIGCé¡¹ç›®</h1><h2 id="æ•°æ®åº“è¡¨è®¾è®¡ï¼š"><a href="#æ•°æ®åº“è¡¨è®¾è®¡ï¼š" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡ï¼š"></a>æ•°æ®åº“è¡¨è®¾è®¡ï¼š</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> aigc.user<br>(<br>    id            <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span><br>        <span class="hljs-keyword">primary</span> key,<br>    userName      <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·æ˜µç§°&#x27;</span>,<br>    userAccount   <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è´¦å·&#x27;</span>,<br>    userPassword  <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å¯†ç &#x27;</span>,<br>    userAvatar    <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                          <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·å¤´åƒ&#x27;</span>,<br>    userSignature <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åº§å³é“­&#x27;</span>,<br>    userPhone     <span class="hljs-type">varchar</span>(<span class="hljs-number">26</span>)                            <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ‰‹æœºå·&#x27;</span>,<br>    tags          <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                          <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ ‡ç­¾ json åˆ—è¡¨&#x27;</span>,<br>    userRole      <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;user&#x27;</span>            <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban&#x27;</span>,<br>    updateTime    datetime     <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete      tinyint      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span>,<br>    createTime    datetime     <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;ç”¨æˆ·&#x27;</span> <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br><br><span class="hljs-keyword">create</span> index idx_userAccount<br>    <span class="hljs-keyword">on</span> aigc.user (userAccount);<br><br><span class="hljs-comment">--</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> aigc.chart<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span><br>        <span class="hljs-keyword">primary</span> key,<br>    goal       text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ†æç›®æ ‡&#x27;</span>,<br>    name       <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>)                       <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å›¾è¡¨åç§°&#x27;</span>,<br>    chartData  text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å›¾è¡¨æ•°æ®&#x27;</span>,<br>    chartType  <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>)                       <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å›¾è¡¨ç±»å‹&#x27;</span>,<br>    status     tinyint  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;0: wait 1: running 2: succeed 3: failed&#x27;</span>,<br>    optMessage text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ‰§è¡Œè¿‡ç¨‹ä¿¡æ¯&#x27;</span>,<br>    genChart   text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”Ÿæˆçš„å›¾æ ‡ä¿¡æ¯&#x27;</span>,<br>    genResult  text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”Ÿæˆçš„åˆ†æç»“è®º&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete   tinyint  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;å›¾è¡¨ä¿¡æ¯è¡¨&#x27;</span> <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br><br><span class="hljs-comment">--</span><br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> aigc.user_blog<br>(<br>    id              <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;id&#x27;</span><br>        <span class="hljs-keyword">primary</span> key,<br>    userId          <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·id&#x27;</span>,<br>    avatar          <span class="hljs-type">varchar</span>(<span class="hljs-number">516</span>)                       <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« å›¾æ ‡æ ‡è¯†&#x27;</span>,<br>    title           <span class="hljs-type">varchar</span>(<span class="hljs-number">126</span>)                       <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ ‡é¢˜&#x27;</span>,<br>    blogDescription <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                      <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« ç®€è¿°&#x27;</span>,<br>    content         text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å†…å®¹&#x27;</span>,<br>    createTime      datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">null</span>,<br>    updateTime      datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete        tinyint  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;0:æœªåˆ é™¤,1:åˆ é™¤&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;æˆ‘çš„åšå®¢&#x27;</span>;<br><br><span class="hljs-comment">-- </span><br></code></pre></td></tr></table></figure><h2 id="é¡¹ç›®æ¶æ„å›¾"><a href="#é¡¹ç›®æ¶æ„å›¾" class="headerlink" title="é¡¹ç›®æ¶æ„å›¾"></a>é¡¹ç›®æ¶æ„å›¾</h2><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230914103633760.png" alt="image-20230914103633760"></p><h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><ul><li>springboot</li><li>rabbitmq</li><li>redis</li><li>redission(é™æµ)</li><li>çº¿ç¨‹æ± </li><li>ant design pro</li><li>echarts</li></ul><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>1.å®‰è£…å®˜æ–¹æ–‡æ¡£åˆå§‹åŒ–</p><p>2.è¿è¡Œ</p><p>3.æäº¤ä»£ç </p><p>ç§»é™¤å¤šä½™çš„é…ç½®</p><p>ç§»é™¤å›½é™…åŒ–æŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">fatal: detected dubious ownership in repository at &#x27;D:/Front/AIGC_frontend&#x27;<br>&#x27;D:/Front/AIGC_frontend&#x27; is owned by:<br>        &#x27;S-1-5-32-544&#x27;<br>but the current user is:<br>        &#x27;S-1-5-21-2792808732-2295366469-2416382537-1001&#x27;<br>To add an exception for this directory, call:<br>git config --global --add safe.directory D:/Front/AIGC_frontend<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global --add safe.directory D:/Front/AIGC_frontend<br><br>è§£å†³å¯åŠ¨æŠ¥é”™<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Error: .eslintrc.js Â» /front-end/ant-app-v6/node_modules/@umijs/lint/dist/config/eslint/index.js:<br>Environment key &quot;es2022&quot; is unknown<br></code></pre></td></tr></table></figure><p>è§£å†³ï¼š</p><ol><li><p><code>yarn add eslint-config-prettier</code></p></li><li><p><code>yarn add eslint-plugin-unicorn</code></p></li><li><pre><code class="java">//æ‰¾åˆ°ä»¥ä¸‹ç›®å½•çš„æ–‡ä»¶node_modules/@umijs/lint/dist/config/eslint/index.jsæ³¨é‡Šæ‰ // es2022: true<figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><br>   <br><br>åç«¯åˆå§‹åŒ–<br><br>**Swaggerå¯åŠ¨æŠ¥é”™**<br><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">è§£å†³ :é«˜ç‰ˆæœ¬<span class="hljs-title class_">SpringBoot</span>æ•´åˆ<span class="hljs-title class_">Swagger</span> å¯åŠ¨æŠ¥é”™<span class="hljs-title class_">Failed</span> to start bean <span class="hljs-string">&#x27;documentationPluginsBootstrapper&#x27;</span> é—®é¢˜</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">ä¸€ã€æ§åˆ¶å°æŠ¥é”™ä¿¡æ¯</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">äºŒã€ä¸¤ç§è§£å†³åŠæ³•</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">1</span>ã€é…ç½®<span class="hljs-title class_">WebMvcConfigurer</span>.<span class="hljs-property">java</span></span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">2</span>ã€é…ç½®æ–‡ä»¶æ·»åŠ spring.<span class="hljs-property">mvc</span>.<span class="hljs-property">pathmatch</span>.<span class="hljs-property">matching</span>-strategy=ant_path_matcher</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">ä¸‰ã€é¡¹ç›®å¯åŠ¨</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">å››ã€swaggerè®¿é—®ï¼Œ<span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:8080/doc.html</span></span><br><br>**è§£å†³ç«¯å£å·è¢«å ç”¨é—®é¢˜**<br><br>cmdçª—å£è¿è¡Œ: `netsh interface ipv4 show excludedportrange protocol=tcp`<br><br>è®°å¾—æŠŠåœ¨è·¯ç”±æ·»åŠ ä¸ªäººä¸­å¿ƒé¡µé¢ï¼Œè‡ªå·±å†™ä¸ªäººä¸­å¿ƒé¡µé¢<br><br><br><br>**è°ƒç”¨aiç”Ÿæˆoptionä»£ç æ— æ³•è¢«å‰ç«¯json,preseè½¬åŒ–æŠ¥é”™**<br><br>`Expected property name or &#x27;&#125;&#x27; in JSON at position 6`<br><br>`SyntaxError: Expected property name or â€˜&#125;â€˜ in JsoN atposition 1`<br><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">è§£å†³ï¼šå‚è€ƒï¼š[<span class="hljs-title class_">SyntaxError</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-property">parse</span>: bad parsing - <span class="hljs-title class_">JavaScript</span> | <span class="hljs-variable constant_">MDN</span> (mozilla.<span class="hljs-property">org</span>)](<span class="hljs-attr">https</span>:<span class="hljs-comment">//developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Errors/JSON_bad_parse)</span></span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">é—®é¢˜å‘ç°ï¼šå­—æ®µè¢«<span class="hljs-string">&#x27; &#x27;</span>å•å¼•å·æ‹¬ä½ï¼Œæ— æ³•è¢«è§£ææˆ<span class="hljs-title class_">Json</span>ï¼Œéœ€è¦<span class="hljs-string">&quot; &quot;</span>åŒå¼•å·æ‰è¡Œ;</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">æˆ‘çš„è§£å†³: è®©<span class="hljs-title class_">Ai</span>é¢„è®¾åŠ å…¥é™åˆ¶è¾“å‡ºæ ¼å¼ï¼Œæ¯ä¸ªå­—æ®µçš„å±æ€§å€¼ç”¨<span class="hljs-string">&quot;&quot;</span>åŒå¼•å·æ ‡æ³¨</span><br><br><br><br>//ä¼˜åŒ–ç‚¹<br><br>å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Œç§’ä¼ ï¼Œæ–‡ä»¶ä¸€å®šè¦æ ¡éªŒï¼Œåç¼€åï¼Œå¤§å°ï¼Œæ–‡ä»¶ä¸Šä¼ å¤§å°è¶…è¿‡100MBè€ƒè™‘åˆ†ç‰‡<br><br>æ ¡éªŒæ–‡ä»¶çš„åˆè§„æ€§ï¼ˆéº»çƒ¦ï¼‰ï¼Œä½¿ç”¨é˜¿é‡Œè…¾è®¯çš„ç°æˆæ–¹æ³•<br><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">æ•°æ®å­˜å‚¨ï¼šè®¾è®¡åˆæœŸï¼ŒæŠŠç”¨æˆ·çš„ä¸Šä¼ çš„excelè§£ææˆstringå­˜åœ¨æ•°æ®åº“çš„ä¸€ä¸ªå­—æ®µä¸­</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">é—®é¢˜ï¼š</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">1.</span> åæœŸç”¨æˆ·è¿‡å¤šï¼Œå†…å­˜æ¶ˆè€—è¿‡å¤§ï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-number">2.</span> å¦‚æœå‰ç«¯è¦æ±‚æŸ¥çœ‹ç”¨æˆ·ä¸Šä¼ æ•°æ® æŸ¥è¯¢å›°éš¾</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">è§£å†³(**åˆ†åº“åˆ†è¡¨æ€æƒ³**)ï¼š</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">- æ–°å»ºæ•°æ®åº“è¡¨ï¼Œå°†è¦å±•ç¤ºè¦æŸ¥è¯¢çš„åŸå§‹æ•°æ®å•ç‹¬å»ºä¸€ä¸ªè¡¨ï¼Œå°†åŸå§‹æ•°æ®çš„åˆ—åè®¾ç½®ä¸ºæ–°è¡¨çš„å­—æ®µåï¼Œçœ‹æƒ…å†µå¯ä»¥å­˜åœ¨mangod</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">- æŠŠæ¯ä¸ªå›¾è¡¨å¯¹åº”çš„åŸå§‹æ•°æ®å­—æ®µchartDataå•ç‹¬ä¿å­˜ä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ï¼Œè€Œä¸æ˜¯éƒ½å­˜åœ¨chartDataå­—æ®µä¸­ã€‚</span><br><br><br><br>å®ç°ï¼š<br><br>- åœ¨å­˜å‚¨chartDataå­—æ®µæ—¶ï¼Œæ”¹ä¸ºï¼Œå†™ç¨‹åºæ‹¼æ¥å»ºè¡¨è¯­å¥ï¼Œç„¶åå†å‘å»ºçš„æ–°è¡¨ä¸­æ’å…¥å¯¹åº”æ•°æ®<br>- æ–°è¡¨å­—æ®µå¯¹åº”åŸå§‹æ•°æ®çš„è¡¨å¤´<br><br>```sql<br>create table chartData_charIdï¼ˆchartè¡¨çš„idï¼‰(<br>id  bigint primary key <br>&#x27;æ—¥æœŸ&#x27; DataTime not null,<br>#è¿™é‡Œçœ‹æƒ…å†µï¼Œè€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚è¿‡longç±»å‹è¿‡é•¿ï¼Œå‰ç«¯ä¼šå‡ºç°æ¥å—longç±»å‹æ•°æ®ç²¾åº¦ä¸¢å¤±é—®é¢˜æ¯”å¦‚ï¼šåç«¯ï¼š1216464984684654654 =&gt; å‰ç«¯ï¼š1216464984684654000<br>&#x27;ç”¨æˆ·æ•°&#x27; varchar(128) not null,<br><br>)<br></code></pre></td></tr></table></figure></code></pre></li></ol><ul><li>æŸ¥è¯¢è¯­å¥ï¼šç”±æŸ¥è¯¢ä¸€ä¸ªå­—æ®µåˆ°æŸ¥è¯¢ä¸€ä¸ªè¡¨ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> chartData_charId;<br></code></pre></td></tr></table></figure><ul><li>mybatisæœ€çµæ´»çš„åŠ¨æ€sql</li></ul><p><strong>é£é™©:</strong> sqlæ³¨å…¥,åšä¸€ä¸ªsqlæ ¡éªŒ</p><p>æŸ¥è¯¢æ—¶ä¸‡ä¸€ç”¨æˆ·è¾“å…¥<code>select * from table where id=1</code> æ­£å¸¸è¾“å…¥<code>1</code></p><p>ç”¨æˆ·å¦‚æœè¾“å…¥<code>1,or 1=1</code>  ,<code>select * from table where id=1 ,or 1=1</code></p><p>å°±ä¼šè·å–å…¨éƒ¨çš„æ•°æ®,æœ‰äº›ä¸èƒ½å±•ç¤ºçš„æ•°æ®è¢«æ³„éœ²</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>= <span class="hljs-string">&#x27;æŸ¥è¯¢æ–¹æ³•å&#x27;</span>, <span class="hljs-attr">paramsType</span>=<span class="hljs-string">&#x27;å‚æ•°ç±»å‹&#x27;</span>, <span class="hljs-attr">resultType</span>=<span class="hljs-string">&#x27;è¿”å›ç»“æœç±»å‹&#x27;</span>&gt;</span><br>$&#123;sqlè¯­å¥&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>æ‹¼æ¥bug</li></ul><blockquote><p>ç”¨String[] æ‹¼æ¥æ˜¯ä¹±åºçš„ï¼Œæ‹¼æ¥sqlå­—æ®µé¡ºåºä¼šæŠ¥é”™</p><p>åæ¥å‘ç°ä¸æ˜¯è¿™ä¸ªé—®é¢˜ï¼š</p><p>é—®é¢˜æ‰€åœ¨ï¼Œä»æ•°æ®åº“è·å–å­—æ®µåæ²¡æœ‰æŒ‡å®šæŒ‰ç…§å»ºè¡¨é¡ºåºè¿›è¡Œ</p><p>åŠ ä¸Š <code>ORDER BY ORDINAL_POSITION</code>,æŒ‰ç…§ç‰¹å®šé¡ºåºæ’åº</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> COLUMN_NAME <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="hljs-keyword">WHERE</span> TABLE_NAME <span class="hljs-operator">=</span> #&#123;tableName&#125; <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ORDINAL_POSITION<br></code></pre></td></tr></table></figure><blockquote><p>ä¼˜ç‚¹:åˆ†å¼€å­˜å‚¨äº’ä¸å½±å“ï¼Œå¢åŠ å®‰å…¨æ€§</p></blockquote><p>å­¦ä¹ æ­£åˆ™è¡¨è¾¾</p><p><strong>é™æµ</strong></p><p>æ”¶è´¹ï¼Œæ¶ˆè€—èµ„æºçš„åŠŸèƒ½ä¸€å®šè¦åšé™æµ</p><p>æ§åˆ¶æˆæœ¬ -&gt;é™åˆ¶ç”¨æˆ·è°ƒç”¨æ¬¡æ•°</p><p>ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…ç–¯ç‹‚è°ƒç”¨ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºå æ»¡ â€“&gt;åšé™æµ</p><p>é™æµï¼šç”¨æˆ·åœ¨ä¸€ç§’å†…ç–¯ç‹‚è°ƒç”¨ &#x3D;&#x3D;&#x3D;ã€‹é™åˆ¶ç”¨æˆ·ä¸€ç§’åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼ˆçœ‹ä¸ªäººï¼‰</p><p>ç”¨æˆ·åœ¨ä¸€åˆ†é’Ÿå†…è°ƒç”¨60æ¬¡ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯æ¶æ„è°ƒç”¨ï¼ŒåŠ å…¥é»‘åå•</p><p>1ï¼‰æœ¬åœ°é™æµï¼Œå•æœºé™æµï¼Œ</p><p>æ¯ä¸ªæœåŠ¡å™¨éƒ½è®¾ç½®ä¸€ä¸ªé™æµ</p><p><strong>çº¿ç¨‹æ± </strong></p><p><strong>Aiè°ƒç”¨å¼‚æ­¥ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿™æ˜¯é™æ€çš„å›¾è¡¨ï¼Œå¦‚æœä½ æƒ³æ‹“å±•ï¼Œä½ å¯ä»¥å†è®©aiç”Ÿæˆå‡½æ•°function,è¿”å›ç±»å‹å†åŠ ä¸€ä¸ªå­—æ®µ,æŠŠç”Ÿæˆçš„å‡½æ•°ä»£ç å†è®¾ç½®åˆ°functionä¸­</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> genChartByAiRequest</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/gen&quot;)</span><br>    <span class="hljs-keyword">public</span> BaseResponse&lt;AiResponse&gt; <span class="hljs-title function_">genChartByAi</span><span class="hljs-params">(<span class="hljs-meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span><br><span class="hljs-params">                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> genChartByAiRequest.getName();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">goal</span> <span class="hljs-operator">=</span> genChartByAiRequest.getGoal();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">chartType</span> <span class="hljs-operator">=</span> genChartByAiRequest.getChartType();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> ExcelUtils.excelToCsv(file);<br>        <span class="hljs-comment">//æ ¡éªŒ</span><br>        ThrowUtils.throwIf(StringUtils.isBlank(name) &amp;&amp; name.length() &gt; <span class="hljs-number">100</span>, ErrorCode.NOT_FOUND_ERROR, <span class="hljs-string">&quot;å›¾æ ‡åä¸ºç©º&quot;</span>);<br>        ThrowUtils.throwIf(StringUtils.isBlank(goal) &amp;&amp; goal.length() &gt; <span class="hljs-number">1024</span>, ErrorCode.NOT_FOUND_ERROR, <span class="hljs-string">&quot;åˆ†æç›®æ ‡ä¸ºç©º&quot;</span>);<br>        ThrowUtils.throwIf(StringUtils.isBlank(chartType), ErrorCode.NOT_FOUND_ERROR, <span class="hljs-string">&quot;å›¾è¡¨ç±»å‹ä¸ºç©º&quot;</span>);<br>        <span class="hljs-comment">//æ ¡éªŒæ–‡ä»¶</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> file.getSize();<br>        <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé¢„è®¾æœ€å¤§é™åº¦10å…†,</span><br>        ThrowUtils.throwIf(size &gt; FILE_MAX_SIZE,ErrorCode.PARAMS_ERROR,<span class="hljs-string">&quot;æ–‡ä»¶è¿‡å¤§ï¼Œä¸Šä¼ å¤±è´¥&quot;</span>);<br>        <span class="hljs-comment">//æ ¡éªŒæ–‡ä»¶ååç¼€</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> FileUtil.getSuffix(originalFilename);<br>        <span class="hljs-keyword">if</span> (suffix == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(ErrorCode.SYSTEM_ERROR,<span class="hljs-string">&quot;åç¼€åè§£æé”™è¯¯&quot;</span>);<br>        &#125;<br>        ThrowUtils.throwIf(!suffix.equals(EXCEL_SUFFIX),ErrorCode.NOT_FOUND_ERROR,<span class="hljs-string">&quot;åç¼€åä¸åŒ¹é…,ä¸Šä¼ å¤±è´¥&quot;</span>);<br><br>        <span class="hljs-comment">//Aié¢„è®¾</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å‡å¦‚ä½ æ˜¯ä¸€ä¸ªèµ„æ·±æ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹: \n&quot;</span> +<br>                <span class="hljs-string">&quot;åˆ†æéœ€æ±‚: \n&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡&#125;\n&quot;</span> +<br>                <span class="hljs-string">&quot;éœ€è¦åˆ†æçš„æ•°æ®: \n&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦&#125;\n&quot;</span> +<br>                <span class="hljs-string">&quot;è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šçš„æ ¼å¼ç”Ÿæˆå†…å®¹(æ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„æ³¨é‡Šï¼Œå¼€å¤´ï¼Œç»“å°¾ï¼Œç¬¦å·ç­‰) \n&quot;</span> +<br>                <span class="hljs-string">&quot;ã€ã€ã€ã€ã€ã€\n&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;å‰ç«¯Echarts V5ç‰ˆæœ¬çš„ option é…ç½®å¯¹è±¡çš„jsä»£ç çš„Jsonæ ¼å¼ï¼Œå¼ºè°ƒä¸€ä¸‹ï¼Œä¸€å®šè¦Jsonæ ¼å¼çš„ä»£ç ï¼Œä¾¿äºå‰ç«¯è§£ææˆJsonè§£æå™¨è§£æï¼Œåˆç†çš„å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œè¿™é‡Œåªéœ€è¦option é…ç½®å¯¹è±¡çš„jsä»£ç ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š&#125;\n&quot;</span> +<br>                <span class="hljs-string">&quot;ã€ã€ã€ã€ã€ã€\n&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºï¼Œè¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š&#125;&quot;</span>;<br>        <span class="hljs-comment">//ç”¨æˆ·è¾“å…¥å¡«å……</span><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">userInput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        userInput.append(prompt).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>        userInput.append(<span class="hljs-string">&quot;ä»¥ä¸‹æ˜¯æˆ‘çš„æé—®å†…å®¹ï¼Œè¯·ä½ æŒ‰ç…§ä¸Šé¢çš„è¾“å…¥å’Œè¾“å‡ºçš„æ ¼å¼ï¼Œæå–æˆ‘ä¸‹é¢çš„å†…å®¹ï¼Œå¹¶æŒ‰ä¸Šè¿°æ ¼å¼ç”Ÿæˆä»£ç å’Œç»“è®ºã€‚&quot;</span>).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>        userInput.append(<span class="hljs-string">&quot;æˆ‘çš„åˆ†æéœ€æ±‚:&quot;</span>).append(<span class="hljs-string">&quot;\n&quot;</span>).append(goal).append(<span class="hljs-string">&quot;ã€‚æˆ‘éœ€è¦ç”Ÿæˆçš„å›¾è¡¨ç±»å‹ä¸º:&quot;</span>).append(chartType).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>        userInput.append(<span class="hljs-string">&quot;åŸå§‹csvæ•°æ®:&quot;</span>).append(<span class="hljs-string">&quot;\n&quot;</span>).append(data);<br>        <span class="hljs-comment">//æ‰§è¡Œä»»åŠ¡ä¹‹å‰ï¼Œå…ˆæŠŠç”¨æˆ·è¾“å…¥ä¿å­˜è‡³æ•°æ®åº“</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> userService.getLoginUser(request);<br>        <span class="hljs-comment">//å…ˆå‘æ•°æ®åº“æ’å…¥é™¤äº†ChartDataé™¤å¤–çš„æ•°æ®</span><br>        <span class="hljs-type">Chart</span> <span class="hljs-variable">chart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chart</span>();<br>        chart.setGoal(goal);<br>        chart.setName(name);<br>        chart.setChartData(<span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">//è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€</span><br>        chart.setStatus(ChartEnum.WAIT.getKey());<br>        chart.setChartType(chartType);<br>        chart.setUserId(loginUser.getId());<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> chartService.save(chart);<br>        <span class="hljs-keyword">if</span> (!save)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-number">12131</span>,<span class="hljs-string">&quot;ä¿å­˜å›¾è¡¨æ•°æ®å¤±è´¥&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//è·å–å·²ä¿å­˜çš„chartId</span><br>        <span class="hljs-comment">//æ ¹æ®nameæŸ¥è¯¢id</span><br>        LambdaQueryWrapper&lt;Chart&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(Chart::getName,name);<br>        <span class="hljs-type">Chart</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> chartService.getOne(queryWrapper);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> one.getId();<br>        <span class="hljs-comment">//ä¿å­˜æ•°æ®åº“</span><br>        String[] split1 = data.split(<span class="hljs-string">&quot;\n&quot;</span>);<br>        String[] split2 = split1[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;,&quot;</span>);<br>        List&lt;String&gt; list = Arrays.asList(split2);<br>        <span class="hljs-comment">//è·å–é•¿åº¦ï¼Œå¾ªç¯å†™æ‹¼æ¥sql</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> list.size();<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">stringBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;create table chartData_&quot;</span> +id+<br>                <span class="hljs-string">&quot;(id  bigint auto_increment  primary key,&quot;</span>;<br>        stringBuilder.append(sql1);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; k &lt; length; k++) &#123;<br>            <span class="hljs-keyword">if</span> (k == length - <span class="hljs-number">1</span>)&#123;<br>                stringBuilder.append(list.get(k)).append(<span class="hljs-string">&quot; varchar(128) null&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                stringBuilder.append(list.get(k)).append(<span class="hljs-string">&quot; varchar(128) null,&quot;</span>);<br>            &#125;<br>        &#125;<br>        stringBuilder.append(<span class="hljs-string">&quot;)&quot;</span>);<br>        <span class="hljs-comment">//æ‹¼æ¥å®Œæˆ</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> stringBuilder.toString();<br>        <span class="hljs-comment">//æ‰§è¡Œå»ºè¡¨è¯­å¥</span><br>        chartService.createChartDataTable(sql);<br>        <span class="hljs-comment">//è·å–æ–°å»ºè¡¨çš„å­—æ®µ</span><br>        List&lt;String&gt; tableColumns = chartService.getTableColumns(<span class="hljs-string">&quot;chartData_&quot;</span> + id);<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        builder.append(<span class="hljs-string">&quot;insert into chartData_&quot;</span>).append(id).append(<span class="hljs-string">&quot; (&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; k &lt; tableColumns.size(); k++) &#123;<br>            <span class="hljs-keyword">if</span> ( k == tableColumns.size()-<span class="hljs-number">1</span>)&#123;<br>                builder.append(tableColumns.get(k));<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                builder.append(tableColumns.get(k)).append(<span class="hljs-string">&quot;,&quot;</span>);<br>            &#125;<br>        &#125;<br>        builder.append(<span class="hljs-string">&quot;) values (&quot;</span>);<br>        <span class="hljs-comment">//æŠŠbuilderè½¬åŒ–ä¸ºStringä¸å¯å˜å¯¹è±¡,ä¸ç„¶ä¸‹é¢çš„æ¯æ¬¡æ‹¼æ¥éƒ½ä¼šåœ¨ä¸Šæ¬¡çš„åŸºç¡€ä¸Šæ‹¼æ¥</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">insertBuilder</span> <span class="hljs-operator">=</span> builder.toString();<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">stringBuilder1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        String[] split3 = data.split(<span class="hljs-string">&quot;\n&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i1 &lt; split3.length; i1++) &#123;<br>            String[] split4 = split3[i1].split(<span class="hljs-string">&quot;,&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i2 &lt; split4.length; i2++) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> split4[i2];<br>                <span class="hljs-keyword">if</span> (i2 == split4.length -<span class="hljs-number">1</span>)&#123;<br>                    stringBuilder1.append(<span class="hljs-string">&quot;&#x27;&quot;</span>).append(s).append(<span class="hljs-string">&quot;&#x27;&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    stringBuilder1.append(<span class="hljs-string">&quot;&#x27;&quot;</span>).append(s).append(<span class="hljs-string">&quot;&#x27;,&quot;</span>);<br>                &#125;<br>            &#125;<br>            stringBuilder1.append(<span class="hljs-string">&quot;)&quot;</span>);<br>            <span class="hljs-comment">//æ‰§è¡Œæ’å…¥çš„æ‹¼æ¥sql</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">sqlGood</span> <span class="hljs-operator">=</span> insertBuilder + stringBuilder1;<br>            chartService.insertChartTable(sqlGood);<br>            <span class="hljs-comment">//æŠŠä½¿ç”¨è¿‡çš„stringBuilder1æ¸…ç©ºï¼Œä¾¿äºä¸‹æ¬¡å¾ªç¯çš„æ‰§è¡Œ</span><br>            stringBuilder1.delete(<span class="hljs-number">0</span>,stringBuilder1.length());<br>            <span class="hljs-comment">//TODO BUG æ’å…¥ä¸è¿›å»  å·²è§£å†³</span><br>        &#125;<br>        <span class="hljs-comment">//TODO å¤„ç†ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åçš„æŠ›å¼‚å¸¸</span><br>        <span class="hljs-comment">//æ–°å¢ä»»åŠ¡,å°†è°ƒç”¨Aiä»»åŠ¡å¡è¿›å»</span><br>        CompletableFuture.runAsync(() -&gt; &#123;<br>            <span class="hljs-comment">//todo æ·»åŠ è¶…æ—¶æ—¶é—´ã€‚è¶…è¿‡æ—¶é—´æ ‡è®°ä»»åŠ¡ä¸ºå¤±è´¥ï¼Œæ‰‹åŠ¨ç»“æŸä»»åŠ¡</span><br>            <span class="hljs-comment">//todo æ·»åŠ è¶…æ—¶æ—¶é—´å­—æ®µ,or ç»™çº¿ç¨‹æ± æ·»åŠ ä¸€ä¸ªä»»åŠ¡è¶…æ—¶å‚æ•°ï¼Ÿ</span><br>            <span class="hljs-comment">//ä¿®æ”¹aiç”Ÿæˆå›¾è¡¨çš„çŠ¶æ€ä¸ºæ‰§è¡Œä¸­running</span><br>            one.setStatus(ChartEnum.RUNNING.getKey());<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> chartService.updateById(one);<br><br>            <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æ›´æ–°æˆåŠŸ</span><br>            <span class="hljs-keyword">if</span> (!b)&#123;<br>                handleException(one,<span class="hljs-string">&quot;æ›´æ–°å›¾è¡¨æ‰§è¡ŒçŠ¶æ€å¤±è´¥&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            <span class="hljs-comment">//ä½¿ç”¨Aiä¼ è¾“é—®é¢˜</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">chatResult</span> <span class="hljs-operator">=</span> aiManager.doChat(userInput.toString());<br>            <span class="hljs-comment">//é™æµåˆ¤æ–­  é’ˆå¯¹æ¯ä¸ªç”¨æˆ·åšé™æµï¼Œæ¯ä¸ªç”¨æˆ·å•ä½æ—¶é—´å†…åªèƒ½æ‰§è¡Œè¿™ä¸ªæ–¹æ³•2æ¬¡</span><br>            <span class="hljs-comment">//ç»™æ¯ä¸€ä¸ªç”¨æˆ·è‰²è®¾å®šä¸€ä¸ªé™æµå™¨ï¼Œæ ¹æ®keyçš„ä¸åŒæ¥åŒºåˆ†</span><br>            <span class="hljs-comment">//åˆ’åˆ†ç²’åº¦ï¼Œé’ˆå¯¹æ¯ä¸ªæ–¹æ³•è¢«xxè°ƒç”¨åšé™æµï¼Œé’ˆå¯¹æŸä¸ªç”¨æˆ·æ“ä½œæŸä¸ªæ–¹æ³•åšé™æµ</span><br>            <span class="hljs-comment">// String key = æ–¹æ³•å+userID</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;genChartByAi_&quot;</span> + loginUser.getId();<br>            <span class="hljs-comment">//é™æµ</span><br>            limiterManager.doRedisLimiter(key);<br><br>            <span class="hljs-comment">//è·å–ç»“æœ</span><br>            String[] split = chatResult.split(<span class="hljs-string">&quot;ã€ã€ã€ã€ã€ã€&quot;</span>);<br>            ThrowUtils.throwIf(split.length&lt;<span class="hljs-number">3</span>,ErrorCode.SYSTEM_ERROR,<span class="hljs-string">&quot;Aiå“åº”é”™è¯¯&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">option</span> <span class="hljs-operator">=</span> split[<span class="hljs-number">1</span>].trim();  <span class="hljs-comment">//trim()å»é™¤äº†é¦–å°¾ç©ºæ ¼çš„æ–°å­—ç¬¦ä¸²</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> option.indexOf(<span class="hljs-string">&quot;&#123;&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">optionJs</span> <span class="hljs-operator">=</span> option.substring(i);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">genResult</span> <span class="hljs-operator">=</span> split[<span class="hljs-number">2</span>].trim();<br>            <span class="hljs-comment">//æ‰“å°è¾“å‡º</span><br>            log.info(optionJs);<br>            log.info(genResult);<br>            <span class="hljs-comment">//æ›´æ”¹æ•°æ®åº“å›¾æ ‡çŠ¶æ€ä¸º æˆåŠŸ succeed , å¤±è´¥ failed</span><br>            one.setStatus(ChartEnum.SUCCEED.getKey());<br>            one.setGenChart(optionJs);<br>            one.setGenResult(genResult);<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">updateResult</span> <span class="hljs-operator">=</span> chartService.updateById(one);<br>            <span class="hljs-keyword">if</span> (!updateResult)&#123;<br>                handleException(one,<span class="hljs-string">&quot;æ›´æ–°å›¾è¡¨æˆåŠŸçŠ¶æ€å¤±è´¥&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>        &#125;,poolExecutor);<br><br>        <span class="hljs-comment">//å‘è¡¨ä¸­æ’å…¥æ•°æ®</span><br>        <span class="hljs-comment">//è¿”å›</span><br>        <span class="hljs-type">AiResponse</span> <span class="hljs-variable">aiResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AiResponse</span>();<br>        <span class="hljs-keyword">return</span> ResultUtils.success(aiResponse);<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">handleException</span><span class="hljs-params">(Chart one,String errorMessage)</span>&#123;<br>        one.setStatus(ChartEnum.FAILED.getKey());<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> chartService.updateById(one);<br>        <span class="hljs-keyword">if</span> (!b) &#123;<br>            log.error(<span class="hljs-string">&quot;æ›´æ–°å›¾è¡¨å¤±è´¥çŠ¶æ€å¤±è´¥,&quot;</span>+one.getId()+ <span class="hljs-string">&quot;,&quot;</span>+ errorMessage);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åˆ†è¡¨å®ç°ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230831084605165.png" alt="image-20230831084605165"></p><ul><li>åå‘å‹åŠ›ï¼šæ ¹æ®ä¸‹æ¸¸è°ƒç”¨æœåŠ¡çš„çŠ¶æ€æ¥åæ¨ä½ çš„æ ¸å¿ƒçº¿ç¨‹æ•°çš„è®¾ç½®ï¼Œ</li></ul><p><font color='red'>å¯ä»¥è®¾ç½®å®šæ—¶ä»»åŠ¡å®šæ—¶æ£€æŸ¥ä¸‹æ¸¸æœåŠ¡çš„æœåŠ¡çŠ¶æ€ï¼Œæ¯”å¦‚Aiå¾ˆç¹å¿™ï¼Œè¿™æ—¶å€™å°±ä¸è¦å¢åŠ æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœAIå¾ˆç©ºé—²ï¼Œé€‚å½“å¢åŠ æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ŒåŠ¨æ€çš„è°ƒæ•´æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå»ºè®®ä¸è¦åœ¨é…ç½®ä¸­å†™æ­»;</font></p><p>ä¼˜åŒ–: </p><ul><li><p>guava retryingé‡è¯•æœºåˆ¶,ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•</p></li><li><p>æ·»åŠ ä»»åŠ¡è¶…æ—¶æ—¶é—´ </p></li><li><p>å‰ç«¯æˆ‘çš„å›¾è¡¨åŠ ä¸Šå®šæ—¶åˆ·æ–°</p></li><li><p>ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥ç»™ç”¨æˆ·å‘é€å®æ—¶æ¶ˆæ¯</p></li></ul><h2 id="rabbitmq"><a href="#rabbitmq" class="headerlink" title="rabbitmq:"></a>rabbitmq:</h2><h3 id="æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"><a href="#æ¶ˆæ¯ç¡®è®¤æœºåˆ¶" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"></a>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</h3><h3 id="æ¶ˆæ¯é‡è¯•"><a href="#æ¶ˆæ¯é‡è¯•" class="headerlink" title="æ¶ˆæ¯é‡è¯•"></a>æ¶ˆæ¯é‡è¯•</h3><h3 id="æ­»ä¿¡é˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—"></a>æ­»ä¿¡é˜Ÿåˆ—</h3><p><font color='red'>å¤„ç†å¤±è´¥äº†çš„æ¶ˆæ¯ï¼Œä»æ­»ä¿¡é˜Ÿåˆ—ä¸­å»æ¶ˆæ¯å»é‡è¯•æˆ–æ¶ˆè´¹ï¼Œä»»åŠ¡å®Œæˆä¸äº†äº¤ç»™æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ–°å»ºä¸€ä¸ªé˜Ÿåˆ—æ¯”å¦‚å¤–åŒ…é˜Ÿåˆ—ï¼Œå¤–åŒ…é˜Ÿåˆ—è·å–æ­»ä¿¡é˜Ÿåˆ—çš„å¤±è´¥æ¶ˆæ¯ï¼ˆä¸“é—¨å¤„ç†æ­»ä¿¡çš„é˜Ÿåˆ—ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼‰</font></p><p><font color='red'>  æ­»ä¿¡é˜Ÿåˆ—çš„ä¸»è¦ç›®çš„æ˜¯å¤„ç†ä»¥ä¸‹æƒ…å†µï¼š</font></p><ol><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆbasic.rejectï¼‰å¹¶ä¸”ä¸é‡æ–°å…¥é˜Ÿï¼ˆrequeue&#x3D;falseï¼‰ã€‚</li><li>æ¶ˆæ¯è¿‡æœŸï¼ˆæ¶ˆæ¯çš„ TTL è®¾ç½®ï¼‰ã€‚</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ã€‚</li></ol><p>ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—çš„<strong>æ­¥éª¤</strong>å¦‚ä¸‹ï¼š</p><ol><li><p>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®å…¶ <code>x-dead-letter-exchange</code> å’Œ <code>x-dead-letter-routing-key</code> å‚æ•°ï¼Œç”¨äºæŒ‡å®šæ­»ä¿¡æ¶ˆæ¯çš„äº¤æ¢å™¨å’Œè·¯ç”±é”®ã€‚</p></li><li><p>åˆ›å»ºä¸€ä¸ªæ­»ä¿¡äº¤æ¢å™¨ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸Šã€‚</p></li><li><p>å°†æ¶ˆæ¯å‘é€åˆ°æ™®é€šé˜Ÿåˆ—ä¸­ï¼Œå½“æ¶ˆæ¯æ»¡è¶³æ­»ä¿¡æ¡ä»¶æ—¶ï¼ŒRabbitMQ ä¼šå°†å…¶å‘é€åˆ°æ­»ä¿¡äº¤æ¢å™¨ï¼Œå¹¶è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­.</p></li></ol><h3 id="æ¶ˆæ¯è¿‡æœŸæœºåˆ¶"><a href="#æ¶ˆæ¯è¿‡æœŸæœºåˆ¶" class="headerlink" title="æ¶ˆæ¯è¿‡æœŸæœºåˆ¶"></a>æ¶ˆæ¯è¿‡æœŸæœºåˆ¶</h3><h2 id="Apache-kafka"><a href="#Apache-kafka" class="headerlink" title="Apache kafka"></a>Apache kafka</h2><h2 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h2><p>é›†æˆwebsocket</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-websocket --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>TODO </p><p>åç«¯é›†æˆwebsocketï¼Œé…ç½®websocketï¼Œç¼–å†™websocketServiceï¼Œ</p><p>è‡ªå®šä¹‰æ¥æ”¶å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œ</p><p>åœ¨ä»»åŠ¡å®Œæˆæ—¶è°ƒç”¨å‘é€æ¶ˆæ¯æ–¹æ³•ï¼Œå‰ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œè®¾ç½®å˜é‡å½“æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶å˜é‡å€¼+1ï¼Œ</p><p>åç«¯è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯æ•°æ®åº“ï¼Œæ¥å—çš„æ¶ˆæ¯å­˜å…¥æ•°æ®åº“ï¼Œç‚¹å‡»å›¾æ ‡æ—¶å±•ç¤ºæ¶ˆæ¯åˆ—è¡¨ã€‚</p><p>æ­å»ºèŠå¤©å®¤ï¼Œ</p><p>å‘é€å®æ—¶æ¶ˆæ¯</p><p><a href="https://blog.csdn.net/qq_27610647/article/details/132422945">Spring Boot é›†æˆ WebSocket å®ç°æœåŠ¡ç«¯æ¨é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯_ä¸ç¾çš„fangå°‘å¹´çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/poker_zero/article/details/126184697">javaåç«¯+å‰ç«¯ä½¿ç”¨WebSocketå®ç°æ¶ˆæ¯æ¨é€_å‰ç«¯è°ƒç”¨javaçš„websocketå®¢æˆ·ç«¯_é›¶â®çš„åšå®¢-CSDNåšå®¢</a></p><h2 id="çº¿ç¨‹æ± çŸ¥è¯†ç‚¹"><a href="#çº¿ç¨‹æ± çŸ¥è¯†ç‚¹" class="headerlink" title="çº¿ç¨‹æ± çŸ¥è¯†ç‚¹"></a>çº¿ç¨‹æ± çŸ¥è¯†ç‚¹</h2><p><a href="https://blog.csdn.net/weixin_45433817/article/details/132524464?spm=1001.2014.3001.5501&ydreferer=aHR0cHM6Ly9hcnRpY2xlcy56c3hxLmNvbS8=&ydreferer=aHR0cHM6Ly9hcnRpY2xlcy56c3hxLmNvbS8=">Javaå¹¶å‘ç¼–ç¨‹ç¬¬6è®²â€”â€”çº¿ç¨‹æ± ï¼ˆä¸‡å­—è¯¦è§£ï¼‰_æ©¡ çš® äººçš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>mq</tag>
      
      <tag>é¡¹ç›®</tag>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxé…ç½®Elasticsearchç¯å¢ƒï¼ˆåŸºç¡€å­¦ä¹ ç‰ˆï¼‰</title>
    <link href="/2023/09/14/linux%E9%85%8D%E7%BD%AEElasticsearch%E7%8E%AF%E5%A2%83%EF%BC%88%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%89%88%EF%BC%89/"/>
    <url>/2023/09/14/linux%E9%85%8D%E7%BD%AEElasticsearch%E7%8E%AF%E5%A2%83%EF%BC%88%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%89%88%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="linuxé…ç½®Elasticsearchç¯å¢ƒï¼ˆåŸºç¡€å­¦ä¹ ç‰ˆï¼‰"><a href="#linuxé…ç½®Elasticsearchç¯å¢ƒï¼ˆåŸºç¡€å­¦ä¹ ç‰ˆï¼‰" class="headerlink" title="linuxé…ç½®Elasticsearchç¯å¢ƒï¼ˆåŸºç¡€å­¦ä¹ ç‰ˆï¼‰"></a>linuxé…ç½®Elasticsearchç¯å¢ƒï¼ˆåŸºç¡€å­¦ä¹ ç‰ˆï¼‰</h1><h2 id="jdké…ç½®"><a href="#jdké…ç½®" class="headerlink" title="jdké…ç½®"></a>jdké…ç½®</h2><ol><li>ç¼–è¾‘ç¯å¢ƒ</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><ol start="2"><li><pre><code class="shell">export JAVA_HOME=/opt/resource/jdk1.8export PATH=$PATH:$JAVA_HOME/bin:wq ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><br><span class="hljs-number">3</span>. ä½¿é…ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š<br><br>```bash<br><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure></code></pre></li><li><p>éªŒè¯Javaçš„å®‰è£…ï¼š</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -version<br></code></pre></td></tr></table></figure><h2 id="Elasticsearchè£¸å¥”é…ç½®"><a href="#Elasticsearchè£¸å¥”é…ç½®" class="headerlink" title="Elasticsearchè£¸å¥”é…ç½®"></a>Elasticsearchè£¸å¥”é…ç½®</h2><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>ä¿®æ”¹elasticsearché…ç½®<br>æ‰§è¡Œå‘½ä»¤:<br><code>vim /opt/resource/elasticsearch-7.17.9/config/elasticsearch.yml</code></p><p>ä¿®æ”¹æ•°æ®å’Œæ—¥å¿—ç›®å½•<br>è¿™é‡Œå¯ä»¥ä¸ç”¨ä¿®æ”¹ï¼Œå¦‚æœä¸ä¿®æ”¹ï¼Œé»˜è®¤æ”¾åœ¨elasticsearchæ ¹ç›®å½•ä¸‹</p><p>æ•°æ®ç›®å½•ä½ç½®</p><p><code>path.data: /home/æ–°ç”¨æˆ·åç§°/elasticsearch/data </code></p><p>æ—¥å¿—ç›®å½•ä½ç½®</p><p><code>path.logs: /home/æ–°ç”¨æˆ·åç§°/elasticsearch/logs </code><br>ä¿®æ”¹ç»‘å®šçš„ipå…è®¸è¿œç¨‹è®¿é—®</p><p>#é»˜è®¤åªå…è®¸æœ¬æœºè®¿é—®,ç»‘å®šåˆ°0.0.0.0ï¼Œå…è®¸ä»»ä½•ipæ¥è®¿é—®</p><p><code>network.host: 0.0.0.0 </code><br>åˆå§‹åŒ–èŠ‚ç‚¹åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cluster.name: elasticsearch <br>node.name: es-node0<br>cluster.initial_master_nodes: [&quot;es-node0&quot;]<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ç«¯å£å·ï¼ˆéå¿…é¡»ï¼‰</p><p>http.port: 9200</p><p>ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230814135428086.png" alt="image-20230814135428086"></p><p>ä¿®æ”¹<code>vim /opt/resource/elasticsearch-7.17.9/config/kibana.yml</code></p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230814135342260.png" alt="image-20230814135342260"></p><p>å°†jdkä¿®æ”¹ä¸ºesä¸­è‡ªå¸¦jdkçš„é…ç½®ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">export JAVA_HOME=/usr/local/elasticsearch-7.13.2/jdk<br>export PATH=$JAVA_HOME/bin:$PATH<br><br>if [ -x &quot;$JAVA_HOME/bin/java&quot; ]; then<br>        JAVA=&quot;/usr/local/elasticsearch-7.13.2/jdk/bin/java&quot;<br>else<br>        JAVA=`which java`<br>fi<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹åæ‰§è¡Œ<code>source /etc/profile</code>ä½¿é…ç½®ç”Ÿæ•ˆ</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>åˆ‡æ¢åˆ°<code>user-es</code>ç”¨æˆ·su user-es</p><p><code>cd /opt/resource/elasticsearch-7.17.9/bin</code></p><p><code>./elasticsearch</code></p><p><code>./elasticsearch &amp; </code> åå°è¿è¡Œå‘½ä»¤</p><p>å…³é—­å‘½ä»¤ï¼š <code>CTRL+C</code></p><p><a href="http://192.168.161.128:9200/">http://192.168.161.128:9200</a></p><p>åˆ‡æ¢åˆ°<code>user-es</code>ç”¨æˆ·<code>su user-es</code></p><p><code>cd /opt/resource/kibana-7.17.9-linux-x86_64/bin</code></p><p><code>./kibana</code></p><p>kibanaä¸­æ–‡é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">ç¼–è¾‘kibana.yml</span><br><span class="hljs-string">vim</span> <span class="hljs-string">/opt/resource/kibana-7.17.9-linux-x86_64/config/kibana.yml</span><br><span class="hljs-string">åŠ å…¥ä¸€è¡Œé…ç½®ï¼š</span><br><span class="hljs-attr">i18n.locale:</span> <span class="hljs-string">&quot;zh-CN&quot;</span><br><span class="hljs-comment">#æˆ–è€…å–æ¶ˆæ³¨é‡Š: #i18n.locale: &quot;en&quot;   --&gt; &quot;zh-CN&quot;</span><br></code></pre></td></tr></table></figure><p><code>./kibana &amp; </code>åå°è¿è¡Œå‘½ä»¤</p><p>å…³é—­å‘½ä»¤ï¼š<code> CTRL+C</code></p><p><a href="http://192.168.161.128:5601/">http://192.168.161.128:5601</a></p><h3 id="Bugè§£å†³"><a href="#Bugè§£å†³" class="headerlink" title="Bugè§£å†³"></a>Bugè§£å†³</h3><h4 id="Bug1"><a href="#Bug1" class="headerlink" title="Bug1"></a>Bug1</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ERROR: [2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch.<br>bootstrap check failure [1] of [2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]<br></code></pre></td></tr></table></figure><blockquote><p>elasticsearchç”¨æˆ·æ‹¥æœ‰çš„å†…å­˜æƒé™å¤ªå°ï¼Œè‡³å°‘éœ€è¦262144ï¼Œè§£å†³åŠæ³•ï¼š<br>åœ¨ &#x2F;etc&#x2F;sysctl.conf æ–‡ä»¶æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå³å¯æ°¸ä¹…ä¿®æ”¹</p><p>åˆ‡æ¢åˆ°rootç”¨æˆ·<br>æ‰§è¡Œå‘½ä»¤ï¼š<code>su root</code></p><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>sysctl.conf<br></code></pre></td></tr></table></figure><p>æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">vm.max_map_count</span>=<span class="hljs-number">262144</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜é€€å‡ºï¼Œåˆ·æ–°é…ç½®æ–‡ä»¶</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">sysctl -<span class="hljs-selector-tag">p</span><br></code></pre></td></tr></table></figure><p>åˆ‡æ¢user-esç”¨æˆ·ï¼Œç»§ç»­å¯åŠ¨</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">su <span class="hljs-keyword">user</span>-es<br></code></pre></td></tr></table></figure><p>å¯åŠ¨esæœåŠ¡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/opt/</span>resource<span class="hljs-regexp">/elasticsearch-7.17.9/</span>bin/elasticsearch<br></code></pre></td></tr></table></figure></blockquote><h4 id="Bug2"><a href="#Bug2" class="headerlink" title="Bug2"></a>Bug2</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">bootstrap<span class="hljs-built_in"> check </span>failure [2] of [2]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é»˜è®¤çš„å‘ç°è®¾ç½®è€Œå¼•èµ·çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨éœ€è¦é…ç½®è‡³å°‘ä¸€ä¸ªå‘ç°è®¾ç½®é¡¹ï¼ˆ<code>discovery.seed_hosts</code>ã€<code>discovery.seed_providers</code> æˆ– <code>cluster.initial_master_nodes</code>ï¼‰ã€‚</p><p><strong>é›†ç¾¤ç¯å¢ƒè§£å†³ï¼š</strong></p><p>åœ¨ Elasticsearch çš„é…ç½®æ–‡ä»¶ï¼ˆ<code>elasticsearch.yml</code>ï¼‰ä¸­ï¼Œæ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># cluster.initial_master_nodes: [&quot;node-1&quot;,&quot;node-2&quot;]</span><br></code></pre></td></tr></table></figure><p>å–æ¶ˆæ³¨é‡Š <code>cluster.initial_master_nodes</code> è¡Œï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè‡³å°‘ä¸€ä¸ª Elasticsearch èŠ‚ç‚¹çš„åç§°æˆ– IP åœ°å€ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.initial_master_nodes:</span> [<span class="hljs-string">&quot;node-1&quot;</span>,<span class="hljs-string">&quot;node-2&quot;</span>]<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Elasticsearch 7.0 åŠæ›´é«˜ç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨ <code>discovery.seed_hosts</code> è®¾ç½®é¡¹ã€‚æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># discovery.seed_hosts: []</span><br></code></pre></td></tr></table></figure><p>å–æ¶ˆæ³¨é‡Š <code>discovery.seed_hosts</code> è¡Œï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè‡³å°‘ä¸€ä¸ª Elasticsearch èŠ‚ç‚¹çš„ä¸»æœºåæˆ– IP åœ°å€ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">discovery.seed_hosts:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.161</span><span class="hljs-number">.128</span><br></code></pre></td></tr></table></figure><p><strong>å•æœºè§£å†³æ–¹æ³•ï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">elasticsearch</span> <span class="hljs-string">//å¯ä»¥å¿½ç•¥</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">es-node0</span><br><span class="hljs-attr">cluster.initial_master_nodes:</span> [<span class="hljs-string">&quot;es-node0&quot;</span>]<br></code></pre></td></tr></table></figure></blockquote><p><code>chmod 777  è¦è¯»å†™çš„æ–‡ä»¶æˆ–ç›®å½•å</code></p><h4 id="Bug3"><a href="#Bug3" class="headerlink" title="Bug3"></a>Bug3</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">å¯åŠ¨kibanaæŠ¥é”™ï¼š<br>FATAL  Error: Unable to <span class="hljs-keyword">write</span> to UUID <span class="hljs-keyword">file</span> at <span class="hljs-regexp">/opt/</span>resource<span class="hljs-regexp">/kibana-7.17.9-linux-x86_64/</span>data<span class="hljs-regexp">/uuid. Ensure Kibana has sufficient permissions to read /</span> <span class="hljs-keyword">write</span> to <span class="hljs-keyword">this</span> <span class="hljs-keyword">file</span>.  Error was: EACCES<br></code></pre></td></tr></table></figure><p><strong>è§£å†³ï¼šä¿®æ”¹æ–‡ä»¶çš„è¯»å†™æƒé™ï¼š</strong></p><p>åˆ‡æ¢<code>root</code>ç”¨æˆ·ï¼Œèµ‹äºˆæ–‡ä»¶è¯»å†™æƒé™ï¼š<code>chmod 777 /opt/resource/kibana-7.17.9-linux-x86_64/config/kibana.yml</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">å¯åŠ¨ESæŠ¥é”™:<br>ERROR: [1] bootstrap checks failed. You must address the points described in the following [1] lines before starting Elasticsearch. bootstrap check failure [1] of [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] ERROR: Elasticsearch did not exit normally - check the logs at /opt/resource/elasticsearch-7.17.9/logs/elasticsearch.log<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºElasticsearchçš„å¯åŠ¨æ£€æŸ¥å¤±è´¥å¯¼è‡´çš„ã€‚é”™è¯¯æ¶ˆæ¯ä¸­æåˆ°äº†ä¸€ä¸ªå…·ä½“çš„é—®é¢˜ï¼š<code>max virtual memory areas vm.max_map_count</code> çš„å€¼å¤ªä½ã€‚</p><p><code>vm.max_map_count</code> æ˜¯ä¸€ä¸ªå†…æ ¸å‚æ•°ï¼Œå®ƒé™åˆ¶äº†ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„æ•°é‡ã€‚<code>Elasticsearch</code>åœ¨å¯åŠ¨æ—¶éœ€è¦æ›´å¤šçš„è™šæ‹Ÿå†…å­˜åŒºåŸŸæ¥æ­£å¸¸è¿è¡Œã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨éœ€è¦å¢åŠ  <code>vm.max_map_count</code> çš„å€¼ã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œæˆï¼š</p><ol><li><p>ä½¿ç”¨ç®¡ç†å‘˜æƒé™ç™»å½•åˆ°æ‚¨çš„ç³»ç»Ÿã€‚</p></li><li><p>æ‰“å¼€ç»ˆç«¯å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä¸´æ—¶å¢åŠ </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vm</span>.max_map_count<br></code></pre></td></tr></table></figure><p>çš„å€¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo sysctl -w vm.max_map_count=262144<br></code></pre></td></tr></table></figure><p>è¿™å°†ä¸´æ—¶å¢åŠ </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vm</span>.max_map_count<br></code></pre></td></tr></table></figure><p>çš„å€¼ä¸º 262144ã€‚è¯·æ³¨æ„ï¼Œè¿™ç§æ›´æ”¹åªåœ¨å½“å‰ä¼šè¯ä¸­æœ‰æ•ˆï¼Œç³»ç»Ÿé‡å¯åä¼šæ¢å¤ä¸ºé»˜è®¤å€¼ã€‚</p></li><li><p>å°è¯•é‡æ–°å¯åŠ¨ <code>Elasticsearch</code>ï¼Œçœ‹æ˜¯å¦ä»ç„¶å‡ºç°ç›¸åŒçš„é”™è¯¯ã€‚å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·ç»§ç»­ä»¥ä¸‹æ­¥éª¤ã€‚</p></li><li><p>æ°¸ä¹…å¢åŠ  <code>vm.max_map_count</code>çš„å€¼ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿé‡å¯åä»ç„¶ç”Ÿæ•ˆã€‚</p></li><li><p>æ‰“å¼€ <code>/etc/sysctl.conf</code>æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼š<code>sudo nano /etc/sysctl.conf</code></p></li><li><p>åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">vm.max_map_count</span>=<span class="hljs-number">262144</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo sysctl -p<br></code></pre></td></tr></table></figure></li><li><p>å°è¯•é‡æ–°å¯åŠ¨<code> Elasticsearch</code>ï¼Œåº”è¯¥ä¸å†å‡ºç°ç›¸åŒçš„é”™è¯¯ã€‚</p></li></ol></blockquote><h4 id="Bug4"><a href="#Bug4" class="headerlink" title="Bug4"></a>Bug4</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">æŠ¥é”™ï¼š<br><span class="hljs-selector-attr">[es-node0]</span> error updating geoip database <span class="hljs-selector-attr">[GeoLite2-Country.mmdb]</span><br><span class="hljs-selector-attr">[2023-08-14T13:20:16,526]</span><span class="hljs-selector-attr">[ERROR]</span><span class="hljs-selector-attr">[o.e.i.g.GeoIpDownloader  ]</span> <span class="hljs-selector-attr">[es-node0]</span> error updating geoip database <span class="hljs-selector-attr">[GeoLite2-City.mmdb]</span><br>java<span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.SocketException</span>: Connection reset<br><br></code></pre></td></tr></table></figure><h4 id="Bug5"><a href="#Bug5" class="headerlink" title="Bug5"></a>Bug5</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">æŠ¥é”™ï¼š<br>at TCPConnectWrap<span class="hljs-selector-class">.afterConnect</span> <span class="hljs-selector-attr">[as oncomplete]</span> (node:net:<span class="hljs-number">1278</span>:<span class="hljs-number">16</span>) &#123;<br>  errno: -<span class="hljs-number">111</span>,<br>  <span class="hljs-selector-tag">code</span>: <span class="hljs-string">&#x27;ECONNREFUSED&#x27;</span>,<br>  syscall: <span class="hljs-string">&#x27;connect&#x27;</span>,<br>  <span class="hljs-selector-tag">address</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>  port: <span class="hljs-number">9200</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Bug6"><a href="#Bug6" class="headerlink" title="Bug6"></a>Bug6</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//kibanaå¯è§†åŒ–é¡µé¢æç¤ºï¼Œserver.publicBaseUrl ç¼ºå¤±ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œæ—¶åº”é…ç½®ã€‚æŸäº›åŠŸèƒ½å¯èƒ½è¿è¡Œä¸æ­£å¸¸</span><br></code></pre></td></tr></table></figure><p>è§£å†³ï¼š</p><blockquote><p>å½“æ‚¨åœ¨ Kibana ä¸­çœ‹åˆ° <code>server.publicBaseUrl</code> ç¼ºå¤±çš„è­¦å‘Šæ—¶ï¼Œè¿™æ„å‘³ç€æ‚¨éœ€è¦é…ç½® <code>server.publicBaseUrl</code> è®¾ç½®ã€‚è¿™ä¸ªè®¾ç½®ç”¨äºæŒ‡å®š Kibana çš„å…¬å…±åŸºæœ¬ URLï¼Œä»¥ä¾¿åœ¨ç”Ÿæˆçš„é“¾æ¥ä¸­ä½¿ç”¨ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š</p><ol><li>æ‰“å¼€ Kibana çš„é…ç½®æ–‡ä»¶ <code>kibana.yml</code>ã€‚</li><li>åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ° <code>server.publicBaseUrl</code> è®¾ç½®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼Œè¯·æ·»åŠ å®ƒï¼‰ã€‚</li><li>å°† <code>server.publicBaseUrl</code> è®¾ç½®ä¸ºæ‚¨çš„ Kibana çš„å…¬å…±åŸºæœ¬ URLã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Kibana æ˜¯é€šè¿‡ <code>http://example.com/kibana</code> è®¿é—®çš„ï¼Œé‚£ä¹ˆæ‚¨çš„è®¾ç½®å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server.publicBaseUrl:</span> <span class="hljs-string">&quot;http://example.com/kibana&quot;</span><br></code></pre></td></tr></table></figure><ol><li>ä¿å­˜é…ç½®æ–‡ä»¶å¹¶é‡æ–°å¯åŠ¨ Kibanaã€‚</li></ol><p>é‡æ–°å¯åŠ¨åï¼Œè­¦å‘Šåº”è¯¥ä¸å†æ˜¾ç¤ºï¼Œå¹¶ä¸” Kibana çš„æŸäº›åŠŸèƒ½ï¼ˆå¦‚ç”Ÿæˆçš„é“¾æ¥ï¼‰åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p><p>è¯·æ³¨æ„ï¼Œ<code>server.publicBaseUrl</code> è®¾ç½®çš„å€¼åº”è¯¥æ˜¯æ‚¨å®é™…ä½¿ç”¨çš„å…¬å…±åŸºæœ¬ URLï¼Œç¡®ä¿å®ƒä¸æ‚¨çš„éƒ¨ç½²ç¯å¢ƒç›¸åŒ¹é…ã€‚</p><p>å¦‚æœä½ åªæ˜¯æœ¬åœ°å­¦ä¹ ï¼Œé‚£ä¹ˆå°†ä½ çš„server.publicBaseUrlé…ç½®ä¸ºæœ¬åœ°idå³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server.publicBaseUrl:</span> <span class="hljs-string">&quot;http://192.168.161.128:5601&quot;</span><br></code></pre></td></tr></table></figure></blockquote><h4 id="Bug7"><a href="#Bug7" class="headerlink" title="Bug7"></a>Bug7</h4><p>ikæ’ä»¶ç‰ˆæœ¬å·ä¸elasticsearchç‰ˆæœ¬å·ä¸ä¸€è‡´æŠ¥é”™</p><blockquote><p>è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹   &#x2F;opt&#x2F;resource&#x2F;elasticsearch-7.17.9&#x2F;plugins&#x2F;ik&#x2F;plugin-descriptor.propertiesæ–‡ä»¶å†…å®¹ï¼Œå°†ç‰ˆæœ¬å·æ”¹ä¸ºä¸€è‡´</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230814195234385.png" alt="image-20230814195234385"></p></blockquote><h2 id="Elasticsearchå¼€å¯å¯†ç "><a href="#Elasticsearchå¼€å¯å¯†ç " class="headerlink" title="Elasticsearchå¼€å¯å¯†ç "></a>Elasticsearchå¼€å¯å¯†ç </h2><h3 id="é…ç½®ï¼š"><a href="#é…ç½®ï¼š" class="headerlink" title="é…ç½®ï¼š"></a>é…ç½®ï¼š</h3><ol><li>ä¿®æ”¹esçš„é…ç½®æ–‡ä»¶ï¼š&#x2F;opt&#x2F;resource&#x2F;elasticsearch-7.17.9&#x2F;config&#x2F;elasticsearch.ymlï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">xpack.security.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">xpack.license.self_generated.type:</span> <span class="hljs-string">basic</span><br><span class="hljs-attr">xpack.security.transport.ssl.enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><ol start="2"><li>ç§»åŠ¨åˆ°<code>/opt/resource/elasticsearch-7.17.9/bin</code>ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./elasticsearch-setup-passwords interactive<br></code></pre></td></tr></table></figure><ol start="3"><li>è®¾ç½®å…­ä¸ªè´¦å·çš„å¯†ç ï¼šelastic,apm_system,kibana,logstash_system,beats_system,remote_monitoring_user</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#å¯†ç è‡ªå·±éšæ„è®¾ç½®å°±å¥½</span><br><span class="hljs-attr">elastic:</span> <span class="hljs-number">158574</span><br><span class="hljs-attr">apm_system:</span> <span class="hljs-number">112830</span><br><span class="hljs-attr">kibana_system:</span> <span class="hljs-number">158574</span><br><span class="hljs-attr">logstash_system:</span> <span class="hljs-number">112830</span><br><span class="hljs-attr">beats_system:</span> <span class="hljs-number">112830</span><br><span class="hljs-attr">remote_monitoring_user:</span> <span class="hljs-number">158574</span><br></code></pre></td></tr></table></figure><ol start="4"><li>ä¿®æ”¹<a href="https://so.csdn.net/so/search?q=kibana&spm=1001.2101.3001.7020">kibana</a>çš„é…ç½®<code>kibana.yml</code>ï¼š</li></ol><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">elasticsearch.username:</span> <span class="hljs-string">&quot;elastic&quot;</span><br><span class="hljs-symbol">elasticsearch.password:</span> <span class="hljs-string">&quot;158574&quot;</span><br></code></pre></td></tr></table></figure><ol start="5"><li>elasticsearchä¿®æ”¹å¯†ç çš„å‘½ä»¤å¦‚ä¸‹ï¼š</li></ol><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">curl -H <span class="hljs-string">&quot;Content-Type:application/json&quot;</span> -XPOST -u elastic &#x27;http://192.168.161.128:<span class="hljs-number">9200</span>/_xpack/security/user/elastic/_password&#x27; -d &#x27;&#123; &quot;password&quot; : &quot;<span class="hljs-number">123456</span>&quot; &#125;&#x27;<br></code></pre></td></tr></table></figure><ol start="6"><li>é‡å¯eså’Œkibanaè®¿é—®<a href="http://192.168.161.128:9200ï¼Œéœ€è¦è¾“å…¥è´¦å·å¯†ç æ‰å¯ä»¥è®¿é—®ã€‚">http://192.168.161.128:9200ï¼Œéœ€è¦è¾“å…¥è´¦å·å¯†ç æ‰å¯ä»¥è®¿é—®ã€‚</a></li></ol><h2 id="Elasticsearché…ç½®ikåˆ†è¯å™¨ï¼ˆä¸­æ–‡å‹å¥½ï¼‰"><a href="#Elasticsearché…ç½®ikåˆ†è¯å™¨ï¼ˆä¸­æ–‡å‹å¥½ï¼‰" class="headerlink" title="Elasticsearché…ç½®ikåˆ†è¯å™¨ï¼ˆä¸­æ–‡å‹å¥½ï¼‰"></a>Elasticsearché…ç½®ikåˆ†è¯å™¨ï¼ˆä¸­æ–‡å‹å¥½ï¼‰</h2><p><strong>ä¸€å®šä¸‹è½½ä¸Elasticsearchçš„ç‰ˆæœ¬ä¸€è‡´æˆ–ç›¸è¿‘çš„ç‰ˆæœ¬</strong></p><p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases?q=7.17.7&expanded=true">githubä¸‹è½½åœ°å€</a></p><p>ikåˆ†è¯å™¨æ’ä»¶ä¸‹è½½åä¸Šä¼ è‡³&#x2F;opt&#x2F;resource&#x2F;elasticsearch-7.17.9&#x2F;plugins&#x2F;ç›®å½•ä¸‹</p><p>æ–°å»ºç›®å½• mkdir ik </p><p>è¿›å…¥ikç›®å½•ï¼Œä¸Šä¼ ä¸‹è½½å¥½çš„ikåˆ†è¯å™¨</p><p>è§£å‹  unzip + åˆ†è¯å™¨åŒ…å</p><p>è§£å‹åé‡å¯elasticsearchå³å¯</p><p>æµ‹è¯•åˆ†è¯å™¨ï¼šåˆ†è¯å™¨ç§ç±»æœ‰ï¼šik_max_wordï¼ˆå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼‰ï¼Œik_smartï¼ˆæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">POST _analyze<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span>     <span class="hljs-string">&quot;ä½ å¥½æˆ‘æ˜¯ææˆé˜³ï¼Œä½ æ˜¯çœŸçˆ±ç²‰å—ï¼Œæˆ‘æ˜¯ikunã€‚&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>2ã€æ‰©å±•è¯å…¸ä½¿ç”¨<br>         æ‰©å±•è¯å°±æ˜¯ä¸æƒ³è®©é‚£äº›è¯è¢«åˆ†å¼€ï¼Œè®©ä»–ä»¬ç»„æˆä¸€ä¸ªæ­¤ï¼Œæ¯”å¦‚é•¿æ˜¥æ¡¥</p><pre><code class="hljs">1ã€è‡ªå®šä¹‰æ‰©å±•è¯åº“ è¿›å…¥åˆ°config/analysis-ikï¼ˆæ’ä»¶å®‰è£…æ–¹å¼ï¼‰æˆ–/usr/elasticsearch/plugins/analysis-ik/config/ç›®å½•ä¸‹æ–°å¢è‡ªå®šä¹‰è¯å…¸  vi cc_ext_dict.dic è¾“å…¥ï¼šé•¿æ˜¥æ¡¥       2ã€è‡ªå®šä¹‰çš„æ‰©å±•è¯å…¸æ–‡ä»¶æ·»åŠ åˆ°IKAnalyzer.cfg.xmlé…ç½®ä¸­ vi IKAnalyzer.cfg.xml               3ã€é‡å¯es/usr/elasticsearch/bin/elasticsearch</code></pre><p>3ã€åœç”¨è¯å…¸ä½¿ç”¨<br>    åœç”¨è¯å°±æ˜¯åœ¨æ–‡æœ¬ä¸­å‡ºç°é¢‘ç‡å¾ˆé«˜ï¼Œä½†æ˜¯å¯¹è¯­ä¹‰äº§ç”Ÿä¸äº†å¤šå¤§çš„å½±å“ï¼Œæ¯”å¦‚ä¸­æ–‡çš„â€œçš„ã€å“¦ã€äº†ã€å‘¢â€ç­‰ï¼Œè¿™äº›è¯ç§°ä¸ºåœç”¨è¯ã€‚ä¸€èˆ¬ç»å¸¸ä¼šè¢«è¿‡æ»¤æ‰ä¸ä¼šè¿›è¡Œç´¢å¼•</p><pre><code class="hljs">1ã€è‡ªå®šä¹‰åœç”¨è¯åº“è¿›å…¥åˆ°config/analysis-ikï¼ˆæ’ä»¶å®‰è£…æ–¹å¼ï¼‰æˆ–/usr/elasticsearch/plugins/analysis-ik/config/ç›®å½•ä¸‹æ–°å¢è‡ªå®šä¹‰è¯å…¸vi cc_stop_dict.dic è¾“å…¥ çš„ã€å“¦ã€äº†ã€å‘¢</code></pre><p>â€‹        </p><pre><code class="hljs">2ã€æ·»åŠ åˆ°IKAnalyzer.cfg.xmlé…ç½®ä¸­3ã€é‡å¯es/usr/elasticsearch/bin/elasticsearch</code></pre><p> 4ã€åŒä¹‰è¯å…¸ä½¿ç”¨ï¼š<br>        æ„æ€ç›¸åŒçš„è¯ï¼Œåœ¨æœç´¢æ—¶åº”è¯¥åŒæ—¶æŸ¥å‡ºæ¥ï¼Œæ¯”å¦‚â€œé¦’å¤´â€å’Œâ€œé¦â€ï¼Œè¿™ç§æƒ…å†µå«åšåŒä¹‰è¯æŸ¥è¯¢</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs json">æ³¨æ„ï¼šæ‰©å±•è¯å’Œåœç”¨è¯æ—¶åœ¨ç´¢å¼•çš„æ—¶å€™ä½¿ç”¨ï¼ŒåŒä¹‰è¯æ˜¯æ£€ç´¢çš„æ—¶å€™<br><br><span class="hljs-number">1</span>ã€åˆ›å»ºsynonym.txt<br>vi synonym.txt è¾“å…¥åŒä¹‰è¯<br><br><span class="hljs-number">2</span>ã€é‡å¯es<br>/usr/elasticsearch/bin/elasticsearch<br><br><span class="hljs-number">3</span>ã€ä½¿ç”¨æ˜¯æŒ‡å®šsynonym.text<br>å‰ç¼€è·¯å¾„ä¸ºï¼š/usr/elasticsearch/config/ <br><br>analysis<span class="hljs-punctuation">:</span>ä¸ºè‡ªå·±åˆ›å»ºçš„ç›®å½•<br><br>PUT /cc003<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;analysis&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;word_sync&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;synonym&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;synonyms_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;analysis/synonym.txt&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;ik_sync_max_word&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;word_sync&quot;</span><br>          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;tokenizer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;ik_sync_smart&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;word_sync&quot;</span><br>          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;tokenizer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_sync_max_word&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_sync_max_word&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-number">4</span>ã€æ·»åŠ å†…å®¹<br>POST /cc003/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;é¦’å¤´ä½ ä»¬å“ªé‡Œå«ä»€ä¹ˆ&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-number">5</span>ã€æŸ¥è¯¢<br>POST /cc003/_doc/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é¦&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><h2 id="Elasticsearchè¯­æ³•"><a href="#Elasticsearchè¯­æ³•" class="headerlink" title="Elasticsearchè¯­æ³•"></a>Elasticsearchè¯­æ³•</h2><p>kibana  DevTools(æœ¬è´¨:restfulè¯·æ±‚)</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/query-dsl-match-all-query.html">ä¸­æ–‡æ–‡æ¡£</a></p><p><a href="https://blog.csdn.net/qq_38011415/article/details/111862429">7xç‰ˆæœ¬DSLè¯­æ³•å¤§å…¨</a></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0">DSLè¯­æ³•å®˜ç½‘æ–‡æ¡£</a></p>]]></content>
    
    
    <categories>
      
      <category>æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>Elasticsearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Yang-Api</title>
    <link href="/2023/09/14/Yang-Api/"/>
    <url>/2023/09/14/Yang-Api/</url>
    
    <content type="html"><![CDATA[<h1 id="yangapi-backend"><a href="#yangapi-backend" class="headerlink" title="yangapi_backend"></a>yangapi_backend</h1><h2 id="æ•°æ®åº“è¡¨è®¾è®¡"><a href="#æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡"></a>æ•°æ®åº“è¡¨è®¾è®¡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sql">use api_backend;<br><br><span class="hljs-comment">-- ç”¨æˆ·è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span><br>(<br>    id           <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    userName     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·æ˜µç§°&#x27;</span>,<br>    userAccount  <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è´¦å·&#x27;</span>,<br>    userAvatar   <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                          <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·å¤´åƒ&#x27;</span>,<br>    gender       tinyint                                <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span>,<br>    userRole     <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;user&#x27;</span>            <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·è§’è‰²ï¼šuser / admin&#x27;</span>,<br>    userPassword <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å¯†ç &#x27;</span>,<br>    createTime   datetime     <span class="hljs-keyword">default</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime   datetime     <span class="hljs-keyword">default</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete     tinyint      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span>,<br>    <span class="hljs-keyword">constraint</span> uni_userAccount<br>        <span class="hljs-keyword">unique</span> (userAccount)<br>) comment <span class="hljs-string">&#x27;ç”¨æˆ·&#x27;</span>;<br><br><span class="hljs-comment">-- æ¥å£ä¿¡æ¯è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span>  `interface_info`<br>(<br>    `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment comment <span class="hljs-string">&#x27;ä¸»é”®&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>,<br>    `description` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æè¿°&#x27;</span>,<br>    `url` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ¥å£åœ°å€&#x27;</span>,<br>    `requestHeader` text <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è¯·æ±‚å¤´&#x27;</span>,<br>    `responseHeader` text <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å“åº”å¤´&#x27;</span>,<br>    `userId` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºäºº&#x27;</span>,<br>    `status` <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ¥å£çŠ¶æ€ï¼ˆ0 - å…³é—­ï¼Œ 1 - å¼€å¯ï¼‰ï¼‰&#x27;</span>,<br>    `<span class="hljs-keyword">method</span>` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è¯·æ±‚ç±»å‹&#x27;</span>,<br>    `createTime` datetime <span class="hljs-keyword">default</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    `updateTime` datetime <span class="hljs-keyword">default</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    `isDelete` tinyint <span class="hljs-keyword">default</span> <span class="hljs-number">0</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )&#x27;</span><br>) comment <span class="hljs-string">&#x27;æ¥å£ä¿¡æ¯è¡¨&#x27;</span>;<br><br><span class="hljs-comment">-- æ¥å£ç”¨æˆ·å…³è”è¡¨</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> api_backend.user_interface_info<br>(<br>    id              <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;ä¸»é”®&#x27;</span><br>        <span class="hljs-keyword">primary</span> key,<br>    userId          <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è°ƒç”¨ç”¨æˆ· id&#x27;</span>,<br>    interfaceInfoId <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ¥å£ id&#x27;</span>,<br>    totalNum        <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ€»è°ƒç”¨æ¬¡æ•°&#x27;</span>,<br>    leftNum         <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å‰©ä½™è°ƒç”¨æ¬¡æ•°&#x27;</span>,<br>    status          <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;0-æ­£å¸¸ï¼Œ1-ç¦ç”¨&#x27;</span>,<br>    createTime      datetime <span class="hljs-keyword">default</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime      datetime <span class="hljs-keyword">default</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-operator">*</span><span class="hljs-built_in">CURRENT_TIMESTAMP</span><span class="hljs-operator">*</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete        tinyint  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230914091950696.png" alt="image-20230914091950696"></p><h2 id="æ¨¡å—è®¾è®¡"><a href="#æ¨¡å—è®¾è®¡" class="headerlink" title="æ¨¡å—è®¾è®¡:"></a>æ¨¡å—è®¾è®¡:</h2><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230914091605034.png" alt="image-20230914091605034"></p><h2 id="ç³»ç»Ÿæ¶æ„ï¼š"><a href="#ç³»ç»Ÿæ¶æ„ï¼š" class="headerlink" title="ç³»ç»Ÿæ¶æ„ï¼š"></a>ç³»ç»Ÿæ¶æ„ï¼š</h2><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230914095725115.png" alt="image-20230914095725115"></p><h2 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h2><p>é˜³apiå¼€æ”¾å¹³å°</p><p>å‰ç«¯æµç¨‹ï¼š</p><ol><li><p>è·å–openapiï¼Œjsonæ–‡æ¡£ï¼Œä½¿ç”¨openapiæ’ä»¶è‡ªåŠ¨ç”Ÿæˆå‰ç«¯ä»£ç .</p></li><li><p>ä¿®æ”¹requesterrorConfig.tsä¸ºrequestConfig.ts,ä¿®æ”¹é‡Œé¢çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804190344529.png" alt="image-20230804190344529"></p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804190605667.png" alt="image-20230804190605667"></p></li><li><p>ä¿®æ”¹ç™»å½•é¡µé¢ï¼Œæ‰¾åˆ°USERçš„Loginç›®å½•çš„Index.tsxæ‰¾åˆ°é‡Œé¢çš„loginæ–¹æ³•</p></li><li><p>app.tsxä¸­çš„getInitStateè·å–å…¨å±€ä¿¡æ¯</p></li><li><p>åœ¨typings.d.tsä¸­çš„æœ€ä¸‹é¢æ·»åŠ å¦‚ä¸‹æ¥å£</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å…¨å±€çŠ¶æ€ç±»å‹</span><br><span class="hljs-comment"> * å­˜å…¨å±€å˜é‡çš„åœ°æ–¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">InitialState</span> &#123;<br>  <span class="hljs-attr">loginUser</span>: <span class="hljs-variable constant_">API</span>.<span class="hljs-property">UserVO</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹app.tsxçš„å¦‚ä¸‹ä½ç½®</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804194122778.png" alt="image-20230804194122778"></p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804195142417.png" alt="image-20230804195142417"></p></li><li><p>æ ¹æ®æç¤ºåˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„å¯¼å…¥</p></li><li><p>è¿›å…¥User Login indexç›®å½•ä¸‹ç»§ç»­ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804232907284.png" alt="image-20230804232907284">åˆ é™¤æ‰æ²¡ç”¨çš„ä»£ç </p></li><li><p>å›åˆ°requestConfigä¿®æ”¹å¦‚ä¸‹ä»£ç ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804233437537.png" alt="image-20230804233437537"></p></li><li><p>è§£å†³ç”¨æˆ·æƒé™é—®é¢˜ï¼Œè¿›å…¥access.tsæ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹</p></li></ol><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230804233634344.png" alt="image-20230804233634344"></p><ol start="11"><li><p>è¿›å…¥TableListçš„index.tsxæ‰¾åˆ°tablelistæ–¹æ³•ï¼Œç‚¹å‡»columnsæ¢æˆè‡ªå·±æƒ³å±•ç¤ºçš„åˆ—è¡¨åˆ—å</p></li><li><p>æ‰¾åˆ°requestï¼Œæ›´æ”¹å±•ç¤ºåˆ—è¡¨æ•°æ®çš„æ–¹æ³•</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230805004753476.png" alt="image-20230805004753476"></p></li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts">request=&#123;<span class="hljs-keyword">async</span> (params, <span class="hljs-attr">sort</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">SortOrder</span>&gt;, <span class="hljs-attr">filter</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, (<span class="hljs-built_in">string</span> | <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactText</span>)[] | <span class="hljs-literal">null</span>&gt;) =&gt; &#123;<br>          <span class="hljs-keyword">const</span> res =<span class="hljs-keyword">await</span> <span class="hljs-title function_">listInterfaceInfoByPageUsingGET</span>(&#123;<br>            ...params<br>          &#125;)<br>          <span class="hljs-keyword">if</span> (res?.<span class="hljs-property">data</span>) &#123;<br>            <span class="hljs-keyword">return</span> &#123;<br>              <span class="hljs-attr">data</span>: res?.<span class="hljs-property">data</span>.<span class="hljs-property">records</span> || [],<br>              <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,<br>              <span class="hljs-attr">total</span>: res.<span class="hljs-property">total</span>,<br>            &#125;<br>        &#125;<br>        &#125;&#125;<br></code></pre></td></tr></table></figure><ol start="13"><li><p>ä¿®æ”¹TableListç›®å½•ä¸ºinterfaceInfoï¼Œä¿®æ”¹é‡Œé¢çš„å†…å®¹ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230805092834963.png" alt="image-20230805092834963"></p></li></ol><h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><ol><li><p>å‰ç«¯ä¿®æ”¹ä¿¡æ¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¿®æ”¹ä¿¡æ¯æ—¶ï¼Œæ²¡æœ‰ä¼ é€’idåˆ—ï¼Œå¯¼è‡´ä¿®æ”¹åidåˆ—ä¼ ç»™åç«¯çš„idä¸ºnullï¼Œåç«¯å› ä¸ºidä¸èƒ½ä¸ºç©ºæ‰€ä»¥ç³»ç»ŸæŠ¥é”™ã€‚</p><p>è§£å†³æ–¹æ³•åº”è¯¥ä¿®æ”¹å‰ç«¯ï¼Œè®©å‰ç«¯ä¿®æ”¹æ—¶å¸¦ä¸Šidã€‚</p></li><li><p>ä¿®æ”¹ç”¨æˆ·ä¸»é¡µé¡µè„šéšæ•°æ®çš„å‡å°‘è€Œæ”¹åŠ¨</p></li></ol><h2 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h2><ul><li>æ–°å»ºç”¨æˆ·ä¸­å¿ƒé¡µé¢ï¼Œæ¯”å¦‚ç­¾åå¯èƒ½æ³„éœ²ï¼Œç”¨æˆ·ç”³è¯·æ›´æ¢accessKey</li></ul><h2 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h2><p>åç«¯æ­¥éª¤:</p><ol><li>APIç­¾åè®¤è¯</li><li>å®¢æˆ·ç«¯SDKå¼€å‘ï¼ˆstaterï¼‰</li></ol><h2 id="apiç­¾åè®¤è¯"><a href="#apiç­¾åè®¤è¯" class="headerlink" title="apiç­¾åè®¤è¯"></a>apiç­¾åè®¤è¯</h2><p>æœ¬è´¨ï¼š</p><ol><li>ç­¾å‘ç­¾å</li><li>ä½¿ç”¨ç­¾åï¼ˆæ•ˆéªŒç­¾åï¼‰</li></ol><p>éœ€è¦çš„åŸå› ï¼š</p><ol><li>ä¿è¯å®‰å…¨æ€§ï¼Œä¸èƒ½éšæ„ä¸€ä¸ªäººè°ƒç”¨</li></ol><p>å¯†ç ä¸€å®šä¸è¦åœ¨æœåŠ¡å™¨ä¼ è¾“</p><p>åŠ å¯†æ–¹æ³•ï¼šmd5ï¼ˆä¸å¯è§£å¯†ï¼‰</p><h2 id="starteråˆ›å»ºæµç¨‹"><a href="#starteråˆ›å»ºæµç¨‹" class="headerlink" title="starteråˆ›å»ºæµç¨‹"></a>starteråˆ›å»ºæµç¨‹</h2><ul><li>å»ºç«‹ä¸€ä¸ªMavenç©ºé¡¹ç›®</li><li>åˆ é™¤æ‰ä¸å¿…è¦çš„ç›®å½•</li><li>å¼•å…¥å¿…è¦çš„ä¾èµ–(å¦‚æœåˆ›å»ºæ—¶pomæ–‡ä»¶ä¸­å­˜åœ¨&lt; build &gt;ä¸€å®šè¦åˆ é™¤)</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.yangapi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>yangapi-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>com-yangapi-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>com.yangapi-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºé…ç½®ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;yangapi.client&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ComponentScan</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YangApiClientConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String accessKey;<br>    <span class="hljs-keyword">private</span> String secretKey;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> YangApiClient <span class="hljs-title function_">yangApiClient</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YangApiClient</span>(accessKey,secretKey);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºå®¢æˆ·ç«¯ï¼ˆç”¨äºæ¥æ”¶akï¼Œskæ ¡éªŒï¼Œå¹¶ä¸”è°ƒç”¨æ¨¡æ‹Ÿæ¥å£ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YangApiClient</span> &#123;<br>    <span class="hljs-comment">//è°ƒç”¨æ–¹</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String accessKey;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String secretKey;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YangApiClient</span><span class="hljs-params">(String accessKey, String secretKey)</span> &#123;<br>        <span class="hljs-built_in">this</span>.accessKey = accessKey;<br>        <span class="hljs-built_in">this</span>.secretKey = secretKey;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRandomAvatar</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">avatarUrl</span> <span class="hljs-operator">=</span> HttpUtil.get(<span class="hljs-string">&quot;http://localhost:8100/api/yangapi/random-avatar&quot;</span>);<br>        <span class="hljs-keyword">return</span> avatarUrl;<br>    &#125;;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ å¯†sk(éšè—sk)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> body</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Map&lt;String,String&gt; <span class="hljs-title function_">setHeader</span><span class="hljs-params">(String body)</span>&#123;<br>        Map&lt;String,String&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;accessKey&quot;</span>,accessKey);<br>        <span class="hljs-comment">//éšæœºæ•°</span><br>        hashMap.put(<span class="hljs-string">&quot;body&quot;</span>,body);<br>        <span class="hljs-comment">//æ—¶é—´æˆ³</span><br>        hashMap.put(<span class="hljs-string">&quot;nonce&quot;</span>, RandomUtil.randomNumbers(<span class="hljs-number">5</span>));<br>        <span class="hljs-comment">//ç­¾å</span><br>        hashMap.put(<span class="hljs-string">&quot;timestamp&quot;</span>, String.valueOf(System.currentTimeMillis() / <span class="hljs-number">1000</span>));<br>        hashMap.put(<span class="hljs-string">&quot;sign&quot;</span>, SignUtils.getSign(body,secretKey));<br>        <span class="hljs-keyword">return</span> hashMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNewsRankingList</span><span class="hljs-params">( Total total)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> JSONUtil.toJsonStr(total);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> HttpRequest.post(<span class="hljs-string">&quot;http://localhost:8100/api/yangapi/top-news&quot;</span>)<br>                .addHeaders(setHeader(json))<br>                .body(json)<br>                .execute().body();<br>        <span class="hljs-keyword">return</span> body;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºMETA-INFç›®å½•</li><li>åœ¨META-INFç›®å½•ä¸‹åˆ›å»ºspring.factories</li><li>åœ¨spring.factoriesä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ä»£ç </li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">#spring boot stater<br>org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.yangapi.sdk.YangApiClientConfig<br></code></pre></td></tr></table></figure><ul><li>åœ¨pomæ–‡ä»¶ä¸­å‘½åstarterä¸ºAPI-SDK(éšæ„å‘½å)</li><li>ä½¿ç”¨mavenå‘½ä»¤installæˆ–è€…packageæ‰“åŒ…é¡¹ç›®</li><li>å¯ä»¥å‘é€åˆ°mavenå®˜æ–¹ä»“åº“ï¼Œè‡ªç”¨çš„è¯å…ˆæ‰¾åˆ°è¯¥jaråŒ…ï¼Œç„¶åÂ·ç›´æ¥åœ¨å…¶ä»–é¡¹ç›®å¼•å…¥å³å¯ã€‚</li></ul><h2 id="gatewayä¸­ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼"><a href="#gatewayä¸­ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="gatewayä¸­ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼"></a>gatewayä¸­ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼</h2><p>åˆ©ç”¨reponseè£…é¥°è€…ï¼Œå¢å¼ºresponseï¼Œä½¿ä»–å¯ä»¥è¾“å‡ºç›¸åº”æ—¥å¿—å’Œç›¸å…³çš„ä¸šåŠ¡æ“ä½œæ¯”å¦‚è°ƒç”¨æ¥å£æ¬¡æ•°â€”+1</p><p>è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨ response è£…é¥°è€…ï¼Œå¢å¼ºåŸæœ‰ response çš„å¤„ç†èƒ½åŠ›</p><p>å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/qq_19636353/article/details/126759522">https://blog.csdn.net/qq_19636353/article/details/126759522</a></p><p>å…¶ä»–å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/zx156955/article/details/121670681">https://blog.csdn.net/zx156955/article/details/121670681</a></p><p><a href="https://blog.csdn.net/weixin_43933728/article/details/121359727?spm=1001.2014.3001.5501">https://blog.csdn.net/weixin_43933728/article/details/121359727?spm=1001.2014.3001.5501</a></p><p><a href="https://blog.csdn.net/qq_39529562/article/details/108911983">https://blog.csdn.net/qq_39529562/article/details/108911983</a></p><h2 id="apiç½‘å…³-gateway"><a href="#apiç½‘å…³-gateway" class="headerlink" title="apiç½‘å…³(gateway)"></a>apiç½‘å…³(gateway)</h2><p><a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-combined-global-filter-and-gatewayfilter-ordering">ç¼–å†™å…¨å±€è¿‡æ»¤å™¨ç¼–å†™ç»Ÿä¸€ä¸šåŠ¡ä»£ç </a></p><ul><li><p>å¢åˆ æ”¹æŸ¥</p></li><li><p>ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°ï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</p></li></ul><p>æ ¸å¿ƒæ¦‚å¿µï¼š</p><ul><li><p>æ¡ä»¶ï¼Œç®€ç§°æ–­è¨€</p></li><li><p>è·¯ç”±ï¼šï¼ˆ<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">æ ¹æ®ä»€ä¹ˆæ¡ä»¶ï¼Œè½¬å‘åˆ°æŒ‡å®šè·¯ç”±</a>ï¼‰</p></li><li><p>è·¯ç”±åŒ¹é…ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">predicates:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/red/&#123;segment&#125;,/blue/&#123;segment&#125;</span><br></code></pre></td></tr></table></figure><ol><li><p><code>/red/&#123;segment&#125;</code>ï¼šè¿™ä¸ªè§„åˆ™åŒ¹é…ä»¥<code>/red/</code>å¼€å¤´çš„è·¯å¾„ï¼Œå¹¶ä¸”<code>&#123;segment&#125;</code>æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œè¡¨ç¤ºè·¯å¾„ä¸­çš„ä¸€ä¸ªå˜é‡ã€‚ä¾‹å¦‚ï¼Œ<code>/red/apple</code>å’Œ<code>/red/orange</code>éƒ½ä¼šåŒ¹é…åˆ°è¿™ä¸ªè§„åˆ™ã€‚</p></li><li><p><code>/blue/&#123;segment&#125;</code>ï¼šè¿™ä¸ªè§„åˆ™åŒ¹é…ä»¥<code>/blue/</code>å¼€å¤´çš„è·¯å¾„ï¼Œå¹¶ä¸”<code>&#123;segment&#125;</code>æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œè¡¨ç¤ºè·¯å¾„ä¸­çš„ä¸€ä¸ªå˜é‡ã€‚ä¾‹å¦‚ï¼Œ<code>/blue/apple</code>å’Œ<code>/blue/orange</code>éƒ½ä¼šåŒ¹é…åˆ°è¿™ä¸ªè§„åˆ™ã€‚</p></li><li><pre><code class="java">Map&lt;String, String&gt; uriVariables = ServerWebExchangeUtils.getUriTemplateVariables(exchange);String segment = uriVariables.get(&quot;segment&quot;);//è¿™æ®µä»£ç æ˜¯ç”¨äºä»ServerWebExchangeå¯¹è±¡ä¸­è·å–URIæ¨¡æ¿å˜é‡çš„å€¼ã€‚//é¦–å…ˆï¼ŒServerWebExchangeæ˜¯Spring WebFluxä¸­çš„ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªHTTPè¯·æ±‚å’Œå“åº”çš„äº¤æ¢ã€‚getUriTemplateVariables()æ˜¯ServerWebExchangeUtilså·¥å…·ç±»ä¸­çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºä»ServerWebExchangeå¯¹è±¡ä¸­æå–URIæ¨¡æ¿å˜é‡çš„å€¼ã€‚//åœ¨ç»™å®šçš„ä»£ç ä¸­ï¼ŒuriVariablesæ˜¯ä¸€ä¸ªMap&lt;String, String&gt;ç±»å‹çš„å˜é‡ï¼Œç”¨äºå­˜å‚¨URIæ¨¡æ¿å˜é‡çš„åç§°å’Œå¯¹åº”çš„å€¼ã€‚é€šè¿‡è°ƒç”¨ServerWebExchangeUtils.getUriTemplateVariables(exchange)ï¼Œå¯ä»¥ä»ServerWebExchangeå¯¹è±¡ä¸­æå–URIæ¨¡æ¿å˜é‡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨uriVariablesä¸­ã€‚//æ¥ä¸‹æ¥ï¼Œé€šè¿‡è°ƒç”¨uriVariables.get(&quot;segment&quot;)ï¼Œå¯ä»¥è·å–åä¸º&quot;segment&quot;çš„URIæ¨¡æ¿å˜é‡çš„å€¼ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™segmentå˜é‡ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åç»­çš„ä»£ç ä¸­ä½¿ç”¨segmentå˜é‡æ¥å¤„ç†è¿™ä¸ªURIæ¨¡æ¿å˜é‡çš„å€¼ã€‚  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br>- è¿‡æ»¤å™¨ï¼ˆ æ·»åŠ è¯·æ±‚å¤´æ ‡è¯†ï¼‰<br><br>  <br><br>------<br><br>### ä»¤ç‰Œæ¡¶ï¼Œæ¼æ¡¶ï¼Œè®¡æ•°å™¨ç®—æ³•<br><br>#### **æ¦‚è¿°ï¼š**<br><br>ï¼ˆ1ï¼‰è®¡æ•°å™¨ï¼š<br><br>åœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…ï¼ˆæ—¶é—´çª—/æ—¶é—´åŒºé—´ï¼‰ï¼Œå¤„ç†è¯·æ±‚çš„æœ€å¤§æ•°é‡å›ºå®šï¼Œè¶…è¿‡éƒ¨åˆ†ä¸åšå¤„ç†ã€‚<br><br>ï¼ˆ2ï¼‰æ¼æ¡¶ï¼š<br><br>æ¼æ¡¶å¤§å°å›ºå®šï¼Œå¤„ç†é€Ÿåº¦å›ºå®šï¼Œä½†è¯·æ±‚è¿›å…¥é€Ÿåº¦ä¸å›ºå®šï¼ˆåœ¨çªå‘æƒ…å†µè¯·æ±‚è¿‡å¤šæ—¶ï¼Œä¼šä¸¢å¼ƒè¿‡å¤šçš„è¯·æ±‚ï¼‰ã€‚<br><br>ï¼ˆ3ï¼‰ä»¤ç‰Œæ¡¶ï¼š<br><br>ä»¤ç‰Œæ¡¶çš„å¤§å°å›ºå®šï¼Œä»¤ç‰Œçš„äº§ç”Ÿé€Ÿåº¦å›ºå®šï¼Œä½†æ˜¯æ¶ˆè€—ä»¤ç‰Œï¼ˆå³è¯·æ±‚ï¼‰é€Ÿåº¦ä¸å›ºå®šï¼ˆå¯ä»¥åº”å¯¹ä¸€äº›æŸäº›æ—¶é—´è¯·æ±‚è¿‡å¤šçš„æƒ…å†µï¼‰ï¼›æ¯ä¸ªè¯·æ±‚éƒ½ä¼šä»ä»¤ç‰Œæ¡¶ä¸­å–å‡ºä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰ä»¤ç‰Œåˆ™ä¸¢å¼ƒè¯¥æ¬¡è¯·æ±‚ã€‚<br><br>[ä¸‰ç§ç®—æ³•è¯¦ç»†è®²è§£](https://blog.csdn.net/crazymakercircle/article/details/130035504?ydreferer=aHR0cHM6Ly9jbi5iaW5nLmNvbS8%3D)<br><br><br><br><br><br>### é™çº§å¯è¿è¡Œé»˜è®¤é…ç½®<br><br>#### éååº”å¼é…ç½®<br><br>**å‰æï¼š**<br><br>- `org.springframework.cloud:spring-cloud-starter-circuitbreaker-resilience4j`- éååº”æ€§åº”ç”¨<br>- `org.springframework.cloud:spring-cloud-starter-circuitbreaker-reactor-resilience4j`- ååº”å¼åº”ç”¨<br><br>*å¼•å…¥éååº”å¼ï¼š*<br><br>```xml<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--æ–­è·¯å™¨è¿‡æ»¤å™¨ä¾èµ–,é™çº§--&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-circuitbreaker-reactor-resilience4j --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-circuitbreaker-reactor-resilience4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></code></pre></li></ol></li></ul><p><strong>ymlé…ç½®ï¼š</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8100</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">org.springframework.cloud.gateway:</span> <span class="hljs-string">trace</span>   <span class="hljs-comment">#æ—¥å¿—çº§åˆ« traceä¸ºæœ€ä½</span><br>    <span class="hljs-attr">reactor.netty.http.client:</span> <span class="hljs-string">debug</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">default-filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=lcy,yangapi</span>   <span class="hljs-comment">#é»˜è®¤è¿‡æ»¤å™¨ï¼Œæ·»åŠ è¯·æ±‚å¤´,æ‰€æœ‰å®šä¹‰çš„è·¯ç”±éƒ½ä¼šæ·»åŠ è¿™ä¸ªè¯·æ±‚å¤´</span><br>      <span class="hljs-attr">routes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">path_route</span><br>        <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8090</span>  <span class="hljs-comment">#é‡å®šå‘çš„è·¯ç”±åœ°å€,è‡ªåŠ¨æ‹¼æ¥/api/**</span><br>        <span class="hljs-attr">predicates:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/**</span><br>        <span class="hljs-attr">filters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=gateway-env,</span> <span class="hljs-string">springcloud-gateway</span>  <span class="hljs-comment">#æ·»åŠ è¯·æ±‚å¤´,key:gateway-env,values:springcloud-gateway</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CircuitBreaker</span><br>            <span class="hljs-attr">args:</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">myCircuitBreaker</span><br>              <span class="hljs-attr">fallbackUri:</span> <span class="hljs-string">forward:/api/yangapi/fallback</span>   <span class="hljs-comment"># å¦‚æœè®¿é—®ä¸é€šï¼Œåˆ™é™çº§è®¿é—®å…¶ä»–uri</span><br>              <span class="hljs-attr">timeout:</span> <span class="hljs-number">2000</span>  <span class="hljs-comment">#è¶…æ—¶æ—¶é—´2000  å“åº”è¶…è¿‡2ç§’é™çº§è®¿é—®fallbacké¡µé¢</span><br><br><span class="hljs-attr">resilience4j:</span><br>  <span class="hljs-attr">circuitbreaker:</span><br>    <span class="hljs-attr">configs:</span><br>      <span class="hljs-attr">default:</span> <span class="hljs-comment">#é»˜è®¤</span><br>        <span class="hljs-attr">ringBufferSizeInClosedState:</span> <span class="hljs-number">100</span><br>        <span class="hljs-attr">ringBufferSizeInHalfOpenState:</span> <span class="hljs-number">10</span><br>        <span class="hljs-attr">failureRateThreshold:</span> <span class="hljs-number">50</span><br>        <span class="hljs-attr">waitDurationInOpenState:</span> <span class="hljs-number">5000</span><br>        <span class="hljs-attr">slidingWindowSize:</span> <span class="hljs-number">10</span><br>        <span class="hljs-attr">permittedNumberOfCallsInHalfOpenState:</span> <span class="hljs-number">3</span><br>        <span class="hljs-attr">registerHealthIndicator:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">myCircuitBreaker:</span> <span class="hljs-comment">#å®ä¾‹</span><br>        <span class="hljs-attr">ringBufferSizeInClosedState:</span> <span class="hljs-number">50</span><br>        <span class="hljs-attr">ringBufferSizeInHalfOpenState:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">failureRateThreshold:</span> <span class="hljs-number">60</span><br>        <span class="hljs-attr">waitDurationInOpenState:</span> <span class="hljs-number">8000</span><br>        <span class="hljs-attr">slidingWindowSize:</span> <span class="hljs-number">15</span><br>        <span class="hljs-attr">permittedNumberOfCallsInHalfOpenState:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">registerHealthIndicator:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h3><p>æ¥å£æä¾›æ–¹æŠ¥é”™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">java.lang.IllegalArgumentException: Invalid character found in method name. HTTP method names must be tokens<br></code></pre></td></tr></table></figure><p><em><strong>è§£å†³ï¼š</strong></em></p><ol><li>å°†è®¿é—®è·¯å¾„ä»<a href="https://localhost:8080æ”¹ä¸ºhttp://localhost:8080">https://localhost:8080æ”¹ä¸ºhttp://localhost:8080</a></li><li>Tomcatçš„headerç¼“å†²åŒºå¤§å°ä¸å¤Ÿ</li><li>sslè¯ä¹¦åˆ°æœŸäº†</li><li>åŸå› 3: ä¿®æ”¹ç«¯å£å·</li></ol><hr><h2 id="Rpc"><a href="#Rpc" class="headerlink" title="Rpc"></a>Rpc</h2><p>å®ç°æ¦‚å¿µå›¾ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230811103226241.png" alt="image-20230811103226241"></p><h3 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h3><p><a href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/registry/nacos/">nacosæ³¨å†Œä¸­å¿ƒçš„é…ç½®</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.nacos<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>nacos-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ymlé…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Dubboé…ç½®</span><br><span class="hljs-comment">#ç”Ÿäº§è€…ç«¯</span><br><span class="hljs-attr">dubbo:</span><br>  <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-comment"># æ¶ˆè´¹è€…ç›¸å…³é…ç½®</span><br><span class="hljs-comment">#  consumer:</span><br><span class="hljs-comment">#    # ç»“æœç¼“å­˜(LRUç®—æ³•)</span><br><span class="hljs-comment">#    # ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´é—®é¢˜ å»ºè®®åœ¨æ³¨è§£å±€éƒ¨å¼€å¯</span><br><span class="hljs-comment">#    cache: false</span><br><span class="hljs-comment">#    # æ”¯æŒæ ¡éªŒæ³¨è§£</span><br><span class="hljs-comment">#    validation: true</span><br><span class="hljs-comment">#    # è¶…æ—¶æ—¶é—´</span><br><span class="hljs-comment">#    timeout: 3000</span><br>    <span class="hljs-comment"># åˆå§‹åŒ–æ£€æŸ¥</span><br><span class="hljs-comment">#    check: false</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">yangapi-backend</span><br>  <span class="hljs-attr">protocol:</span><br>    <span class="hljs-comment"># dubbo åè®®ç«¯å£(-1è¡¨ç¤ºè‡ªå¢ç«¯å£,ä»20880å¼€å§‹)</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">20880</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">dubbo</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-string">nacos-registry</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">nacos://127.0.0.1:8848</span><br><br><span class="hljs-comment">#æ¶ˆè´¹è€…ç«¯</span><br><span class="hljs-attr">dubbo:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">yangapi-backend</span><br>  <span class="hljs-attr">protocol:</span><br>    <span class="hljs-comment"># dubbo åè®®ç«¯å£(-1è¡¨ç¤ºè‡ªå¢ç«¯å£,ä»20880å¼€å§‹)</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">20881</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">dubbo</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-string">nacos-registry</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">nacos://127.0.0.1:8848</span><br>    <br></code></pre></td></tr></table></figure><h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><p><em><strong>é…ç½®ï¼š</strong></em></p><ol><li><strong>ä¿®æ”¹<code>conf/</code>è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶<code>application.properties</code> å°†ä¸‹å›¾ä¸­çš„æ•°æ®åº“é…ç½®æ³¨é‡Šæ”¾å¼€ï¼ŒåŒæ—¶ä¿®æ”¹æ•°æ®åº“è´¦æˆ·å’Œå¯†ç ï¼› æ­¤ä¸­çš„æ•°æ®åº“<code>nacos</code>ä¸æ­¥éª¤3ä¸­å»ºç«‹çš„æ•°æ®åº“åä¿æŒä¸€è‡´ï¼›</strong></li></ol><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230811125003825.png" alt="image-20230811125003825"></p><ol start="2"><li><strong>æœ¬åœ°åˆ›å»ºMYSQLæ•°æ®åº“nacosï¼Œå¯¼å…¥è§£å‹æ–‡ä»¶å¤¹ä¸­çš„mysql-schema.sqlè„šæœ¬</strong></li></ol><p><em><strong>å¯åŠ¨ï¼š</strong></em></p><ol><li><p>å•æœºï¼š<strong>startup.cmd -m standalone</strong></p></li><li><p>é›†ç¾¤é»˜è®¤åŒå‡»ï¼š<strong>startup.cmd</strong></p></li><li><p>ä¿®æ”¹configç›®å½•çš„application.propertiesï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230811125515389.png" alt="image-20230811125515389"></p></li></ol><p><em><strong>è¿›å…¥ç®¡ç†é¡µé¢ï¼š</strong></em></p><p> <a href="http://192.168.150.105:8848/nacos/index.html">http://192.168.150.105:8848/nacos/index.html</a></p><p>è´¦å·å¯†ç ï¼šnacos</p><h3 id="ç¤ºä¾‹é…ç½®ï¼š"><a href="#ç¤ºä¾‹é…ç½®ï¼š" class="headerlink" title="ç¤ºä¾‹é…ç½®ï¼š"></a>ç¤ºä¾‹é…ç½®ï¼š</h3><ol><li>æœåŠ¡è°ƒç”¨ç±»å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ï¼Œå»ºè®®æ˜¯æŠ½è±¡å‡ºä¸€ä¸ªå…¬å…±é¡¹ç›®ï¼ˆæ”¾æ¥å£ã€å®ä½“ç±»ç­‰ï¼‰</li><li>è®¾ç½®æ³¨è§£ï¼ˆæ¯”å¦‚å¯åŠ¨ç±»çš„ EnableDubboã€æ¥å£å®ç°ç±»å’Œ Bean å¼•ç”¨çš„æ³¨è§£ï¼‰</li><li>æ·»åŠ é…ç½®</li><li>æœåŠ¡è°ƒç”¨é¡¹ç›®å’Œæä¾›è€…é¡¹ç›®å°½é‡å¼•å…¥ç›¸åŒçš„ä¾èµ–å’Œé…ç½®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- https:<span class="hljs-comment">//mvnrepository.com/artifact/org.apache.dubbo/dubbo --&gt;</span><br> &lt;dependency&gt;<br>     &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;<br>     &lt;artifactId&gt;dubbo&lt;/artifactId&gt;<br>     &lt;version&gt;<span class="hljs-number">3.1</span><span class="hljs-number">.3</span>&lt;/version&gt;<br> &lt;/dependency&gt;<br> &lt;dependency&gt;<br>     &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;<br>     &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;<br>     &lt;version&gt;<span class="hljs-number">2.1</span><span class="hljs-number">.0</span>&lt;/version&gt;<br> &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="bug-1"><a href="#bug-1" class="headerlink" title="bug"></a>bug</h2><ol><li><p>å‰ç«¯ä¿®æ”¹ä¿¡æ¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¿®æ”¹ä¿¡æ¯æ—¶ï¼Œæ²¡æœ‰ä¼ é€’idåˆ—ï¼Œå¯¼è‡´ä¿®æ”¹åidåˆ—ä¼ ç»™åç«¯çš„idä¸ºnullï¼Œåç«¯å› ä¸ºidä¸èƒ½ä¸ºç©ºæ‰€ä»¥ç³»ç»ŸæŠ¥é”™ã€‚</p><p>è§£å†³æ–¹æ³•åº”è¯¥ä¿®æ”¹å‰ç«¯ï¼Œè®©å‰ç«¯ä¿®æ”¹æ—¶å¸¦ä¸Šidã€‚</p></li><li><p>æ¥å£è¿”å›æŠ¥é”™ï¼š</p></li><li><pre><code class="hljs">2023-08-10 19:56:43.091  WARN 21476 --- [nio-8090-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method &#39;POST&#39; not supported]2023-08-10 19:56:43.091  WARN 21476 --- [nio-8090-exec-3] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method &#39;POST&#39; not supported]<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br>   è§£å†³æ–¹æ³•ï¼šå±‚å±‚æ‰“æ–­ç‚¹æ’æŸ¥ï¼Œæœ€åç¡®å®šæ˜¯ç½‘å…³å±‚é¢é—®é¢˜ï¼Œè¯·æ±‚çš„æ¥å£æ˜¯è·å–æ–°é—»åˆ—è¡¨ï¼Œåˆ°ç½‘å…³ä¹‹åå¤„ç†æ”¹ä¸ºäº†æˆ‘å†™çš„é™çº§å¤„ç†çš„é”™è¯¯é¡µé¢ï¼Œå¯¼è‡´è¯·æ±‚ä¸ºpostï¼Œå€’æ˜¯fallbackä¸ºgetè¯·æ±‚ï¼Œæœ€ååˆ æ‰é™çº§å¤„ç†çš„é…ç½®urlï¼ŒæˆåŠŸè§£å†³é—®é¢˜<br><br><span class="hljs-number">4</span>. ```<br>   request startï¼Œid: ffa537ac-<span class="hljs-number">5</span>bc2-<span class="hljs-number">43</span>b7-<span class="hljs-number">9</span>ad8-<span class="hljs-number">886218</span>cb8bce, path: /api/analysis/<span class="hljs-attribute">top</span>/interface/invoke, ip: <span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:<span class="hljs-number">1</span>, params: []<br>   <span class="hljs-number">2023</span>-<span class="hljs-number">08</span>-<span class="hljs-number">12</span> <span class="hljs-number">01</span>:<span class="hljs-number">05</span>:<span class="hljs-number">25.853</span> ERROR <span class="hljs-number">25032</span> --- <span class="hljs-selector-attr">[nio-7529-exec-3]</span> c<span class="hljs-selector-class">.y</span><span class="hljs-selector-class">.p</span><span class="hljs-selector-class">.exception</span><span class="hljs-selector-class">.GlobalExceptionHandler</span>   : runtimeException<br>   <br>   org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.ibatis</span><span class="hljs-selector-class">.binding</span><span class="hljs-selector-class">.BindingException</span>: Invalid bound statement (not found): com<span class="hljs-selector-class">.yangapi</span><span class="hljs-selector-class">.project</span><span class="hljs-selector-class">.mapper</span><span class="hljs-selector-class">.UserInterfaceInfoMapper</span>.listTopInvokeInterfaceInfo<br></code></pre></td></tr></table></figure></code></pre></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>é¡¹ç›®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¼“å­˜</title>
    <link href="/2023/09/14/%E7%BC%93%E5%AD%98/"/>
    <url>/2023/09/14/%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¼“å­˜æŠ€æœ¯"><a href="#ç¼“å­˜æŠ€æœ¯" class="headerlink" title="ç¼“å­˜æŠ€æœ¯"></a>ç¼“å­˜æŠ€æœ¯</h2><p>åˆ†å¸ƒå¼ç¼“å­˜</p><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><p>æ“ä½œredisçš„å®¢æˆ·ç«¯ï¼š</p><ol><li><p>Jedis</p><p>ç‹¬ç«‹äºspringæ“ä½œredisçš„javaå®¢æˆ·ç«¯</p></li><li><p>Lettuce</p><p>é«˜é˜¶æ“ä½œredisçš„javaå®¢æˆ·ç«¯</p><p>ä½¿ç”¨lettuceåšredisè¿æ¥æ± (å¤ç”¨)</p><ol><li>å¯¼å…¥ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.lettuce/lettuce-core --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.lettuce<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lettuce-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.1.8.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>é…ç½®è¿æ¥æ± :</li></ol></li><li><p>Redisson</p><p>åˆ†å¸ƒå¼æ“ä½œredisçš„javaå®¢æˆ·ç«¯</p></li></ol><p>â€“ etcd</p><p>â€“ memcached</p><p>â€“ å•æœºç¼“å­˜</p><p>â€“ ehcache</p><p>â€“ æœ¬åœ°ç¼“å­˜</p><p>â€“ guava</p><h2 id="spring-data-redis"><a href="#spring-data-redis" class="headerlink" title="spring data redis"></a>spring data redis</h2><ol><li>redisæ•°æ®ç»“æ„</li></ol><ul><li><p>string</p></li><li><p>set</p></li><li><p>zset</p></li><li><p>hash</p></li><li><p>list</p></li></ul><ol start="2"><li>é«˜çº§æ•°æ®ç»“æ„</li></ol><ul><li><p>boomfilterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</p></li><li><p>geo(è®¡ç®—åœ°ç†ä½ç½®)</p></li><li><p>hyperloglog(pv&#x2F;uv)</p></li><li><p>pub&#x2F;sub(å‘å¸ƒè®¢é˜…ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—)</p></li><li><p>BitMap(ç”¨äºå­˜å‚¨å¤§é‡è¢«å‹ç¼©çš„ä¿¡æ¯)</p></li></ul><p>é¦–é¡µå±•ç¤ºæ¨èç”¨æˆ·å†…å®¹çŸ­æ—¶é—´å†…ä¸ä¼šæ”¹å˜çš„æ•°æ®ï¼Œä½¿ç”¨ç¼“å­˜redisï¼Œåœ¨å…­æ¡æ•°æ®çš„æƒ…å†µä¸‹ï¼ŒåŠ ä¸Šç¼“å­˜ä¹‹åæŸ¥è¯¢é€Ÿåº¦ç”±90mså·¦å³å˜ä¸º30mså·¦å³ï¼Œè™½ç„¶æ•°æ®é‡å°å­˜åœ¨å¶ç„¶æ€§ï¼Œä½†æ˜¯åœ¨å¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„æŸ¥è¯¢é€Ÿç‡ä¼šå¿«å¾ˆå¤šã€‚</p><h2 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h2><ol><li>å®šæ—¶</li><li>æ¨¡æ‹Ÿè§¦å‘(æ‰‹åŠ¨è§¦å‘)</li></ol><p><strong><font color="greeny">ç¼“å­˜é¢„çƒ­çš„é—®é¢˜å¯¹è±¡ï¼š</font></strong></p><p>å½“æ•°æ®æ›´æ–°æ—¶ï¼Œç¬¬ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚æ€»æ˜¯ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªäººæŸ¥è¯¢çš„é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼Œå¦‚æœç¬¬ä¸€ä¸ªä½¿ç”¨çš„äººæ˜¯ä½ çš„è€æ¿ï¼Œé‚£ä½ ç›´æ¥å¯ä»¥æ¯•ä¸šäº†ã€‚</p><p><strong>å®ç°</strong></p><p>å®šæ—¶ä»»åŠ¡ï¼Œåˆ·æ–°æ‰€æœ‰ç”¨æˆ·çš„æ¨èåˆ—è¡¨</p><p><strong>é‡è¦</strong></p><ol><li>ç¼“å­˜é¢„çƒ­çš„ä½¿ç”¨åœºæ™¯ï¼šæ–°å¢ï¼Œä¿®æ”¹ä¿¡æ¯å°‘ï¼Œæ€»ç”¨æˆ·å¤š</li><li>ç¼“å­˜ç©ºé—´ä¸èƒ½å¤ªå¤§ï¼Œé¢„ç•™ç»™å…¶ä»–ç¼“å­˜ç©ºé—´</li><li>ç¼“å­˜æ•°æ®çš„å‘¨æœŸï¼Œçœ‹åœºæ™¯</li></ol><h2 id="å®šæ—¶ä»»åŠ¡å¼€å¯"><a href="#å®šæ—¶ä»»åŠ¡å¼€å¯" class="headerlink" title="å®šæ—¶ä»»åŠ¡å¼€å¯"></a>å®šæ—¶ä»»åŠ¡å¼€å¯</h2><h3 id="1ã€xxl-job-å¼€æºå®šæ—¶ä»»åŠ¡æ¡†æ¶"><a href="#1ã€xxl-job-å¼€æºå®šæ—¶ä»»åŠ¡æ¡†æ¶" class="headerlink" title="1ã€xxl-job(å¼€æºå®šæ—¶ä»»åŠ¡æ¡†æ¶)"></a>1ã€xxl-job(å¼€æºå®šæ—¶ä»»åŠ¡æ¡†æ¶)</h3><h3 id="2ã€spring-scheduled"><a href="#2ã€spring-scheduled" class="headerlink" title="2ã€spring scheduled"></a>2ã€spring scheduled</h3><p>å¼€å¯ï¼š</p><ol><li>SpringBootApplicationé‡ŒåŠ ä¸Š<code>@EnableScheduling</code>æ³¨è§£</li><li>å®šæ—¶ä»»åŠ¡ç±»ä¸ŠåŠ ä¸Š<code>@Component</code>,æ³¨å†Œä¸ºBeanï¼Œäº¤ç»™å®¹å™¨ç®¡ç†</li><li>ä»»åŠ¡æ–¹æ³•ä¸ŠåŠ ä¸Š<code>@Scheduled(cron = &quot;0 4 0 * * *&quot;)</code></li><li>@Scheduledç”¨äºç¼–å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æˆ–æ–¹æ³•ï¼Œ<code>cron = &quot;0 4 0 * * *&quot;</code>è¡¨ç¤ºè¯¥æ–¹æ³•å°†åœ¨æ¯å¤©çš„å‡Œæ™¨0ç‚¹4åˆ†è§¦å‘æ‰§è¡Œã€‚</li></ol><p>cronè¡¨è¾¾å¼ï¼š</p><ul><li><p>ç¬¬ä¸€éƒ¨åˆ†ä¸º â€œ0â€ è¡¨ç¤ºä»»åŠ¡å°†åœ¨æ¯ä¸€åˆ†é’Ÿçš„ç¬¬0ç§’å¼€å§‹æ‰§è¡Œã€‚</p></li><li><p>ç¬¬äºŒéƒ¨åˆ†ä¸º â€œ4â€ è¡¨ç¤ºä»»åŠ¡å°†åœ¨æ¯å°æ—¶çš„ç¬¬4åˆ†é’Ÿæ‰§è¡Œã€‚</p></li><li><p>ç¬¬ä¸‰éƒ¨åˆ†ä¸º â€œ0â€ è¡¨ç¤ºä»»åŠ¡å°†åœ¨æ¯å¤©çš„0ç‚¹æ‰§è¡Œã€‚</p></li><li><p>ç¬¬å››ã€ç¬¬äº”å’Œç¬¬å…­éƒ¨åˆ†ä½¿ç”¨ â€œ * â€œ è¡¨ç¤ºé€šé…ç¬¦ï¼Œè¡¨ç¤ºæ¯å¤©ã€æ¯æœˆå’Œæ¯å‘¨éƒ½é€‚ç”¨ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼“å­˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¼˜åŒ–</tag>
      
      <tag>ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springMvcæ³¨è§£åŠå…¶ç”¨æ³•</title>
    <link href="/2023/08/16/springMvc%E6%B3%A8%E8%A7%A3%E5%8F%8A%E5%85%B6%E7%94%A8%E6%B3%95/"/>
    <url>/2023/08/16/springMvc%E6%B3%A8%E8%A7%A3%E5%8F%8A%E5%85%B6%E7%94%A8%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="springMvcæ³¨è§£åŠå…¶ç”¨æ³•"><a href="#springMvcæ³¨è§£åŠå…¶ç”¨æ³•" class="headerlink" title="springMvcæ³¨è§£åŠå…¶ç”¨æ³•"></a>springMvcæ³¨è§£åŠå…¶ç”¨æ³•</h1><ol><li><p><code>@Controller</code>ï¼šç”¨äºæ ‡è¯†ä¸€ä¸ªç±»ä¸ºæ§åˆ¶å™¨ï¼Œå¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-comment">// æ§åˆ¶å™¨æ–¹æ³•...</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@RestController</code>ï¼šä¸<code>@Controller</code>ç±»ä¼¼ï¼Œä½†å®ƒè¿˜ä¼šè‡ªåŠ¨å°†æ–¹æ³•çš„è¿”å›å€¼è½¬æ¢ä¸ºJSONæ ¼å¼ï¼Œå¸¸ç”¨äºæ„å»ºRESTful APIã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-comment">// æ§åˆ¶å™¨æ–¹æ³•...</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@RequestMapping</code>ï¼šç”¨äºå°†è¯·æ±‚æ˜ å°„åˆ°æ–¹æ³•æˆ–ç±»ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;userList&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@GetMapping</code>ã€<code>@PostMapping</code>ã€<code>@PutMapping</code>ã€<code>@DeleteMapping</code>ï¼šç”¨äºå°†GETã€POSTã€PUTã€DELETEè¯·æ±‚æ˜ å°„åˆ°æ–¹æ³•ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@PathVariable</code>ï¼šç”¨äºä»URLè·¯å¾„ä¸­è·å–è·¯å¾„å˜é‡çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@RequestParam</code>ï¼šç”¨äºä»è¯·æ±‚å‚æ•°ä¸­è·å–å‚æ•°çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;name&quot;)</span> String name)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> userList;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@RequestBody</code>ï¼šç”¨äºå°†è¯·æ±‚ä½“ä¸­çš„JSONæˆ–XMLæ•°æ®ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@ResponseBody</code>ï¼šç”¨äºå°†æ–¹æ³•çš„è¿”å›å€¼ç›´æ¥ä½œä¸ºå“åº”ä½“è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@ModelAttribute</code>ï¼šç”¨äºå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°æ–¹æ³•çš„å‚æ•°ä¸Šï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@ModelAttribute(&quot;user&quot;)</span> User user)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;userDetail&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@Valid</code>ï¼šç”¨äºå¯ç”¨å‚æ•°çš„æ ¡éªŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†é€»è¾‘...</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>@ControllerAdvice<br>ä½œç”¨ï¼š<br>1ã€å…¨å±€å¼‚å¸¸å¤„ç†<br>2ã€å…¨å±€æ•°æ®ç»‘å®š<br>3ã€å…¨å±€æ•°æ®é¢„å¤„ç†<br>ç¤ºä¾‹:<br>ä½¿ç”¨ @ControllerAdvice å®ç°å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œåªéœ€è¦å®šä¹‰ç±»ï¼Œæ·»åŠ è¯¥æ³¨è§£å³å¯å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyGlobalExceptionHandler</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">customException</span><span class="hljs-params">(Exception e)</span> &#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>();<br>        mv.addObject(<span class="hljs-string">&quot;message&quot;</span>, e.getMessage());<br>        mv.setViewName(<span class="hljs-string">&quot;myerror&quot;</span>);<br>        <span class="hljs-keyword">return</span> mv;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>@ExceptionHandler</code>ï¼šå¤„ç†æ§åˆ¶å™¨æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">handleException</span><span class="hljs-params">(Exception ex)</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸...</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>&lt;&gt;(<span class="hljs-string">&quot;Error occurred&quot;</span>, HttpStatus.INTERNAL_SERVER_ERROR);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å¤‡å¿˜å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spring</tag>
      
      <tag>æ³¨è§£</tag>
      
      <tag>restfulé£æ ¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®åº“è¡¨å­—æ®µè®¾è®¡æ³¨æ„äº‹é¡¹</title>
    <link href="/2023/08/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%AD%97%E6%AE%B5%E8%AE%BE%E8%AE%A1%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
    <url>/2023/08/01/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%AD%97%E6%AE%B5%E8%AE%BE%E8%AE%A1%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®åº“-Mysql-è®¾è®¡ä¼˜åŒ–"><a href="#æ•°æ®åº“-Mysql-è®¾è®¡ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“(Mysql)è®¾è®¡ä¼˜åŒ–"></a>æ•°æ®åº“(Mysql)è®¾è®¡ä¼˜åŒ–</h1><h2 id="Intæ•°æ®ç±»å‹"><a href="#Intæ•°æ®ç±»å‹" class="headerlink" title="Intæ•°æ®ç±»å‹"></a>Intæ•°æ®ç±»å‹</h2><h3 id="intã€bigintã€smallint-å’Œ-tinyintçš„åŒºåˆ«"><a href="#intã€bigintã€smallint-å’Œ-tinyintçš„åŒºåˆ«" class="headerlink" title="intã€bigintã€smallint å’Œ tinyintçš„åŒºåˆ«"></a>intã€bigintã€smallint å’Œ tinyintçš„åŒºåˆ«</h3><table><thead><tr><th align="center">æ•°æ®ç±»å‹</th><th>èŒƒå›´</th><th>å­˜å‚¨å¤§å°</th></tr></thead><tbody><tr><td align="center">bigint</td><td>-2^63 (-9223372036854775808) åˆ° 2^63-1 (9223372036854775807)</td><td>8å­—èŠ‚</td></tr><tr><td align="center">int</td><td>-2^31 (-2,147,483,648) åˆ° 2^31 â€“ 1 (2,147,483,647) çš„æ•´å‹æ•°æ®</td><td>4å­—èŠ‚</td></tr><tr><td align="center">smallint</td><td>-2^15 (-32,768) åˆ° 2^15 â€“ 1 (32,767) çš„æ•´å‹æ•°æ®</td><td>2å­—èŠ‚</td></tr><tr><td align="center">tinyint</td><td>æ— ç¬¦å·ï¼ˆunsignedï¼‰ï¼š 0 åˆ° 255 çš„æ•´å‹æ•°æ®ï¼›æœªè®¾ç½®æ— ç¬¦å·ï¼š-128åˆ°127</td><td>1å­—èŠ‚</td></tr></tbody></table><ul><li><font color="red"><em><strong>int(M) åœ¨ integer æ•°æ®ç±»å‹ä¸­ï¼ŒM è¡¨ç¤ºæœ€å¤§æ˜¾ç¤ºå®½åº¦ã€‚åœ¨ int(M) ä¸­ï¼ŒM çš„å€¼è·Ÿ int(M) æ‰€å å¤šå°‘å­˜å‚¨ç©ºé—´å¹¶æ— ä»»ä½•å…³ç³»ã€‚å’Œæ•°å­—ä½æ•°ä¹Ÿæ— å…³ç³» int(3)ã€int(4)ã€int(8) åœ¨ç£ç›˜ä¸Šéƒ½æ˜¯å ç”¨ 4 btyes çš„å­˜å‚¨ç©ºé—´ã€‚</strong></em></font></li></ul><h3 id="tinyintçš„è¯¦è§£"><a href="#tinyintçš„è¯¦è§£" class="headerlink" title="tinyintçš„è¯¦è§£"></a>tinyintçš„è¯¦è§£</h3><h4 id="tinyintæœ‰ç¬¦å·å’Œæ— ç¬¦å·"><a href="#tinyintæœ‰ç¬¦å·å’Œæ— ç¬¦å·" class="headerlink" title="tinyintæœ‰ç¬¦å·å’Œæ— ç¬¦å·"></a>tinyintæœ‰ç¬¦å·å’Œæ— ç¬¦å·</h4><ol><li>tinyint å‹çš„å­—æ®µå¦‚æœè®¾ç½®ä¸ºUNSIGNEDç±»å‹,åªèƒ½å­˜å‚¨ä»0åˆ°255çš„æ•´æ•°,ä¸èƒ½ç”¨æ¥å‚¨å­˜è´Ÿæ•°ã€‚</li><li>tinyint å‹çš„å­—æ®µå¦‚æœä¸è®¾ç½®UNSIGNEDç±»å‹,å­˜å‚¨-128åˆ°127çš„æ•´æ•°ã€‚</li><li>å…³äºåŠ ä¸Šunsignedåçš„è¯´æ˜ï¼šåŠ ä¸Šunsignedå±æ€§åå°±æ˜¯æ— ç¬¦å·(èŒƒå›´æ˜¯0~255çš„æ•´æ•°,å› ä¸ºæ˜¯æ•´æ•°,ä¸ä¼šæœ‰ç¬¦å·â€-â€œ,æ‰€ä»¥å°±æ˜¯æ— ç¬¦å·)</li><li>å…³äºåŠ ä¸Šzerofillåçš„è¯´æ˜ï¼šzerofillå±æ€§ä¼šæŠŠunsignedå±æ€§ä¹Ÿç»™å¸¦ä¸Š,è¿™æ ·å°±æ˜¯æ— ç¬¦å·ï¼ˆèŒƒå›´æ˜¯0~255ï¼Œæ˜¾ç¤ºé•¿åº¦å°±æ˜¯3ï¼‰ï¼ŒåŒæ—¶è¿˜ä¼š<br>è¿›è¡Œå‰å¯¼é›¶å¡«å……ï¼ˆæ²¡æœ‰è¾¾åˆ°æ˜¾ç¤ºé•¿åº¦çš„æ•°å€¼ï¼Œä¾‹å¦‚ï¼šä½ æ’å…¥1ï¼Œæ˜¾ç¤ºçš„æ˜¯001ï¼‰ã€‚</li><li>ä¸åŠ unsignedå’Œzerofillçš„è¯´æ˜ï¼šå­—æ®µåé¢ä¸åŠ ä¸Šè¿™ä¸¤ä¸ªå±æ€§ä¸­çš„ä»»ä½•ä¸€ä¸ª,å°±è¡¨ç¤ºæ˜¯æœ‰ç¬¦å·(èŒƒå›´æ˜¯-128~127,å› ä¸ºæœ‰ç¬¦å·â€-â€œ,æ‰€æœ‰æ˜¯æœ‰ç¬¦å·)ã€‚</li></ol><h4 id="tinyint-M-è¯¦è§£"><a href="#tinyint-M-è¯¦è§£" class="headerlink" title="tinyint(M)è¯¦è§£"></a>tinyint(M)è¯¦è§£</h4><ul><li><font color="red">*** tinyintåé¢çš„æ‹¬å·å¸¦çš„æ•°å­—,ä»¥åç§°ä¹‹ä¸ºM,å’Œå­˜è´®çš„å€¼æ²¡æœ‰ä»»ä½•å…³ç³»,åªæ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å’Œæ˜¾ç¤ºçš„å®½åº¦æœ‰å…³ç³»ã€‚***</font></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-----------------------------------------</span><br><span class="hljs-comment">-- éªŒè¯tinyintæ˜¯å¦è®¾ç½®ç¬¦å·åŒºåˆ«</span><br><span class="hljs-comment">-----------------------------------------</span><br><span class="hljs-comment">-- åˆ›å»ºè¡¨testï¼Œè®¾ç½®æ— ç¬¦å·ç±»å‹tinyint</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `test` (<br>`id` <span class="hljs-type">INT</span> ( <span class="hljs-number">11</span> ) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>`str` <span class="hljs-type">VARCHAR</span> ( <span class="hljs-number">255</span> ) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>`state` TINYINT ( <span class="hljs-number">1</span> ) UNSIGNED ZEROFILL <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>`state2` TINYINT ( <span class="hljs-number">2</span> ) UNSIGNED ZEROFILL <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>`state3` TINYINT ( <span class="hljs-number">3</span> ) UNSIGNED ZEROFILL <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>`state4` TINYINT ( <span class="hljs-number">4</span> ) UNSIGNED ZEROFILL <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br><span class="hljs-keyword">PRIMARY</span> KEY ( `id` ) <br>) ENGINE <span class="hljs-operator">=</span> MyISAM AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">6</span> <span class="hljs-keyword">DEFAULT</span> CHARSET <span class="hljs-operator">=</span> utf8;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">66</span>,<span class="hljs-number">66</span>,<span class="hljs-number">66</span>,<span class="hljs-number">66</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">254</span>,<span class="hljs-number">254</span>,<span class="hljs-number">254</span>,<span class="hljs-number">254</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>);<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test;<br><span class="hljs-comment">------------------------------------------</span><br>idstrstatestate2state3state4<br><span class="hljs-number">6</span>csdn<span class="hljs-number">6</span>   <span class="hljs-number">06</span> <span class="hljs-number">006</span> <span class="hljs-number">0006</span><br><span class="hljs-number">7</span>csdn<span class="hljs-number">66</span>   <span class="hljs-number">66</span> <span class="hljs-number">066</span> <span class="hljs-number">0066</span><br><span class="hljs-number">8</span>csdn<span class="hljs-number">254</span>   <span class="hljs-number">254</span> <span class="hljs-number">254</span> <span class="hljs-number">0254</span><br><span class="hljs-number">9</span>csdn<span class="hljs-number">255</span>   <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">0255</span><br><span class="hljs-comment">------------------------------------------</span><br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>æœ‰ç¬¦å·<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testtiny (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>,<span class="hljs-number">6</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testtiny (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">66</span>,<span class="hljs-number">66</span>,<span class="hljs-number">66</span>,<span class="hljs-number">66</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testtiny (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testtiny (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">127</span>,<span class="hljs-number">127</span>,<span class="hljs-number">127</span>,<span class="hljs-number">127</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testtiny (str,state,state2,state3,state4) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;csdn&#x27;</span>,<span class="hljs-number">128</span>,<span class="hljs-number">128</span>,<span class="hljs-number">128</span>,<span class="hljs-number">128</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testtiny;<br><br><span class="hljs-comment">------------------------------------------</span><br>idstr  state state2 state3 state4<br><span class="hljs-number">6</span>csdn<span class="hljs-number">6</span>  <span class="hljs-number">6</span>      <span class="hljs-number">6</span>       <span class="hljs-number">6</span><br><span class="hljs-number">7</span>csdn<span class="hljs-number">66</span>  <span class="hljs-number">66</span>  <span class="hljs-number">66</span>       <span class="hljs-number">66</span><br><span class="hljs-number">8</span>csdn<span class="hljs-number">100</span>  <span class="hljs-number">100</span>  <span class="hljs-number">100</span>      <span class="hljs-number">100</span><br><span class="hljs-number">9</span>csdn<span class="hljs-number">127</span>  <span class="hljs-number">127</span>  <span class="hljs-number">12</span>       <span class="hljs-number">127</span><br><span class="hljs-comment">------------------------------------------</span><br></code></pre></td></tr></table></figure><h2 id="varcharæ•°æ®ç±»å‹"><a href="#varcharæ•°æ®ç±»å‹" class="headerlink" title="varcharæ•°æ®ç±»å‹"></a>varcharæ•°æ®ç±»å‹</h2><p><em><strong>varchar å­˜å‚¨åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</strong></em></p><p><strong>archarå­—æ®µé•¿åº¦ &#x3D; å­—ç¬¦ä¸²é•¿åº¦å€¼ + å®é™…æ•°æ®é•¿åº¦ Nã€‚</strong></p><p>å­—ç¬¦ä¸²é•¿åº¦å€¼,å®é™…æ•°æ®é•¿åº¦ï¼Œéœ€å ç”¨ 1 æˆ– 2 ä¸ªå­—èŠ‚å­˜å‚¨ã€‚å› æ­¤æˆ‘ä»¬å¾—å‡ºï¼š</p><ul><li>å½“å®é™…æ•°æ®é•¿åº¦ &lt;&#x3D; 255 æ—¶ï¼Œvarcharå­—æ®µé•¿åº¦ &#x3D; 1 + Nï¼›</li><li>å½“å®é™…æ•°æ®é•¿åº¦ &gt; 255 æ—¶ï¼Œ varcharå­—æ®µé•¿åº¦ &#x3D; 2 + N;</li></ul><p>varcharä¸»è¦æ ¹æ®å­—æ®µå®é™…ä½¿ç”¨çš„é•¿åº¦æ¥åˆ†é…å­˜å‚¨ç©ºé—´</p><p><strong>åœ¨æ•°æ®åº“è®¾è®¡æ—¶ï¼Œä¸ºäº†èŠ‚çº¦ç£ç›˜å­˜å‚¨ç©ºé—´å’Œå†…å­˜ç©ºé—´ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå¤„ç†æ•ˆç‡ï¼Œå»ºè®®é‡‡ç”¨å¦‚ä¸‹æ–¹æ¡ˆ</strong></p><ul><li><p><strong>å­—ç¬¦ä¸²å®é™…æ•°æ®é•¿åº¦N</strong></p></li><li><p><strong>0 &lt; N &lt; &#x3D; 64</strong></p></li></ul><p>â€‹æ ¹æ®å®é™…æ•°æ®é•¿åº¦Nï¼Œé€‰æ‹©ä¸€ä¸ªç›¸è¿‘çš„2^né•¿åº¦ï¼š</p><p><strong>ä¾‹å¦‚ï¼š</strong><br><code> varchar(8),varchar(16),varchar(32),varchar(64)</code></p><p><strong>ä¾‹å­ï¼š</strong></p><p>æ‰‹æœºå·11ä½ï¼Œå¯ä»¥é€‰æ‹©varchar(16)</p><p><strong>åŸå› ï¼š</strong></p><p>1 bytes &#x3D; 8 bit ,ä¸€ä¸ªå­—èŠ‚æœ€å¤šå¯ä»¥ä»£è¡¨çš„æ•°æ®é•¿åº¦æ˜¯2çš„8æ¬¡æ–¹ 11111111 åœ¨è®¡ç®—æœºä¸­ä¹Ÿå°±æ˜¯-128åˆ°127ã€‚</p><p>ä½¿ç”¨2 ^ né•¿åº¦ä½¿æ›´å¥½çš„å¯¹é½ç£ç›˜æˆ–å†…å­˜å—ã€‚</p><p>å¯¹é½å—æ›´å¿«ã€‚å¦‚ä»Šâ€œå—â€çš„å¤§å°æ›´å¤§ï¼Œå†…å­˜å’Œç£ç›˜è¶³å¤Ÿå¿«ï¼Œå¯ä»¥å¿½ç•¥å¯¹é½ï¼Œä½†å¯¹äºéå¸¸å¤§çš„å—æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>64 &lt; N</p><p>æ ¹æ®å®é™…æ•°æ®é•¿åº¦Nï¼Œé€‰æ‹©ä¸€ä¸ªç›¸è¿‘çš„2^n-1é•¿åº¦ï¼š</p><p><strong>ä¾‹å¦‚ï¼š</strong><br>varchar(127),varchar(255),varchar(511)ï¼Œâ€¦</p><p><strong>ä¾‹å­ï¼š</strong></p><ul><li>æ”¶è´§åœ°å€æ¥è¿‘100ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©varchar(127)</li><li>å•†å“åç§°ï¼Œæ¥è¿‘256ä¸ªå­—ç¬¦ï¼Œå¯ä»¥é€‰æ‹©varchar(255ï¼‰</li></ul><p><strong>åŸå› ï¼š</strong></p><ul><li><p>æ–¹ä¾¿InnoDBå»ºç´¢å¼•ï¼Œå¯¹äº MyISAMï¼Œå¯ä»¥å¯¹å‰ 1000 ä¸ªå­—èŠ‚åšç´¢å¼•ï¼Œå¯¹äº InnoDBï¼Œåˆ™åªæœ‰ 767 å­—èŠ‚ã€‚ï¼ˆæ¥æºä¾æ®ï¼‰ã€‚255X3&#x3D;765</p></li><li><p>å°‘ç”³è¯·ä¸€ä¸ªå­—èŠ‚ï¼Œè®°å½•å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸€ä¸ª8ä½çš„tinyintï¼Œå¯ä»¥è¡¨ç¤ºçš„æ— ç¬¦å·æ•°å€¼çš„èŒƒå›´æ˜¯ï¼Œ0-255ï¼Œå¦‚æœé•¿åº¦è¶…è¿‡äº†255ï¼Œéœ€è¦åœ¨ç”³è¯·ä¸ªå­—èŠ‚ã€‚</p></li><li><p>ç£ç›˜å—å’Œå†…å­˜å—å¯¹é½</p></li></ul><p><strong>è¡¥å……è¯´æ˜ï¼š</strong><br>varchar(N)é•¿åº¦å¹¶ä¸æ˜¯è¶Šé•¿ï¼Œè¶Šå¥½ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„é•¿åº¦ã€‚</p><p>å› ä¸ºï¼šåœ¨å†…å­˜ä¸­çš„æ“ä½œæ–¹å¼ï¼Œvarcharä¹Ÿæ˜¯æŒ‰ç…§æœ€é•¿çš„æ–¹å¼åœ¨å†…å­˜ä¸­è¿›è¡Œæ“ä½œçš„ã€‚æ¯”å¦‚è¯´è¦è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œvarcahr(100)æ˜¯æŒ‰ç…§100è¿™ä¸ªé•¿åº¦æ¥è¿›è¡Œçš„ï¼Œä¸åˆç†çš„é•¿åº¦ä¼šæµªè´¹å†…å­˜ç©ºé—´ã€‚</p><hr><h3 id="char"><a href="#char" class="headerlink" title="char"></a>char</h3><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/f156ca544bdc9d8e86d3e025a2fd1fdc.png"></p><ul><li><p>å›ºå®šé•¿åº¦ã€‚</p></li><li><p>ä¿å­˜å€¼æ—¶ï¼Œå»æ‰æœ«å°¾çš„ç©ºæ ¼ã€‚</p></li><li><p>charå¸¸ç”¨äºå¾ˆçŸ­å­—ç¬¦ä¸²æˆ–é•¿åº¦è¿‘ä¼¼ç›¸åŒçš„å­—ç¬¦ä¸²çš„æ—¶å€™å¾ˆæœ‰ç”¨ã€‚å¦‚å­˜å‚¨ç”¨æˆ·å¯†ç çš„MD5å“ˆå¸Œå€¼ï¼Œå®ƒçš„é•¿åº¦æ€»æ˜¯ä¸€æ ·çš„ã€‚</p></li></ul><p><strong>charä¼˜äºvarcharçš„åœ°æ–¹ï¼Ÿ</strong></p><ol><li><p>å¯¹äºç»å¸¸æ”¹å˜çš„å€¼ï¼Œcharä¼˜äºvarcharï¼Œå› ä¸ºå›ºå®šé•¿åº¦è¡Œä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ã€‚â€”â€”å½“æœ€é•¿é•¿åº¦è¿œå¤§äºå¹³å‡é•¿åº¦ï¼Œå¹¶ä¸”å¾ˆå°‘å‘ç”Ÿæ›´æ–°çš„æ—¶å€™ï¼Œé€šå¸¸é€‚åˆä½¿ç”¨varcharã€‚</p></li><li><p>å¯¹äºå¾ˆçŸ­çš„åˆ—ï¼Œcharçš„æ•ˆç‡ä¹Ÿæ˜¯é«˜äºvarcharçš„ã€‚å¦‚å¯¹äºå•å­—èŠ‚å­—ç¬¦é›†(å¦‚latin1)ï¼Œchar(1)åªä¼šå ç”¨1ä¸ªå­—èŠ‚ï¼Œè€Œvarchar(2)ä¼šå ç”¨2ä¸ªå­—èŠ‚(æœ‰ä¸€ä¸ªå­—èŠ‚ç”¨æ¥å­˜å‚¨é•¿åº¦çš„ä¿¡æ¯)ã€‚</p></li></ol><hr><h3 id="varchar"><a href="#varchar" class="headerlink" title="varchar"></a>varchar</h3><ul><li><p>ä¿å­˜å¯å˜é•¿å­—ç¬¦ä¸²ã€‚</p><p>ç†è§£ï¼šæ¯”å›ºå®šé•¿åº¦å ç”¨æ›´å°‘çš„å­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºå®ƒåªå ç”¨è‡ªå·±éœ€è¦çš„ç©ºé—´ã€‚ä¾‹å¤–æƒ…å†µï¼šä½¿ç”¨ROW_FORMAT&#x3D;FIXEDåˆ›å»ºçš„MyISAMè¡¨ï¼Œå®ƒä¸ºæ¯è¡Œä½¿ç”¨å›ºå®šé•¿åº¦çš„ç©ºé—´ï¼Œå¯èƒ½ä¼šé€ æˆæµªè´¹ã€‚</p></li><li><p>å­˜å‚¨é•¿åº¦ä¿¡æ¯ã€‚å¦‚æœå®šä¹‰çš„åˆ—å°äºæˆ–ç­‰äº255ï¼Œåˆ™ä½¿ç”¨1ä¸ªå­—èŠ‚å­˜å‚¨é•¿åº¦å€¼ï¼Œå‡è®¾ä½¿ç”¨latin1å­—ç¬¦é›†ï¼Œå¦‚varchar(10)å°†å ç”¨11ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚åè¿‡æ¥ï¼Œvarchar(1000)ï¼Œåˆ™å ç”¨1002ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>èŠ‚çº¦ç©ºé—´ï¼Œå¯¹æ€§èƒ½æœ‰å¸®åŠ©ã€‚</p></li><li><p>5.0ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ— è®ºæ˜¯å–å€¼è¿˜æ˜¯ä¿å­˜ï¼ŒMySQLéƒ½ä¼šä¿ç•™å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ã€‚åªåˆ†é…çœŸæ­£éœ€è¦çš„ç©ºé—´</p></li><li><p>ä½¿ç”¨varchar(5)å’Œvarchar(200)ä¿å­˜â€™helloâ€™å ç”¨ç©ºé—´æ˜¯ä¸€æ ·çš„ã€‚â€”â€”è¿™é‡Œåº”è¯¥æŒ‡çš„æ˜¯ç£ç›˜ä¸Šçš„ç©ºé—´ã€‚</p></li><li><p>é‚£ä¹ˆä½¿ç”¨è¾ƒçŸ­åˆ—æœ‰ä½•ä¼˜åŠ¿ï¼Ÿâ€”â€”å·¨å¤§çš„ä¼˜åŠ¿</p><p>è¾ƒå¤§çš„åˆ—ä¼šä½¿ç”¨æ›´å¤šçš„å†…å­˜ï¼Œå› ä¸ºMySQLé€šå¸¸ä¼šåˆ†é…å›ºå®šå¤§å°çš„å†…å­˜å—(å¦‚varchar(200)ä¼šç”¨200ä¸ªå­—ç¬¦å¤§å°çš„å†…å­˜ç©ºé—´)æ¥ä¿å­˜å€¼(ç„¶åå¯¹å€¼è¿›è¡Œtrimæ“ä½œï¼Œæœ€åæ”¾å…¥ç£ç›˜)æˆ–å–å€¼ã€‚â€”â€”è¿™å¯¹æ’åºæˆ–ä½¿ç”¨åŸºäºå†…å­˜çš„ä¸´æ—¶è¡¨å°¤å…¶ä¸å¥½ã€‚</p></li></ul><h2 id="Textç±»å‹"><a href="#Textç±»å‹" class="headerlink" title="Textç±»å‹"></a>Textç±»å‹</h2><p><strong>ç”¨äºä¿å­˜å¤§é‡æ•°æ®:</strong></p><ul><li><p>InnoDBåœ¨å®ƒä»¬è¾ƒå¤§çš„æ—¶å€™ä¼šä½¿ç”¨â€œå¤–éƒ¨â€å­˜å‚¨åŒºåŸŸæ¥è¿›è¡Œä¿å­˜ã€‚â€”â€”æ‰€ä»¥éœ€è¦è¶³å¤Ÿçš„å¤–éƒ¨å­˜å‚¨ç©ºé—´æ¥ä¿å­˜å®é™…çš„å€¼ã€‚</p></li><li><p>æ’åºæ–¹å¼ä¸åŒäºå…¶ä»–å­—ç¬¦ç±»å‹ï¼Œä¸ä¼šæŒ‰ç…§å®Œæ•´é•¿åº¦è¿›è¡Œæ’åºï¼Œè€Œåªæ˜¯æŒ‰ç…§max_sort_lengthè§„å®šçš„å‰è‹¥å¹²ä¸ªå­—èŠ‚è¿›è¡Œæ’åºã€‚</p></li></ul><h2 id="ENUM-æšä¸¾-ç±»å‹"><a href="#ENUM-æšä¸¾-ç±»å‹" class="headerlink" title="ENUM(æšä¸¾)ç±»å‹"></a>ENUM(æšä¸¾)ç±»å‹</h2><p><strong>ç‰¹ç‚¹åŠä¼˜ç‚¹</strong>:</p><ul><li><p>ENUM(æšä¸¾)åˆ—å¯ä»¥å­˜å‚¨65 535ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ã€‚</p></li><li><p>ä»¥ç´§å‡‘æ–¹å¼ä¿å­˜ã€‚æ ¹æ®åˆ—è¡¨ä¸­å€¼çš„æ•°é‡ï¼ŒæŠŠå®ƒä»¬å‹ç¼©åˆ°1åˆ°2ä¸ªå­—èŠ‚ä¸­ã€‚</p></li><li><p>MySQLåœ¨å†…éƒ¨æŠŠæ¯ä¸ªå€¼éƒ½ä¿å­˜ä¸ºæ•´æ•°ï¼Œä»¥è¡¨ç¤ºå€¼åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚</p></li><li><p>ä¿ç•™äº†ä¸€ä»½â€œæŸ¥æ‰¾è¡¨â€ï¼Œæ¥è¡¨ç¤ºæ•´æ•°å’Œå­—ç¬¦ä¸²åœ¨è¡¨çš„.frmæ–‡ä»¶ä¸­çš„æ˜ å°„å…³ç³»ã€‚</p></li><li><p>ENUMå­—ç¬¦åˆ—æ˜¯å›ºå®šçš„ï¼Œæ·»åŠ ã€åˆ é™¤å­—ç¬¦ä¸²é¡»ä½¿ç”¨ALTER TABLEã€‚</p></li><li><p>åœ¨å¯¹enumåˆ—ä½¿ç”¨order byçš„æ—¶å€™ï¼Œæ˜¯æŒ‰æ•°å­—æ’åºçš„ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²æ’åºã€‚</p></li></ul><p><strong>ä½¿ç”¨æ¡ˆä¾‹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_enum_example`  (   <br>    `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,   <br>    `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,   <br>    `color` enum(<span class="hljs-string">&#x27;blue&#x27;</span>,<span class="hljs-string">&#x27;green&#x27;</span>,<span class="hljs-string">&#x27;red&#x27;</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  <br>    <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE ) <br>    ENGINE <span class="hljs-operator">=</span> InnoDB AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <br></code></pre></td></tr></table></figure><p>æ–°å»ºäº†ä¸€å¼  t_enum_example è¡¨ï¼Œä¸»è¦æœ‰ idã€nameã€color  3 ä¸ªå­—æ®µï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œcolor å­—æ®µç”¨ ENUM ç±»å‹æ¥å®šä¹‰ã€‚ENUM å­—æ®µæ˜¾ç¤ºçš„æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åº•å±‚æ˜¯ç”¨æ•´å‹ä¿å­˜çš„ï¼Œæ¯ä¸ªæšä¸¾å€¼éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•ï¼Œä» 1 å¼€å§‹ï¼Œå¦‚ä¸‹å›¾ã€‚</p><table><thead><tr><th>æšä¸¾å€¼</th><th>ç´¢å¼•</th></tr></thead><tbody><tr><td>blue</td><td>1</td></tr><tr><td>green</td><td>2</td></tr><tr><td>red</td><td>3</td></tr></tbody></table><p>æ¯”å¦‚ï¼Œè¿™é‡Œè¦ç»™è¿™å¼ è¡¨æ–°å¢æ•°æ®ï¼Œå¯ä»¥è¿™æ ·æ¥æ–°å¢</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">INSERT INTO `t_enum_example`(`name`, `color`) VALUES (&#x27;ç¬”&#x27;, &#x27;blue&#x27;); <br></code></pre></td></tr></table></figure><p>æˆ–è€…è¿™æ ·</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">INSERT INTO `t_enum_example`(`name`, `color`) VALUES (&#x27;ç¬”&#x27;, 2); <br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">id</th><th>name</th><th>color</th></tr></thead><tbody><tr><td align="center">1</td><td>ç¬”</td><td>blue</td></tr><tr><td align="center">2</td><td>ç¬”</td><td>red</td></tr><tr><td align="center">3</td><td>ç¬”</td><td>green</td></tr></tbody></table><p>åŸºæœ¬ç”¨æ³•å°±æ˜¯è¿™æ ·ï¼Œé‚£è¯¥ä¸è¯¥ç”¨ ENUM ç±»å‹æ¥å®šä¹‰å­—æ®µå‘¢ï¼Œæˆ‘è§‰å¾—æœ€å¥½ä¸è¦ç”¨ï¼Œåªè¦æœ‰ä¸‹é¢å‡ ä¸ªç‚¹ï¼š</p><p><strong>ç¼ºç‚¹</strong></p><ul><li><p>å®¹æ˜“æ··æ·†</p><ul><li>å› ä¸ºENUM å­—æ®µåº•å±‚å…¶å®æ˜¯ç”¨æ•´å‹æ¥å­˜å‚¨ï¼Œæ¯”å¦‚å¦‚æœç”¨ ENUM æ¥å­˜å‚¨å­—ç¬¦ä¸² â€˜3â€™ã€â€™2â€™ã€â€™1â€™ è¿™æ ·çš„æ•°å­—å­—ç¬¦ä¸²ï¼Œé‚£å¯¹åº”çš„ç´¢å¼•å°±æ˜¯ 1ã€2ã€3ï¼Œè¦æ˜¯ä¸ç†Ÿæ‚‰çš„å¼€å‘äººå‘˜ï¼Œå¾ˆå®¹æ˜“å°±ä¼šé€ æˆæ··æ·†ï¼Œæ–°å¢é”™è¯¯çš„æ•°æ®ã€‚</li></ul></li><li><p>ä¿®æ”¹å­—æ®µé¢‘ç¹</p><ul><li>æˆ‘ä»¬çŸ¥é“å¯¹äº<a href="https://www.zhihu.com/search?q=%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1318588502%7D">æšä¸¾ç±»å‹</a>ï¼Œæ˜¯å¾ˆæœ‰å¯èƒ½ä¼šéšæ—¶å¢åŠ çš„ï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ color å­—æ®µï¼Œè¦å¢åŠ ä¸€ç§é¢œè‰² â€˜blackâ€™ï¼Œé‚£å°±è¦ä¿®æ”¹å­—æ®µï¼Œç»™å­—æ®µçš„<a href="https://www.zhihu.com/search?q=%E6%9E%9A%E4%B8%BE&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:1318588502%7D">æšä¸¾</a>ç±»å‹å¢åŠ ä¸€ç§é¢œè‰²æšä¸¾ã€‚å¦‚æœæ¯å¢åŠ ä¸€ä¸ªæšä¸¾ï¼Œå°±è¦ä¿®æ”¹å­—æ®µï¼Œé‚£ä»£ä»·å°±å¤ªå¤§äº†ã€‚æ‰€ä»¥ä¸€èˆ¬è¿™ç§å­˜å‚¨ç±»å‹çš„å­—æ®µå»ºè®®ç”¨ TINYINT æ¥å­˜å‚¨ã€‚</li></ul></li></ul><h2 id="Dataæ—¥æœŸæ—¶é—´ç±»å‹"><a href="#Dataæ—¥æœŸæ—¶é—´ç±»å‹" class="headerlink" title="Dataæ—¥æœŸæ—¶é—´ç±»å‹"></a>Dataæ—¥æœŸæ—¶é—´ç±»å‹</h2><p><strong>ä¸€ã€æ—¥æœŸæ—¶é—´å‹</strong></p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/7f50a306b192573246477b93228ec25.png" alt="7f50a306b192573246477b93228ec25"></p><p><strong>äºŒã€æ—¥æœŸæ—¶é—´å‹å­˜å‚¨éœ€æ±‚</strong></p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/956f98af386ea93b550c198a0d96c0f.png" alt="956f98af386ea93b550c198a0d96c0f"></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>ä¼˜åŒ–</tag>
      
      <tag>èµ„æºèŠ‚çœ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>typroé…ç½®å›¾åºŠé˜¿é‡Œäº‘OSS</title>
    <link href="/2023/07/31/typro%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A%E9%98%BF%E9%87%8C%E4%BA%91OSS/"/>
    <url>/2023/07/31/typro%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A%E9%98%BF%E9%87%8C%E4%BA%91OSS/</url>
    
    <content type="html"><![CDATA[<h1>  <center><font color="yellow">typroé…ç½®å›¾åºŠ</font></center>  </h1><ul><li><p>å±±ä¸œå¤§å­¦é•œåƒæºä¸‹è½½pggo</p><p><a href="https://mirrors.sdu.edu.cn/github-release/Molunerfinn_PicGo">https://mirrors.sdu.edu.cn/github-release/Molunerfinn_PicGo</a></p></li><li><p>æ‰“å¼€pggoé…ç½®é˜¿é‡Œäº‘oss(è‡ªå®šä¹‰åŸŸåå’Œç½‘ç»œåç¼€å¯ä¸ç”¨è®¾ç½®)</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230731010032432.png" alt="image-20230731010032432"></p></li><li><p>è®¾ç½®typroå›¾ç‰‡ä¸Šä¼ å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://springboot-lcy.oss-cn-hangzhou.aliyuncs.com/img/image-20230731010142777.png" alt="image-20230731010142777"></p></li><li><p>ç‚¹å‡»éªŒè¯å›¾ç‰‡ä¸Šä¼ é€‰é¡¹ï¼Œæ˜¾ç¤ºsuccesså³ä¸ºæˆåŠŸ</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>typroé…ç½®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>typro</tag>
      
      <tag>æ•™ç¨‹</tag>
      
      <tag>å›¾åºŠ</tag>
      
      <tag>é˜¿é‡Œäº‘OSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redissonçš„ç¬¬ä¸€æ¬¡ä½¿ç”¨</title>
    <link href="/2023/07/30/Redisson%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/07/30/Redisson%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="Redissonçš„ç®€å•ä½¿ç”¨"><a href="#Redissonçš„ç®€å•ä½¿ç”¨" class="headerlink" title="Redissonçš„ç®€å•ä½¿ç”¨"></a>Redissonçš„ç®€å•ä½¿ç”¨</h1><h2 id="Redissonçš„å¿«é€Ÿå¼€å§‹"><a href="#Redissonçš„å¿«é€Ÿå¼€å§‹" class="headerlink" title="Redissonçš„å¿«é€Ÿå¼€å§‹"></a>Redissonçš„å¿«é€Ÿå¼€å§‹</h2><ol><li><p>å¼•å…¥ä¾èµ–(å»ºè®®ä¸è¦ä½¿ç”¨springboot-starterï¼Œç‰ˆæœ¬æ›´è¿­å¿«)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.redisson/redisson --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.redisson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>redisson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.22.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ol start="2"><li>æ–°å»ºRedissonConfigé…ç½®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Redissoné…ç½®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span> <span class="hljs-comment">//è¯»å–application.ymlé…ç½®</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String host;  <span class="hljs-comment">//ymlä¸­çš„redis.hostæ˜ å°„</span><br>    <span class="hljs-keyword">private</span> String port;  <span class="hljs-comment">//ymlä¸­çš„redis.portæ˜ å°„</span><br>    <span class="hljs-keyword">private</span> Integer database;  <span class="hljs-comment">//ymlä¸­çš„redis.databaseæ˜ å°„</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;reids://%s:%s&quot;</span>,host,port);<br>        <span class="hljs-comment">//å°½é‡ä¸å†™æ­»,adressä¸ºhttpåœ°å€ï¼Œhttp://127.0.0.1:6379/</span><br>        config.useSingleServer()<br>                .setAddress(address)<br>                .setDatabase(database);<br>        <span class="hljs-keyword">return</span> Redisson.create(config);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç®€å•çš„ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åç»­ä½¿ç”¨</span><br><span class="hljs-meta">@Scheduled(cron = &quot;0 4 0 * * *&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doCacheRecommendUser</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;system:precachejob:docache:lock&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">0</span>,<span class="hljs-number">30000</span>, TimeUnit.MILLISECONDS))&#123; <span class="hljs-comment">//l:ç­‰å¾…æ—¶é—´,ä¸º0è¡¨ç¤ºè·å–é”å¤±è´¥ï¼Œå°±ä¸å†å°è¯•å†æ¬¡è·å–é”,l1:é”çš„è¿‡æœŸæ—¶é—´</span><br><br>            &#125;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception exception)&#123;<br><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread())&#123; <span class="hljs-comment">//åˆ¤æ–­è¦é‡Šæ”¾é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹</span><br>                lock.unlock(); <span class="hljs-comment">//é‡Šæ”¾é”</span><br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>3.1 é”ç»­å‘½(çœ‹é—¨ç‹—æœºåˆ¶)</p><p>å®ç°: å¼€å¯ä¸€ä¸ªç›‘å¬çº¿ç¨‹ï¼Œå¦‚æœæ–¹æ³•æ²¡æœ‰å®ç°å®Œï¼Œå°±ç»™é”ç»­æœŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">lock.tryLock(<span class="hljs-number">0</span>,<span class="hljs-number">30000</span>, TimeUnit.MILLISECONDS)<br>-&gt; lock.tryLock(<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>, TimeUnit.MILLISECONDS)<br><span class="hljs-comment">//å°†l1å‚æ•°æ”¹ä¸º-1ï¼Œå³å¯å¼€å¯çœ‹é—¨ç‹—æœºåˆ¶ï¼ˆé”ç»­å‘½ï¼‰</span><br></code></pre></td></tr></table></figure><p>åŸç†ï¼š</p><ol><li>ä»»åŠ¡æœªæ‰§è¡Œå®Œæˆï¼Œæ¯åç§’ç»­æœŸä¸€æ¬¡ï¼Œé»˜è®¤ç»­æœŸä¸‰åç§’</li><li>å¦‚æœçº¿ç¨‹æŒ‚æ‰ï¼Œï¼ˆdebugï¼‰æ¨¡å¼ä¸‹ï¼Œä¼šè¢«è®¤ä¸ºæœåŠ¡å™¨å®•æœºï¼Œçœ‹é—¨ç‹—æœºåˆ¶ä¸ä¼šç”Ÿæ•ˆã€‚</li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>Redisä½¿ç”¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ªäººç¬”è®°</title>
    <link href="/2023/07/30/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/07/30/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<center><font color="blue">è‹¦é€¼ç¨‹åºå‘˜çš„æ—¥å¸¸</font></center><ul><li>æ—©èµ·ç¬¬ä¸€ä»¶äº‹ä¿®ç†ç¬¬ä¸€å¤©æ²¡å¤„ç†å¥½çš„åšå®¢</li><li>ç¬¬äºŒå¤©ç½‘ç«™è¿›ä¸å»</li><li>ç¬¬ä¸‰å¤©ä¿®ä¿®è¡¥è¡¥è¿˜æ˜¯è¿›ä¸å»</li><li>å´©æºƒäº†</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ—¥å¸¸è®°å½•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ—¥è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/07/30/hello-world/"/>
    <url>/2023/07/30/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
